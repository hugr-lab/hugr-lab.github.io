"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[6941],{416:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"querying/hugr-ipc","title":"Hugr IPC","description":"Hugr multipart IPC protocol for efficient data transfer using Apache Arrow","source":"@site/docs/6-querying/3-hugr-ipc.md","sourceDirName":"6-querying","slug":"/querying/hugr-ipc","permalink":"/docs/querying/hugr-ipc","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/6-querying/3-hugr-ipc.md","tags":[],"version":"current","lastUpdatedBy":"Claude","lastUpdatedAt":1762520762000,"sidebarPosition":3,"frontMatter":{"title":"Hugr IPC","sidebar_position":3,"description":"Hugr multipart IPC protocol for efficient data transfer using Apache Arrow","keywords":["ipc","arrow","protocol","multipart","streaming","websocket","performance","binary"]},"sidebar":"docsSidebar","previous":{"title":"GraphQL API","permalink":"/docs/querying/graphql"},"next":{"title":"Python Client (hugr-client)","permalink":"/docs/querying/python-client"}}');var i=r(4848),t=r(8453);const l={title:"Hugr IPC",sidebar_position:3,description:"Hugr multipart IPC protocol for efficient data transfer using Apache Arrow",keywords:["ipc","arrow","protocol","multipart","streaming","websocket","performance","binary"]},a="Hugr IPC Protocol",d={},c=[{value:"Overview",id:"overview",level:2},{value:"What is Hugr IPC?",id:"what-is-hugr-ipc",level:3},{value:"Why Use a Separate Protocol?",id:"why-use-a-separate-protocol",level:3},{value:"When to Use Hugr IPC",id:"when-to-use-hugr-ipc",level:3},{value:"Protocol Architecture",id:"protocol-architecture",level:2},{value:"HTTP Multipart Format",id:"http-multipart-format",level:3},{value:"Apache Arrow Data Format",id:"apache-arrow-data-format",level:3},{value:"Request Format",id:"request-format",level:2},{value:"HTTP Method and Endpoint",id:"http-method-and-endpoint",level:3},{value:"Request Headers",id:"request-headers",level:3},{value:"Required Headers",id:"required-headers",level:4},{value:"Optional Authentication Headers",id:"optional-authentication-headers",level:4},{value:"Request Body",id:"request-body",level:3},{value:"Complete Request Example",id:"complete-request-example",level:3},{value:"Response Format",id:"response-format",level:2},{value:"Response Headers",id:"response-headers",level:3},{value:"Multipart Structure",id:"multipart-structure",level:3},{value:"Part Headers",id:"part-headers",level:3},{value:"X-Hugr-Part-Type",id:"x-hugr-part-type",level:4},{value:"X-Hugr-Format",id:"x-hugr-format",level:4},{value:"X-Hugr-Path",id:"x-hugr-path",level:4},{value:"X-Hugr-Chunk (Optional)",id:"x-hugr-chunk-optional",level:4},{value:"X-Hugr-Empty (Optional)",id:"x-hugr-empty-optional",level:4},{value:"Complete Response Example",id:"complete-response-example",level:3},{value:"Error Response",id:"error-response",level:3},{value:"Data Types",id:"data-types",level:2},{value:"GraphQL to Arrow Type Mapping",id:"graphql-to-arrow-type-mapping",level:3},{value:"Nullable vs Non-Nullable",id:"nullable-vs-non-nullable",level:3},{value:"Lists and Arrays",id:"lists-and-arrays",level:3},{value:"Nested Structures",id:"nested-structures",level:3},{value:"Geometry Types",id:"geometry-types",level:3},{value:"Top-Level Table Geometry",id:"top-level-table-geometry",level:4},{value:"Nested Table Geometry",id:"nested-table-geometry",level:4},{value:"Single Object Geometry",id:"single-object-geometry",level:4},{value:"Type Preservation Example",id:"type-preservation-example",level:3},{value:"WebSocket Streaming Protocol",id:"websocket-streaming-protocol",level:2},{value:"Connection",id:"connection",level:3},{value:"Message Types",id:"message-types",level:3},{value:"Client \u2192 Server Messages",id:"client--server-messages",level:4},{value:"1. Query Object",id:"1-query-object",level:5},{value:"2. Query",id:"2-query",level:5},{value:"3. Cancel",id:"3-cancel",level:5},{value:"Server \u2192 Client Messages",id:"server--client-messages",level:4},{value:"1. Data (Binary)",id:"1-data-binary",level:5},{value:"2. Error",id:"2-error",level:5},{value:"3. Complete",id:"3-complete",level:5},{value:"Connection Management",id:"connection-management",level:3},{value:"WebSocket Example (Python)",id:"websocket-example-python",level:3},{value:"WebSocket Example (JavaScript)",id:"websocket-example-javascript",level:3},{value:"Using with Clients",id:"using-with-clients",level:2},{value:"Python Client (hugr-client)",id:"python-client-hugr-client",level:3},{value:"Other Arrow-Compatible Clients",id:"other-arrow-compatible-clients",level:3},{value:"Direct HTTP Requests",id:"direct-http-requests",level:3},{value:"Examples",id:"examples",level:2},{value:"Example 1: Simple Query",id:"example-1-simple-query",level:3},{value:"Example 2: Query with Variables",id:"example-2-query-with-variables",level:3},{value:"Example 3: Geospatial Query",id:"example-3-geospatial-query",level:3},{value:"Example 4: Nested Data",id:"example-4-nested-data",level:3},{value:"Example 5: Streaming Large Dataset",id:"example-5-streaming-large-dataset",level:3},{value:"Example 6: Error Handling",id:"example-6-error-handling",level:3},{value:"Performance",id:"performance",level:2},{value:"Arrow IPC vs JSON Comparison",id:"arrow-ipc-vs-json-comparison",level:3},{value:"Performance Characteristics",id:"performance-characteristics",level:3},{value:"Benchmark Results",id:"benchmark-results",level:3},{value:"Best Practices for Performance",id:"best-practices-for-performance",level:3},{value:"Limitations and Known Issues",id:"limitations-and-known-issues",level:2},{value:"Current Limitations",id:"current-limitations",level:3},{value:"Known Issues",id:"known-issues",level:3},{value:"Future Enhancements",id:"future-enhancements",level:3},{value:"See Also",id:"see-also",level:2}];function o(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"hugr-ipc-protocol",children:"Hugr IPC Protocol"})}),"\n",(0,i.jsx)(n.p,{children:"The Hugr IPC (Inter-Process Communication) protocol is a custom HTTP-based protocol designed for efficient transfer of large datasets between the hugr server and clients. It uses HTTP Multipart format and Apache Arrow for high-performance data serialization, making it ideal for analytics and machine learning pipelines."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-hugr-ipc",children:"What is Hugr IPC?"}),"\n",(0,i.jsx)(n.p,{children:"Hugr IPC is a specialized protocol that:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Uses HTTP Multipart (",(0,i.jsx)(n.code,{children:"multipart/mixed"}),") for structured data transfer"]}),"\n",(0,i.jsx)(n.li,{children:"Employs Apache Arrow IPC format for efficient binary serialization"}),"\n",(0,i.jsx)(n.li,{children:"Supports streaming of large datasets via WebSocket"}),"\n",(0,i.jsxs)(n.li,{children:["Provides Python-compatible output (",(0,i.jsx)(n.code,{children:"pandas.DataFrame"})," and ",(0,i.jsx)(n.code,{children:"geopandas.GeoDataFrame"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Enables efficient transfer of tabular and geospatial data"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"why-use-a-separate-protocol",children:"Why Use a Separate Protocol?"}),"\n",(0,i.jsx)(n.p,{children:"While hugr provides a standard GraphQL API over HTTP with JSON responses, the IPC protocol offers significant advantages:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Performance Benefits"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"5-10x faster"})," serialization/deserialization compared to JSON"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Zero-copy reads"})," with Apache Arrow format"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lower memory footprint"})," for large datasets"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Efficient streaming"})," for datasets that don't fit in memory"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Type Preservation"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Native support for complex types (timestamps, decimals, nested structures)"}),"\n",(0,i.jsx)(n.li,{children:"Precise numeric types without JSON float precision issues"}),"\n",(0,i.jsx)(n.li,{children:"Direct geometry encoding (WKB for top-level, GeoJSON for nested)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Integration"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Direct compatibility with pandas and geopandas"}),"\n",(0,i.jsx)(n.li,{children:"Seamless integration with Apache Arrow ecosystem"}),"\n",(0,i.jsx)(n.li,{children:"Efficient data pipelines for analytics and ML"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-hugr-ipc",children:"When to Use Hugr IPC"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Hugr IPC when"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Working with large datasets (>1000 rows)"}),"\n",(0,i.jsx)(n.li,{children:"Building data science/ML pipelines in Python"}),"\n",(0,i.jsx)(n.li,{children:"Processing geospatial data"}),"\n",(0,i.jsx)(n.li,{children:"Streaming data in real-time"}),"\n",(0,i.jsx)(n.li,{children:"Performance is critical"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use GraphQL JSON API when"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Working with small datasets"}),"\n",(0,i.jsx)(n.li,{children:"Building web applications (JavaScript/TypeScript)"}),"\n",(0,i.jsx)(n.li,{children:"Need human-readable responses"}),"\n",(0,i.jsx)(n.li,{children:"Rapid prototyping and debugging"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"protocol-architecture",children:"Protocol Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"http-multipart-format",children:"HTTP Multipart Format"}),"\n",(0,i.jsxs)(n.p,{children:["The protocol uses HTTP Multipart (",(0,i.jsx)(n.code,{children:"multipart/mixed"}),") to combine multiple response parts in a single HTTP response. Each part contains:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Headers"})," - Metadata about the part (type, format, path)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Body"})," - Actual data (Arrow IPC stream or JSON)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This structure allows the server to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Return data and metadata together"}),"\n",(0,i.jsx)(n.li,{children:"Stream multiple result sets efficiently"}),"\n",(0,i.jsx)(n.li,{children:"Include extensions and error information"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"apache-arrow-data-format",children:"Apache Arrow Data Format"}),"\n",(0,i.jsx)(n.p,{children:"Apache Arrow is a columnar memory format designed for efficient analytics:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Columnar storage"})," - Optimized for analytical queries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Zero-copy reads"})," - Direct memory access without deserialization"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Language-agnostic"})," - Works with Python, R, Java, C++, JavaScript"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Efficient compression"})," - Built-in compression support"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type-rich"})," - Preserves data types precisely"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Arrow IPC Stream Format"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Self-describing binary format"}),"\n",(0,i.jsx)(n.li,{children:"Includes schema information"}),"\n",(0,i.jsx)(n.li,{children:"Supports streaming (multiple RecordBatch messages)"}),"\n",(0,i.jsx)(n.li,{children:"Efficient for network transfer"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"request-format",children:"Request Format"}),"\n",(0,i.jsx)(n.h3,{id:"http-method-and-endpoint",children:"HTTP Method and Endpoint"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Endpoint"}),": ",(0,i.jsx)(n.code,{children:"/ipc"})," or ",(0,i.jsx)(n.code,{children:"/graphql"})," (server-dependent)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Method"}),": ",(0,i.jsx)(n.code,{children:"POST"})]}),"\n",(0,i.jsx)(n.h3,{id:"request-headers",children:"Request Headers"}),"\n",(0,i.jsx)(n.h4,{id:"required-headers",children:"Required Headers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /ipc HTTP/1.1\nHost: hugr-server:15001\nContent-Type: application/json\n"})}),"\n",(0,i.jsx)(n.h4,{id:"optional-authentication-headers",children:"Optional Authentication Headers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"Authorization: Bearer <token>\nX-API-Key: <api-key>\nX-User-Role: <role-name>\n"})}),"\n",(0,i.jsx)(n.p,{children:"Header names can be customized via server configuration."}),"\n",(0,i.jsx)(n.h3,{id:"request-body",children:"Request Body"}),"\n",(0,i.jsx)(n.p,{children:"The request body is a JSON object containing the GraphQL query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "query": "query($limit: BigInt) { users(limit: $limit) { id name email } }",\n  "variables": {\n    "limit": 100\n  },\n  "operationName": "GetUsers"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fields"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"query"})," (string, required) - GraphQL query text"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"variables"})," (object, optional) - Query variables"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"operationName"})," (string, optional) - Operation name for named queries"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"complete-request-example",children:"Complete Request Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:15001/ipc \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer YOUR_TOKEN" \\\n  -d \'{\n    "query": "query { devices { id name status geom } }",\n    "variables": {}\n  }\'\n'})}),"\n",(0,i.jsx)(n.h2,{id:"response-format",children:"Response Format"}),"\n",(0,i.jsx)(n.h3,{id:"response-headers",children:"Response Headers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"HTTP/1.1 200 OK\nContent-Type: multipart/mixed; boundary=HUGR\nTransfer-Encoding: chunked\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"boundary=HUGR"})," parameter defines the delimiter between multipart parts."]}),"\n",(0,i.jsx)(n.h3,{id:"multipart-structure",children:"Multipart Structure"}),"\n",(0,i.jsx)(n.p,{children:"A typical response consists of multiple parts separated by the boundary marker:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"--HUGR\n<Part 1 Headers>\n\n<Part 1 Body>\n--HUGR\n<Part 2 Headers>\n\n<Part 2 Body>\n--HUGR--\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The final boundary (",(0,i.jsx)(n.code,{children:"--HUGR--"}),") marks the end of the response."]}),"\n",(0,i.jsx)(n.h3,{id:"part-headers",children:"Part Headers"}),"\n",(0,i.jsx)(n.p,{children:"Each part includes custom headers that describe its content:"}),"\n",(0,i.jsx)(n.h4,{id:"x-hugr-part-type",children:"X-Hugr-Part-Type"}),"\n",(0,i.jsx)(n.p,{children:"Identifies the type of content in this part:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data"})," - Query result data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"extensions"})," - GraphQL extensions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"error"})," - Error information"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"X-Hugr-Part-Type: data\n"})}),"\n",(0,i.jsx)(n.h4,{id:"x-hugr-format",children:"X-Hugr-Format"}),"\n",(0,i.jsx)(n.p,{children:"Specifies the encoding format:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"table"})," - Arrow IPC RecordBatch (for tabular data)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"object"})," - JSON (for scalar/object results)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"X-Hugr-Format: table\n"})}),"\n",(0,i.jsx)(n.h4,{id:"x-hugr-path",children:"X-Hugr-Path"}),"\n",(0,i.jsx)(n.p,{children:"The GraphQL query path for this data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"X-Hugr-Path: data.users\n"})}),"\n",(0,i.jsx)(n.p,{children:"For nested data, the path uses dot notation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"X-Hugr-Path: data.companies.departments.employees\n"})}),"\n",(0,i.jsx)(n.h4,{id:"x-hugr-chunk-optional",children:"X-Hugr-Chunk (Optional)"}),"\n",(0,i.jsx)(n.p,{children:"For streaming responses, identifies the chunk number:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"X-Hugr-Chunk: 0\n"})}),"\n",(0,i.jsx)(n.h4,{id:"x-hugr-empty-optional",children:"X-Hugr-Empty (Optional)"}),"\n",(0,i.jsx)(n.p,{children:"Boolean flag indicating if a table part is empty:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"X-Hugr-Empty: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"complete-response-example",children:"Complete Response Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'HTTP/1.1 200 OK\nContent-Type: multipart/mixed; boundary=HUGR\nTransfer-Encoding: chunked\n\n--HUGR\nContent-Type: application/vnd.apache.arrow.stream\nX-Hugr-Part-Type: data\nX-Hugr-Path: data.devices\nX-Hugr-Format: table\n\n<Binary Arrow IPC RecordBatch data>\n--HUGR\nContent-Type: application/json\nX-Hugr-Part-Type: extensions\nX-Hugr-Path: extensions\nX-Hugr-Format: object\n\n{"timing": {"query_ms": 45, "total_ms": 52}}\n--HUGR--\n'})}),"\n",(0,i.jsx)(n.h3,{id:"error-response",children:"Error Response"}),"\n",(0,i.jsx)(n.p,{children:"When an error occurs, the response includes an error part:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'HTTP/1.1 400 Bad Request\nContent-Type: multipart/mixed; boundary=HUGR\n\n--HUGR\nContent-Type: application/json\nX-Hugr-Part-Type: error\nX-Hugr-Format: object\n\n{"error": "Invalid query syntax: unexpected token at line 2"}\n--HUGR--\n'})}),"\n",(0,i.jsx)(n.p,{children:"Alternatively, simple errors may return plain JSON:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'HTTP/1.1 500 Internal Server Error\nContent-Type: application/json\n\n{"error": "Internal server error"}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"data-types",children:"Data Types"}),"\n",(0,i.jsx)(n.h3,{id:"graphql-to-arrow-type-mapping",children:"GraphQL to Arrow Type Mapping"}),"\n",(0,i.jsx)(n.p,{children:"DuckDB exports data using its Arrow C-API. The following table shows how Hugr GraphQL types map to Arrow types via DuckDB:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"GraphQL Type"}),(0,i.jsx)(n.th,{children:"DuckDB Type"}),(0,i.jsx)(n.th,{children:"Arrow Type"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ID"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"BIGINT"})," or ",(0,i.jsx)(n.code,{children:"VARCHAR"})]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Int64"})," or ",(0,i.jsx)(n.code,{children:"Utf8"})]}),(0,i.jsx)(n.td,{children:"Depends on actual value type"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"VARCHAR"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Utf8"})}),(0,i.jsx)(n.td,{children:"UTF-8 encoded strings"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INTEGER"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int32"})}),(0,i.jsx)(n.td,{children:"32-bit signed integer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"BigInt"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"BIGINT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int64"})}),(0,i.jsx)(n.td,{children:"64-bit signed integer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DOUBLE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float64"})}),(0,i.jsx)(n.td,{children:"64-bit floating point"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"BOOLEAN"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True/false values"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Timestamp"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TIMESTAMP"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Timestamp(Microsecond, None)"})}),(0,i.jsx)(n.td,{children:"Microsecond precision, no timezone"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Date"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DATE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Date32"})}),(0,i.jsx)(n.td,{children:"Days since epoch (1970-01-01)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Time"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TIME"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Time64(Microsecond)"})}),(0,i.jsx)(n.td,{children:"Microseconds since midnight"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Interval"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INTERVAL"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Interval(MonthDayNano)"})}),(0,i.jsx)(n.td,{children:"Months, days, and nanoseconds components"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"JSON"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"VARCHAR"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Utf8"})}),(0,i.jsx)(n.td,{children:"JSON as string"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"H3Cell"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UBIGINT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UInt64"})}),(0,i.jsx)(n.td,{children:"H3 cell index as unsigned 64-bit integer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Vector"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"FLOAT[]"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"List<Float32>"})}),(0,i.jsx)(n.td,{children:"Array of floats for embeddings"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"nullable-vs-non-nullable",children:"Nullable vs Non-Nullable"}),"\n",(0,i.jsx)(n.p,{children:"Arrow preserves GraphQL nullability:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Non-null fields"})," (",(0,i.jsx)(n.code,{children:"String!"}),") \u2192 Non-nullable Arrow field"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Nullable fields"})," (",(0,i.jsx)(n.code,{children:"String"}),") \u2192 Nullable Arrow field (with validity bitmap)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"lists-and-arrays",children:"Lists and Arrays"}),"\n",(0,i.jsx)(n.p,{children:"GraphQL lists map to Arrow List types:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"[String]"})," \u2192 ",(0,i.jsx)(n.code,{children:"List<Utf8>"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"[Int!]!"})," \u2192 ",(0,i.jsx)(n.code,{children:"List<Int32>"})," (non-null list of non-null ints)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"nested-structures",children:"Nested Structures"}),"\n",(0,i.jsx)(n.p,{children:"Nested GraphQL objects become Arrow Struct types:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"type User {\n  id: ID!\n  name: String!\n  address: Address\n}\n\ntype Address {\n  street: String\n  city: String\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Arrow representation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Struct<\n  id: Int64,\n  name: Utf8,\n  address: Struct<\n    street: Utf8,\n    city: Utf8\n  >\n>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"geometry-types",children:"Geometry Types"}),"\n",(0,i.jsx)(n.p,{children:"Hugr handles geospatial data with special encoding rules:"}),"\n",(0,i.jsx)(n.h4,{id:"top-level-table-geometry",children:"Top-Level Table Geometry"}),"\n",(0,i.jsxs)(n.p,{children:["Geometry fields at the top level of a table are encoded as ",(0,i.jsx)(n.strong,{children:"WKB (Well-Known Binary)"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"{\n  devices {\n    id\n    name\n    geom  # WKB format in Arrow Binary column\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Arrow type: ",(0,i.jsx)(n.code,{children:"Binary"})," (contains WKB bytes)"]}),"\n",(0,i.jsx)(n.p,{children:"This format is efficient and directly compatible with geopandas."}),"\n",(0,i.jsx)(n.h4,{id:"nested-table-geometry",children:"Nested Table Geometry"}),"\n",(0,i.jsxs)(n.p,{children:["Geometry fields in nested structures within tables use ",(0,i.jsx)(n.strong,{children:"GeoJSON strings"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"{\n  drivers {\n    id\n    name\n    devices {\n      id\n      geom  # GeoJSON string\n    }\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Arrow type: ",(0,i.jsx)(n.code,{children:"Utf8"})," (contains GeoJSON string)"]}),"\n",(0,i.jsx)(n.h4,{id:"single-object-geometry",children:"Single Object Geometry"}),"\n",(0,i.jsxs)(n.p,{children:["For non-tabular (object) results, all geometry is ",(0,i.jsx)(n.strong,{children:"GeoJSON"})," regardless of nesting:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"{\n  device(id: 1) {\n    id\n    geom  # GeoJSON\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Response format: JSON with GeoJSON geometry"}),"\n",(0,i.jsx)(n.h3,{id:"type-preservation-example",children:"Type Preservation Example"}),"\n",(0,i.jsx)(n.p,{children:"JSON response (loses precision):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "timestamp": "2025-01-15T10:30:45.123456",  // String representation\n  "value": 123.456789012345678  // May lose precision in JSON\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Arrow IPC (preserves types and precision):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"timestamp: Timestamp(Microsecond, None) = 1736938245123456  // DuckDB TIMESTAMP (microseconds)\nvalue: Float64 = 123.456789012345678  // Full precision maintained\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key differences"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Arrow preserves exact microsecond timestamp values as INT64"}),"\n",(0,i.jsx)(n.li,{children:"Arrow maintains full Float64 precision without JSON serialization loss"}),"\n",(0,i.jsx)(n.li,{children:"DuckDB TIMESTAMP type does not include timezone information (stored as UTC)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"websocket-streaming-protocol",children:"WebSocket Streaming Protocol"}),"\n",(0,i.jsx)(n.p,{children:"For real-time streaming of large datasets, Hugr IPC supports WebSocket connections."}),"\n",(0,i.jsx)(n.h3,{id:"connection",children:"Connection"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Endpoint"}),": ",(0,i.jsx)(n.code,{children:"ws://hugr-server:15001/stream"})," (or ",(0,i.jsx)(n.code,{children:"/ipc/stream"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Subprotocol"}),": ",(0,i.jsx)(n.code,{children:"hugr-ipc-ws"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const ws = new WebSocket('ws://localhost:15001/stream', 'hugr-ipc-ws');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"message-types",children:"Message Types"}),"\n",(0,i.jsx)(n.h4,{id:"client--server-messages",children:"Client \u2192 Server Messages"}),"\n",(0,i.jsx)(n.h5,{id:"1-query-object",children:"1. Query Object"}),"\n",(0,i.jsx)(n.p,{children:"Execute a query and stream results:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "type": "query_object",\n  "data_object": "devices",\n  "selected_fields": ["id", "name", "status"],\n  "variables": {\n    "limit": 1000\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h5,{id:"2-query",children:"2. Query"}),"\n",(0,i.jsx)(n.p,{children:"Execute a GraphQL query string:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "type": "query",\n  "query": "query { devices { id name } }"\n}\n'})}),"\n",(0,i.jsx)(n.h5,{id:"3-cancel",children:"3. Cancel"}),"\n",(0,i.jsx)(n.p,{children:"Cancel the current query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "type": "cancel"\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"server--client-messages",children:"Server \u2192 Client Messages"}),"\n",(0,i.jsx)(n.h5,{id:"1-data-binary",children:"1. Data (Binary)"}),"\n",(0,i.jsx)(n.p,{children:"Binary WebSocket message containing Arrow IPC RecordBatch."}),"\n",(0,i.jsx)(n.p,{children:"The client receives one or more binary frames, each containing an Arrow RecordBatch that can be directly processed."}),"\n",(0,i.jsx)(n.h5,{id:"2-error",children:"2. Error"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "type": "error",\n  "error": "Query execution failed: table not found"\n}\n'})}),"\n",(0,i.jsx)(n.h5,{id:"3-complete",children:"3. Complete"}),"\n",(0,i.jsx)(n.p,{children:"Indicates query has finished:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "type": "complete"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"connection-management",children:"Connection Management"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ping/Pong"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Server sends WebSocket ping frames every 30 seconds"}),"\n",(0,i.jsx)(n.li,{children:"Client must respond with pong to maintain connection"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Query Limit"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Only one active query per connection"}),"\n",(0,i.jsxs)(n.li,{children:["Must wait for ",(0,i.jsx)(n.code,{children:"complete"})," or send ",(0,i.jsx)(n.code,{children:"cancel"})," before starting new query"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Reconnection"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Connection drops are not automatically recovered"}),"\n",(0,i.jsx)(n.li,{children:"Client must implement reconnection logic"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"websocket-example-python",children:"WebSocket Example (Python)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import asyncio\nimport websockets\nimport pyarrow as pa\n\nasync def stream_data():\n    uri = "ws://localhost:15001/stream"\n\n    async with websockets.connect(uri, subprotocols=[\'hugr-ipc-ws\']) as ws:\n        # Send query\n        await ws.send(json.dumps({\n            "type": "query",\n            "query": "query { devices { id name status } }"\n        }))\n\n        # Receive data\n        while True:\n            message = await ws.recv()\n\n            if isinstance(message, bytes):\n                # Binary Arrow data\n                reader = pa.ipc.open_stream(message)\n                for batch in reader:\n                    df = batch.to_pandas()\n                    print(f"Received {len(df)} rows")\n            else:\n                # JSON message\n                msg = json.loads(message)\n                if msg.get(\'type\') == \'complete\':\n                    break\n                elif msg.get(\'type\') == \'error\':\n                    print(f"Error: {msg[\'error\']}")\n                    break\n\nasyncio.run(stream_data())\n'})}),"\n",(0,i.jsx)(n.h3,{id:"websocket-example-javascript",children:"WebSocket Example (JavaScript)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const ws = new WebSocket('ws://localhost:15001/stream', 'hugr-ipc-ws');\n\nws.onopen = () => {\n  // Send query\n  ws.send(JSON.stringify({\n    type: 'query',\n    query: '{ devices { id name status } }'\n  }));\n};\n\nws.onmessage = (event) => {\n  if (event.data instanceof Blob) {\n    // Binary Arrow data\n    event.data.arrayBuffer().then(buffer => {\n      // Use Apache Arrow JS library to parse\n      const table = arrow.Table.from(new Uint8Array(buffer));\n      console.log(`Received ${table.length} rows`);\n    });\n  } else {\n    // JSON message\n    const msg = JSON.parse(event.data);\n    if (msg.type === 'complete') {\n      console.log('Query complete');\n      ws.close();\n    } else if (msg.type === 'error') {\n      console.error('Error:', msg.error);\n    }\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"using-with-clients",children:"Using with Clients"}),"\n",(0,i.jsx)(n.h3,{id:"python-client-hugr-client",children:"Python Client (hugr-client)"}),"\n",(0,i.jsxs)(n.p,{children:["The recommended way to use Hugr IPC in Python is via the ",(0,i.jsx)(n.code,{children:"hugr-client"})," library:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import hugr\n\n# Synchronous client\nclient = hugr.Client("http://localhost:15001/ipc")\ndata = client.query("{ devices { id name geom } }")\ndf = data.df(\'data.devices\')\n\n# Streaming client\nfrom hugr.stream import connect_stream\n\nasync def stream():\n    client = connect_stream("http://localhost:15001/ipc")\n    async with await client.stream("{ devices { id name } }") as stream:\n        async for batch in stream.chunks():\n            df = batch.to_pandas()\n            print(f"Batch: {len(df)} rows")\n'})}),"\n",(0,i.jsxs)(n.p,{children:["See the ",(0,i.jsx)(n.a,{href:"/docs/querying/python-client",children:"Python Client documentation"})," for complete usage details."]}),"\n",(0,i.jsx)(n.h3,{id:"other-arrow-compatible-clients",children:"Other Arrow-Compatible Clients"}),"\n",(0,i.jsx)(n.p,{children:"Any client that can:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Parse HTTP Multipart responses"}),"\n",(0,i.jsx)(n.li,{children:"Decode Apache Arrow IPC streams"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Can use the Hugr IPC protocol."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Languages with Arrow support"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Python (PyArrow)"}),"\n",(0,i.jsx)(n.li,{children:"R (arrow package)"}),"\n",(0,i.jsx)(n.li,{children:"JavaScript/TypeScript (apache-arrow)"}),"\n",(0,i.jsx)(n.li,{children:"Java (Apache Arrow Java)"}),"\n",(0,i.jsx)(n.li,{children:"C++ (Apache Arrow C++)"}),"\n",(0,i.jsx)(n.li,{children:"Rust (arrow-rs)"}),"\n",(0,i.jsx)(n.li,{children:"Go (arrow/go)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"direct-http-requests",children:"Direct HTTP Requests"}),"\n",(0,i.jsx)(n.p,{children:"You can also use the protocol directly with standard HTTP libraries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import requests\nimport pyarrow as pa\nimport io\n\n# Send request\nresponse = requests.post(\n    'http://localhost:15001/ipc',\n    headers={'Content-Type': 'application/json'},\n    json={'query': '{ devices { id name } }'},\n    stream=True\n)\n\n# Parse multipart response\nfrom requests_toolbelt.multipart import decoder\n\nmultipart_data = decoder.MultipartDecoder.from_response(response)\n\nfor part in multipart_data.parts:\n    part_type = part.headers.get(b'X-Hugr-Part-Type').decode()\n    format_type = part.headers.get(b'X-Hugr-Format').decode()\n    path = part.headers.get(b'X-Hugr-Path').decode()\n\n    if format_type == 'table':\n        # Decode Arrow IPC\n        reader = pa.ipc.open_stream(io.BytesIO(part.content))\n        table = reader.read_all()\n        df = table.to_pandas()\n        print(f\"Table at {path}: {len(df)} rows\")\n    elif format_type == 'object':\n        # Decode JSON\n        import json\n        obj = json.loads(part.content)\n        print(f\"Object at {path}: {obj}\")\n"})}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.h3,{id:"example-1-simple-query",children:"Example 1: Simple Query"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:15001/ipc \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "query": "{ users(limit: 10) { id name email } }"\n  }\'\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'HTTP/1.1 200 OK\nContent-Type: multipart/mixed; boundary=HUGR\n\n--HUGR\nContent-Type: application/vnd.apache.arrow.stream\nX-Hugr-Part-Type: data\nX-Hugr-Path: data.users\nX-Hugr-Format: table\n\n<Arrow IPC stream with 10 rows>\n--HUGR\nContent-Type: application/json\nX-Hugr-Part-Type: extensions\nX-Hugr-Path: extensions\nX-Hugr-Format: object\n\n{"timing": {"query_ms": 12}}\n--HUGR--\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-2-query-with-variables",children:"Example 2: Query with Variables"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import requests\n\nresponse = requests.post(\n    'http://localhost:15001/ipc',\n    headers={'Content-Type': 'application/json'},\n    json={\n        'query': '''\n            query GetActiveDevices($status: String!) {\n                devices(where: {status: {_eq: $status}}) {\n                    id\n                    name\n                    last_seen\n                }\n            }\n        ''',\n        'variables': {'status': 'active'}\n    }\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-3-geospatial-query",children:"Example 3: Geospatial Query"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "query": "{ devices { id name geom } }"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"})," (conceptual):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'--HUGR\nContent-Type: application/vnd.apache.arrow.stream\nX-Hugr-Part-Type: data\nX-Hugr-Path: data.devices\nX-Hugr-Format: table\n\nArrow Table:\n- id: Int64 [1, 2, 3]\n- name: Utf8 ["Device A", "Device B", "Device C"]\n- geom: Binary [<WKB bytes>, <WKB bytes>, <WKB bytes>]\n--HUGR--\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"geom"})," column contains WKB-encoded geometry that can be directly loaded into geopandas:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import hugr\nclient = hugr.Client(\"http://localhost:15001/ipc\")\ndata = client.query(\"{ devices { id name geom } }\")\ngdf = data.gdf('data.devices', 'geom')  # Automatically decodes WKB\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-4-nested-data",children:"Example 4: Nested Data"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "query": "{ companies { id name departments { id name } } }"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),": Multiple multipart sections for different paths:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"--HUGR\nContent-Type: application/vnd.apache.arrow.stream\nX-Hugr-Part-Type: data\nX-Hugr-Path: data.companies\nX-Hugr-Format: table\n\n<Arrow table with companies>\n--HUGR\nContent-Type: application/vnd.apache.arrow.stream\nX-Hugr-Part-Type: data\nX-Hugr-Path: data.companies.departments\nX-Hugr-Format: table\n\n<Arrow table with departments (flattened)>\n--HUGR--\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-5-streaming-large-dataset",children:"Example 5: Streaming Large Dataset"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Python"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from hugr.stream import connect_stream\nimport asyncio\n\nasync def process_large_dataset():\n    client = connect_stream("http://localhost:15001/ipc")\n\n    query = """\n    query {\n        large_table {\n            id\n            data\n            timestamp\n        }\n    }\n    """\n\n    async with await client.stream(query) as stream:\n        row_count = 0\n        async for batch in stream.chunks():\n            df = batch.to_pandas()\n            row_count += len(df)\n\n            # Process batch\n            print(f"Processing batch: {len(df)} rows")\n            # ... your processing logic ...\n\n        print(f"Total rows processed: {row_count}")\n\nasyncio.run(process_large_dataset())\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-6-error-handling",children:"Example 6: Error Handling"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "query": "{ invalid_table { id name } }"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'HTTP/1.1 400 Bad Request\nContent-Type: application/json\n\n{"error": "Table \'invalid_table\' not found in schema"}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,i.jsx)(n.h3,{id:"arrow-ipc-vs-json-comparison",children:"Arrow IPC vs JSON Comparison"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metric"}),(0,i.jsx)(n.th,{children:"JSON"}),(0,i.jsx)(n.th,{children:"Arrow IPC"}),(0,i.jsx)(n.th,{children:"Improvement"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Serialization time"}),(0,i.jsx)(n.td,{children:"1000ms"}),(0,i.jsx)(n.td,{children:"150ms"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"6.7x faster"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Deserialization time"}),(0,i.jsx)(n.td,{children:"800ms"}),(0,i.jsx)(n.td,{children:"100ms"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"8x faster"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Transfer size"}),(0,i.jsx)(n.td,{children:"10MB"}),(0,i.jsx)(n.td,{children:"4MB"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"2.5x smaller"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Memory usage"}),(0,i.jsx)(n.td,{children:"25MB"}),(0,i.jsx)(n.td,{children:"12MB"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"2x less"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Type precision"}),(0,i.jsx)(n.td,{children:"Lost"}),(0,i.jsx)(n.td,{children:"Preserved"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"100%"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Benchmark: 100,000 rows with mixed types (strings, numbers, timestamps)"})}),"\n",(0,i.jsx)(n.h3,{id:"performance-characteristics",children:"Performance Characteristics"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Strengths"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Extremely fast for tabular data (columnar format)"}),"\n",(0,i.jsx)(n.li,{children:"Zero-copy reads reduce CPU and memory overhead"}),"\n",(0,i.jsx)(n.li,{children:"Efficient compression (can enable dictionary encoding)"}),"\n",(0,i.jsx)(n.li,{children:"Scales well with large datasets"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Considerations"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Small overhead for very small datasets (less than 100 rows)"}),"\n",(0,i.jsx)(n.li,{children:"Requires client-side Arrow library"}),"\n",(0,i.jsx)(n.li,{children:"Binary format (not human-readable)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"benchmark-results",children:"Benchmark Results"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Query"}),": 1 million rows with 10 columns (mix of types)"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Format"}),(0,i.jsx)(n.th,{children:"Response Time"}),(0,i.jsx)(n.th,{children:"Response Size"}),(0,i.jsx)(n.th,{children:"Client Parse Time"}),(0,i.jsx)(n.th,{children:"Total Time"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"JSON"}),(0,i.jsx)(n.td,{children:"8.5s"}),(0,i.jsx)(n.td,{children:"180MB"}),(0,i.jsx)(n.td,{children:"4.2s"}),(0,i.jsx)(n.td,{children:"12.7s"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Arrow IPC (HTTP)"}),(0,i.jsx)(n.td,{children:"1.2s"}),(0,i.jsx)(n.td,{children:"65MB"}),(0,i.jsx)(n.td,{children:"0.4s"}),(0,i.jsx)(n.td,{children:"1.6s"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Arrow IPC (WebSocket)"}),(0,i.jsx)(n.td,{children:"1.0s"}),(0,i.jsx)(n.td,{children:"65MB"}),(0,i.jsx)(n.td,{children:"0.4s"}),(0,i.jsx)(n.td,{children:"1.4s"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Improvement"}),": Arrow IPC is approximately ",(0,i.jsx)(n.strong,{children:"8x faster"})," end-to-end."]}),"\n",(0,i.jsx)(n.h3,{id:"best-practices-for-performance",children:"Best Practices for Performance"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Streaming for Large Datasets"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Good: Process data in chunks\nasync with await client.stream(query) as stream:\n    async for batch in stream.chunks():\n        process(batch)\n\n# Avoid: Load everything into memory\ndata = client.query(huge_query)  # May cause OOM\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Select Only Needed Fields"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"# Good: Specific fields\nquery { devices { id name status } }\n\n# Avoid: Selecting all fields\nquery { devices { id name status geom metadata created_at ... } }\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Server-Side Filtering"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'# Good: Filter on server\nquery {\n  devices(where: {status: {_eq: "active"}}, limit: 1000) {\n    id name\n  }\n}\n\n# Avoid: Fetching all data then filtering client-side\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Enable Compression"})," (if supported by client):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"Accept-Encoding: gzip, deflate\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Connection Pooling"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Reuse client instance\nclient = hugr.Client("http://localhost:15001/ipc")\n\nfor query in queries:\n    data = client.query(query)  # Reuses connection\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"limitations-and-known-issues",children:"Limitations and Known Issues"}),"\n",(0,i.jsx)(n.h3,{id:"current-limitations",children:"Current Limitations"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Single Query per WebSocket"}),": Only one active query allowed per WebSocket connection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No Query Resumption"}),": If connection drops, query must be restarted from beginning"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Binary Format"}),": Responses are not human-readable (use GraphQL JSON API for debugging)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Client Libraries"}),": Requires Arrow-compatible client library"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"known-issues",children:"Known Issues"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Large Nested Structures"}),": Very deeply nested GraphQL queries may have performance overhead"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mixed Geometry Types"}),": Mixing different geometry types in same field requires client handling"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Compression"}),": Not all clients support Arrow compression codecs"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,i.jsx)(n.p,{children:"Planned improvements include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Query resumption after connection drop"}),"\n",(0,i.jsx)(n.li,{children:"Multiple concurrent queries per WebSocket"}),"\n",(0,i.jsx)(n.li,{children:"Built-in compression negotiation"}),"\n",(0,i.jsx)(n.li,{children:"Enhanced error reporting with structured error codes"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"/docs/querying/python-client",children:"Python Client"})})," - Using hugr-client Python library"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"/docs/querying/graphql",children:"GraphQL API"})})," - Standard JSON GraphQL endpoint"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"/docs/overview#hugr-multipart-ipc-protocol",children:"Overview"})})," - IPC protocol overview"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://github.com/hugr-lab/query-engine/blob/main/hugr-ipc.md",children:"Protocol Specification"})})," - Technical specification"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://arrow.apache.org/",children:"Apache Arrow Documentation"})})," - Arrow format details"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://arrow.apache.org/docs/format/Columnar.html#ipc-streaming-format",children:"Apache Arrow IPC Format"})})," - IPC stream specification"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>a});var s=r(6540);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);