"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[3299],{2263:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"graphql/jq-custom-functions","title":"Custom JQ Functions","description":"Reference for hugr-specific custom JQ functions including time manipulation, query engine integration, and authentication context","source":"@site/docs/5-graphql/5-jq-custom-functions.md","sourceDirName":"5-graphql","slug":"/graphql/jq-custom-functions","permalink":"/docs/graphql/jq-custom-functions","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/5-graphql/5-jq-custom-functions.md","tags":[],"version":"current","lastUpdatedBy":"VGSML","lastUpdatedAt":1770931358000,"sidebarPosition":5,"frontMatter":{"title":"Custom JQ Functions","sidebar_position":5,"description":"Reference for hugr-specific custom JQ functions including time manipulation, query engine integration, and authentication context","keywords":["jq","custom functions","time","queryHugr","authInfo","transformations"]},"sidebar":"docsSidebar","previous":{"title":"JQ Transformations","permalink":"/docs/graphql/jq-transformations"},"next":{"title":"Query Execution & Data Retrieval","permalink":"/docs/category/query-execution--data-retrieval"}}');var t=i(4848),s=i(8453);const d={title:"Custom JQ Functions",sidebar_position:5,description:"Reference for hugr-specific custom JQ functions including time manipulation, query engine integration, and authentication context",keywords:["jq","custom functions","time","queryHugr","authInfo","transformations"]},c="Custom JQ Functions",o={},l=[{value:"Time Functions",id:"time-functions",level:2},{value:"<code>localTime</code>",id:"localtime",level:3},{value:"<code>utcTime</code>",id:"utctime",level:3},{value:"<code>unixTime</code>",id:"unixtime",level:3},{value:"<code>roundTime</code>",id:"roundtime",level:3},{value:"Named Periods",id:"named-periods",level:4},{value:"<code>timeAdd</code>",id:"timeadd",level:3},{value:"<code>datePart</code>",id:"datepart",level:3},{value:"Part Reference",id:"part-reference",level:4},{value:"Time Input Formats",id:"time-input-formats",level:3},{value:"Chaining Examples",id:"chaining-examples",level:3},{value:"Query Engine Functions",id:"query-engine-functions",level:2},{value:"<code>queryHugr</code>",id:"queryhugr",level:3},{value:"Authentication Functions",id:"authentication-functions",level:2},{value:"<code>authInfo</code>",id:"authinfo",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"custom-jq-functions",children:"Custom JQ Functions"})}),"\n",(0,t.jsxs)(n.p,{children:["Hugr extends the standard jq language with custom functions for common server-side tasks. These functions are available in all JQ contexts \u2014 inline ",(0,t.jsx)(n.code,{children:"jq()"})," queries, the ",(0,t.jsx)(n.code,{children:"/jq-query"})," REST endpoint, and ",(0,t.jsxs)(n.a,{href:"/docs/graphql/jq-transformations#_jq-variable-input-transformations",children:[(0,t.jsx)(n.code,{children:"_jq"})," variable input transformations"]}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Custom functions are organized into three categories:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"#time-functions",children:"Time Functions"})})," \u2014 get current time, round/truncate dates, add durations, extract date parts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"#query-engine-functions",children:"Query Engine Functions"})})," \u2014 execute GraphQL queries from within JQ expressions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"#authentication-functions",children:"Authentication Functions"})})," \u2014 access the current user's authentication context"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"time-functions",children:"Time Functions"}),"\n",(0,t.jsx)(n.h3,{id:"localtime",children:(0,t.jsx)(n.code,{children:"localTime"})}),"\n",(0,t.jsx)(n.p,{children:"Returns the current local time (server timezone)."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Signature"}),": ",(0,t.jsx)(n.code,{children:"localTime"})," (no arguments, no input required)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'localTime\n# "2024-06-15T16:30:45+02:00" (example, depends on server timezone)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"utctime",children:(0,t.jsx)(n.code,{children:"utcTime"})}),"\n",(0,t.jsx)(n.p,{children:"Returns the current UTC time."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Signature"}),": ",(0,t.jsx)(n.code,{children:"utcTime"})," (no arguments, no input required)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'utcTime\n# "2024-06-15T14:30:45Z"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"unixtime",children:(0,t.jsx)(n.code,{children:"unixTime"})}),"\n",(0,t.jsxs)(n.p,{children:["Converts a time value to a Unix timestamp in seconds. When the input is ",(0,t.jsx)(n.code,{children:"null"}),", returns the current UTC Unix timestamp."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Signature"}),": ",(0,t.jsx)(n.code,{children:"<time_value> | unixTime"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'"2024-06-15T14:30:45Z" | unixTime\n# 1718457045\n\n"2024-06-15T14:30:45Z" | roundTime("day"; "UTC") | unixTime\n# 1718409600\n\nnull | unixTime\n# (current UTC unix timestamp)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"roundtime",children:(0,t.jsx)(n.code,{children:"roundTime"})}),"\n",(0,t.jsx)(n.p,{children:"Truncates or rounds a time value to the given period."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Signatures"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"<time_value> | roundTime(period)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"<time_value> | roundTime(period; timezone)"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The optional ",(0,t.jsx)(n.code,{children:"timezone"})," parameter is an IANA timezone string (e.g. ",(0,t.jsx)(n.code,{children:'"America/New_York"'}),")."]}),"\n",(0,t.jsx)(n.h4,{id:"named-periods",children:"Named Periods"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Period"}),(0,t.jsx)(n.th,{children:"Result"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:'"second"'})," / ",(0,t.jsx)(n.code,{children:'"seconds"'})]}),(0,t.jsx)(n.td,{children:"Round to nearest second"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:'"minute"'})," / ",(0,t.jsx)(n.code,{children:'"minutes"'})]}),(0,t.jsx)(n.td,{children:"Round to nearest minute"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:'"hour"'})," / ",(0,t.jsx)(n.code,{children:'"hours"'})]}),(0,t.jsx)(n.td,{children:"Truncate to start of hour"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"day"'})}),(0,t.jsx)(n.td,{children:"Truncate to start of day"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:'"month"'})," / ",(0,t.jsx)(n.code,{children:'"months"'})]}),(0,t.jsx)(n.td,{children:"Truncate to first of the month"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:'"year"'})," / ",(0,t.jsx)(n.code,{children:'"years"'})]}),(0,t.jsx)(n.td,{children:"Truncate to January 1st"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:'"monday"'})," .. ",(0,t.jsx)(n.code,{children:'"saturday"'})]}),(0,t.jsx)(n.td,{children:"Truncate to the given weekday"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["Any Go ",(0,t.jsx)(n.code,{children:"time.Duration"})," string (e.g. ",(0,t.jsx)(n.code,{children:'"15m"'}),", ",(0,t.jsx)(n.code,{children:'"2h30m"'}),") is also accepted and rounds using ",(0,t.jsx)(n.code,{children:"time.Round"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'"2024-06-15T14:30:45Z" | roundTime("day")\n# "2024-06-15T00:00:00Z"\n\n"2024-06-15T14:30:45Z" | roundTime("month"; "UTC")\n# "2024-06-01T00:00:00Z"\n\n"2024-06-15T14:30:45Z" | roundTime("monday")\n# "2024-06-10T00:00:00Z" (previous Monday)\n\n"2024-06-15T14:30:45Z" | roundTime("15m")\n# "2024-06-15T14:30:00Z"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"timeadd",children:(0,t.jsx)(n.code,{children:"timeAdd"})}),"\n",(0,t.jsx)(n.p,{children:"Adds a Go duration string to a time value."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Signatures"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"<time_value> | timeAdd(duration)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"<time_value> | timeAdd(duration; timezone)"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Duration format follows Go's ",(0,t.jsx)(n.code,{children:"time.Duration"})," syntax: ",(0,t.jsx)(n.code,{children:'"1h"'}),", ",(0,t.jsx)(n.code,{children:'"30m"'}),", ",(0,t.jsx)(n.code,{children:'"2h30m"'}),", ",(0,t.jsx)(n.code,{children:'"-1h"'})," (negative to subtract)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'"2024-06-15T14:30:45Z" | timeAdd("2h")\n# "2024-06-15T16:30:45Z"\n\n"2024-06-15T14:30:45Z" | timeAdd("-30m"; "UTC")\n# "2024-06-15T14:00:45Z"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"datepart",children:(0,t.jsx)(n.code,{children:"datePart"})}),"\n",(0,t.jsx)(n.p,{children:"Extracts a component from a time value as an integer."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Signatures"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"<time_value> | datePart(part)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"<time_value> | datePart(part; timezone)"})}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"part-reference",children:"Part Reference"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Part"}),(0,t.jsx)(n.th,{children:"Returns"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"second"'})}),(0,t.jsx)(n.td,{children:"0\u201359"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"minute"'})}),(0,t.jsx)(n.td,{children:"0\u201359"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"hour"'})}),(0,t.jsx)(n.td,{children:"0\u201323"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"day"'})}),(0,t.jsx)(n.td,{children:"1\u201331"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"month"'})}),(0,t.jsx)(n.td,{children:"1\u201312"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"year"'})}),(0,t.jsx)(n.td,{children:"e.g. 2024"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"weekday"'})}),(0,t.jsx)(n.td,{children:"1 (Monday) \u2013 7 (Sunday)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"yearday"'})}),(0,t.jsx)(n.td,{children:"1\u2013366"})]})]})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'"2024-06-15T14:30:45Z" | datePart("hour")\n# 14\n\n"2024-06-15T14:30:45Z" | datePart("weekday")\n# 6 (Saturday)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"time-input-formats",children:"Time Input Formats"}),"\n",(0,t.jsx)(n.p,{children:"All time functions accept the following input formats:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Format"}),(0,t.jsx)(n.th,{children:"Example"}),(0,t.jsx)(n.th,{children:"Notes"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"RFC 3339 string"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'"2024-06-15T14:30:45Z"'})}),(0,t.jsx)(n.td,{children:"Standard date-time format"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Unix timestamp (float64)"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1718457045"})}),(0,t.jsx)(n.td,{children:"Timezone parameter applies only to this format"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"time.Time"})," value"]}),(0,t.jsxs)(n.td,{children:["Output of ",(0,t.jsx)(n.code,{children:"localTime"}),", ",(0,t.jsx)(n.code,{children:"utcTime"}),", or other time functions"]}),(0,t.jsx)(n.td,{children:"For piping/chaining"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"chaining-examples",children:"Chaining Examples"}),"\n",(0,t.jsx)(n.p,{children:"Time functions can be piped together for complex operations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'# Get start of day, then add 9 hours (business hours start)\n"2024-06-15T14:30:45Z" | roundTime("day") | timeAdd("9h") | {\n    hour: datePart("hour"),\n    day:  datePart("day")\n}\n# {"hour": 9, "day": 15}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'# Get first day of current year in UTC\nutcTime | roundTime("year"; "UTC") | {\n    month: datePart("month"; "UTC"),\n    day:   datePart("day"; "UTC")\n}\n# {"month": 1, "day": 1}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"query-engine-functions",children:"Query Engine Functions"}),"\n",(0,t.jsx)(n.h3,{id:"queryhugr",children:(0,t.jsx)(n.code,{children:"queryHugr"})}),"\n",(0,t.jsx)(n.p,{children:"Executes a GraphQL query against the hugr query engine from within a JQ expression. This enables data enrichment, lookups, and cross-referencing inside transformations."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Signatures"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"queryHugr(query)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"queryHugr(query; variables)"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The result can be bound to a variable using ",(0,t.jsx)(n.code,{children:"as"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'queryHugr("{ users { name } }").users\n# [{"name": "alice"}, {"name": "bob"}]\n\nqueryHugr("{ config { multiplier } }") as $cfg | .value * $cfg.config.multiplier\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"queryHugr"})," is extensively documented with 20+ examples in the ",(0,t.jsx)(n.a,{href:"/docs/graphql/jq-transformations#queryhugr-function-jq-only",children:"JQ Transformations \u2014 queryHugr() Function"})," section, including variable passing, the ",(0,t.jsx)(n.code,{children:"as"})," binding pattern, nested queries, and error handling."]})}),"\n",(0,t.jsx)(n.h2,{id:"authentication-functions",children:"Authentication Functions"}),"\n",(0,t.jsx)(n.h3,{id:"authinfo",children:(0,t.jsx)(n.code,{children:"authInfo"})}),"\n",(0,t.jsxs)(n.p,{children:["Returns the current authentication context as an object, or ",(0,t.jsx)(n.code,{children:"null"})," if the request is not authenticated."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Signature"}),": ",(0,t.jsx)(n.code,{children:"authInfo"})," (no arguments, no input required)"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Return structure"})," (when authenticated):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "userId": "user-123",\n  "userName": "alice",\n  "role": "admin"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"When not authenticated"}),": returns ",(0,t.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jq",children:'# Get current user\'s role\nauthInfo.role\n# "admin"\n\n# Conditional logic based on authentication\nif authInfo then\n  "Hello, " + authInfo.userName\nelse\n  "Anonymous"\nend\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>c});var r=i(6540);const t={},s=r.createContext(t);function d(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);