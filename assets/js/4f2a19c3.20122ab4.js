"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[522],{6822:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"engine-configuration/schema-definition/data-objects/relations","title":"Relations and Foreign Keys","description":"Hugr supports defining relationships between data objects using foreign key constraints. These relationships enable filtering by related data, subqueries, and cascading operations without requiring database-level foreign keys.","source":"@site/docs/4-engine-configuration/3-schema-definition/3-data-objects/7-relations.md","sourceDirName":"4-engine-configuration/3-schema-definition/3-data-objects","slug":"/engine-configuration/schema-definition/data-objects/relations","permalink":"/docs/engine-configuration/schema-definition/data-objects/relations","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/4-engine-configuration/3-schema-definition/3-data-objects/7-relations.md","tags":[],"version":"current","lastUpdatedBy":"vgsml","lastUpdatedAt":1756711778000,"sidebarPosition":7,"frontMatter":{"title":"Relations and Foreign Keys","sidebar_position":7},"sidebar":"docsSidebar","previous":{"title":"Aggregations","permalink":"/docs/engine-configuration/schema-definition/data-objects/aggregations"},"next":{"title":"Joins and Spatial Joins","permalink":"/docs/engine-configuration/schema-definition/data-objects/joins"}}');var s=i(4848),t=i(8453);const a={title:"Relations and Foreign Keys",sidebar_position:7},o="Relations and Foreign Keys",d={},l=[{value:"Field-Level Foreign Keys",id:"field-level-foreign-keys",level:2},{value:"Object-Level Foreign Keys",id:"object-level-foreign-keys",level:2},{value:"Many-to-Many Relationships",id:"many-to-many-relationships",level:2},{value:"Using Relations in Queries",id:"using-relations-in-queries",level:2},{value:"Subqueries",id:"subqueries",level:3},{value:"Filtering by Relations",id:"filtering-by-relations",level:3},{value:"Aggregating Relations",id:"aggregating-relations",level:3},{value:"Relation Options",id:"relation-options",level:2},{value:"Inner Joins",id:"inner-joins",level:3},{value:"Nested Pagination",id:"nested-pagination",level:3},{value:"Cascading Operations",id:"cascading-operations",level:2},{value:"Insert with Relations",id:"insert-with-relations",level:3},{value:"Many-to-Many Insert",id:"many-to-many-insert",level:3},{value:"Self-Referential Relations",id:"self-referential-relations",level:2},{value:"Cross-Source Relations",id:"cross-source-relations",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"N+1 Query Problem",id:"n1-query-problem",level:3},{value:"Limiting Subquery Results",id:"limiting-subquery-results",level:3},{value:"Index Requirements",id:"index-requirements",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"relations-and-foreign-keys",children:"Relations and Foreign Keys"})}),"\n",(0,s.jsx)(n.p,{children:"Hugr supports defining relationships between data objects using foreign key constraints. These relationships enable filtering by related data, subqueries, and cascading operations without requiring database-level foreign keys."}),"\n",(0,s.jsx)(n.h2,{id:"field-level-foreign-keys",children:"Field-Level Foreign Keys"}),"\n",(0,s.jsxs)(n.p,{children:["Define a foreign key on a single field using ",(0,s.jsx)(n.code,{children:"@field_references"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'type orders @table(name: "orders") {\n  id: Int! @pk\n  customer_id: Int! @field_references(\n    name: "orders_customer_fk"\n    references_name: "customers"\n    field: "id"\n    query: "customer"\n    description: "Customer who placed the order"\n    references_query: "orders"\n    references_description: "Orders placed by this customer"\n  )\n  total: Float!\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"This generates:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["A ",(0,s.jsx)(n.code,{children:"customer"})," field on ",(0,s.jsx)(n.code,{children:"orders"})," to fetch the related customer"]}),"\n",(0,s.jsxs)(n.li,{children:["An ",(0,s.jsx)(n.code,{children:"orders"})," field on ",(0,s.jsx)(n.code,{children:"customers"})," to fetch related orders"]}),"\n",(0,s.jsx)(n.li,{children:"Filter capabilities on both sides"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"object-level-foreign-keys",children:"Object-Level Foreign Keys"}),"\n",(0,s.jsxs)(n.p,{children:["For multi-field relationships, use ",(0,s.jsx)(n.code,{children:"@references"})," at the object level:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'type order_details @table(name: "order_details")\n  @references(\n    name: "order_details_supplier_product_fk"\n    references_name: "supplier_products"\n    source_fields: ["supplier_id", "product_id"]\n    references_fields: ["supplier_id", "product_id"]\n    query: "supplier_product"\n    references_query: "order_details"\n  ) {\n  id: Int! @pk\n  order_id: Int!\n  supplier_id: Int!\n  product_id: Int!\n  quantity: Int!\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"many-to-many-relationships",children:"Many-to-Many Relationships"}),"\n",(0,s.jsxs)(n.p,{children:["Define junction tables with ",(0,s.jsx)(n.code,{children:"is_m2m: true"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'type product_categories @table(name: "product_categories", is_m2m: true) {\n  product_id: Int! @pk @field_references(\n    references_name: "products"\n    field: "id"\n    query: "product"\n    references_query: "categories"\n    references_description: "Categories for this product"\n  )\n  category_id: Int! @pk @field_references(\n    references_name: "categories"\n    field: "id"\n    query: "category"\n    references_query: "products"\n    references_description: "Products in this category"\n  )\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"This creates direct relationships between products and categories:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  products {\n    id\n    name\n    categories {  # Direct access to categories\n      id\n      name\n    }\n  }\n  \n  categories {\n    id\n    name\n    products {  # Direct access to products\n      id\n      name\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"using-relations-in-queries",children:"Using Relations in Queries"}),"\n",(0,s.jsx)(n.h3,{id:"subqueries",children:"Subqueries"}),"\n",(0,s.jsx)(n.p,{children:"Fetch related data in a single query:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    orders(\n      filter: { status: { eq: "pending" } }\n      order_by: [{ field: "created_at", direction: DESC }]\n      limit: 5\n    ) {\n      id\n      total\n      order_details {\n        product {\n          name\n          price\n        }\n        quantity\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"filtering-by-relations",children:"Filtering by Relations"}),"\n",(0,s.jsx)(n.p,{children:"Filter parent records based on related data:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  # Customers with pending orders over $1000\n  customers(filter: {\n    orders: {\n      any_of: {\n        _and: [\n          { status: { eq: "pending" } }\n          { total: { gt: 1000 } }\n        ]\n      }\n    }\n  }) {\n    id\n    name\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"aggregating-relations",children:"Aggregating Relations"}),"\n",(0,s.jsx)(n.p,{children:"Aggregate related data:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    orders_aggregation {\n      _rows_count\n      total {\n        sum\n        avg\n      }\n    }\n    # Filtered aggregation\n    recent_orders: orders_aggregation(\n      filter: { created_at: { gte: "2024-01-01" } }\n    ) {\n      _rows_count\n      total {\n        sum\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"relation-options",children:"Relation Options"}),"\n",(0,s.jsx)(n.h3,{id:"inner-joins",children:"Inner Joins"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"inner: true"})," to exclude records without relations:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    orders(inner: true) {  # Only customers with orders\n      id\n      total\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"nested-pagination",children:"Nested Pagination"}),"\n",(0,s.jsx)(n.p,{children:"Control pagination at relation level:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers(limit: 10) {\n    id\n    name\n    orders(\n      nested_limit: 5\n      nested_offset: 0\n      nested_order_by: [{ field: "created_at", direction: DESC }]\n    ) {\n      id\n      created_at\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"cascading-operations",children:"Cascading Operations"}),"\n",(0,s.jsx)(n.h3,{id:"insert-with-relations",children:"Insert with Relations"}),"\n",(0,s.jsx)(n.p,{children:"Create related records in a single mutation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_customers(data: {\n    name: "New Customer"\n    email: "customer@example.com"\n    orders: [\n      {\n        total: 150.00\n        status: "pending"\n        order_details: [\n          {\n            product_id: 1\n            quantity: 2\n            unit_price: 75.00\n          }\n        ]\n      }\n    ]\n  }) {\n    id\n    orders {\n      id\n      order_details {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"many-to-many-insert",children:"Many-to-Many Insert"}),"\n",(0,s.jsx)(n.p,{children:"For M2M relationships, link existing records:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_products(data: {\n    name: "New Product"\n    price: 99.99\n    categories: [\n      { id: 1 }  # Link to existing category\n      { id: 2 }\n    ]\n  }) {\n    id\n    categories {\n      id\n      name\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"self-referential-relations",children:"Self-Referential Relations"}),"\n",(0,s.jsx)(n.p,{children:"Define hierarchical relationships:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'type employees @table(name: "employees") {\n  id: Int! @pk\n  name: String!\n  manager_id: Int @field_references(\n    references_name: "employees"\n    field: "id"\n    query: "manager"\n    references_query: "subordinates"\n    references_description: "Employees reporting to this manager"\n  )\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Query hierarchical data:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  employees {\n    id\n    name\n    manager {\n      id\n      name\n    }\n    subordinates {\n      id\n      name\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"cross-source-relations",children:"Cross-Source Relations"}),"\n",(0,s.jsxs)(n.p,{children:["Cross-source relations are not supported through ",(0,s.jsx)(n.code,{children:"@field_references"})," or ",(0,s.jsx)(n.code,{children:"@references"})," directives. To create relationships between different data sources, use the extension data source with ",(0,s.jsx)(n.code,{children:"@join"})," or ",(0,s.jsx)(n.code,{children:"@function_call"})," directives. See the ",(0,s.jsx)(n.a,{href:"/docs/engine-configuration/schema-definition/data-objects/joins",children:"Joins and Spatial Joins"})," section for details."]}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"n1-query-problem",children:"N+1 Query Problem"}),"\n",(0,s.jsx)(n.p,{children:"Hugr optimizes relation queries to avoid N+1 problems by batching subqueries."}),"\n",(0,s.jsx)(n.h3,{id:"limiting-subquery-results",children:"Limiting Subquery Results"}),"\n",(0,s.jsx)(n.p,{children:"Always limit subquery results for large datasets:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    recent_orders: orders(\n      filter: { created_at: { gte: "2024-01-01" } }\n      limit: 10\n    ) {\n      id\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"index-requirements",children:"Index Requirements"}),"\n",(0,s.jsx)(n.p,{children:"Ensure indexes exist on:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Foreign key fields"}),"\n",(0,s.jsx)(n.li,{children:"Fields used in relation filters"}),"\n",(0,s.jsx)(n.li,{children:"Fields used in relation sorting"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var r=i(6540);const s={},t=r.createContext(s);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);