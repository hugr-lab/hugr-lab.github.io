"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[4495],{4004:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"engine-configuration/access-control","title":"Access Control","description":"Hugr provides a comprehensive role-based access control (RBAC) system that allows fine-grained permissions management for GraphQL types and fields. Access control is managed through the roles and permissions tables in the core database module.","source":"@site/docs/4-engine-configuration/5-access-control.md","sourceDirName":"4-engine-configuration","slug":"/engine-configuration/access-control","permalink":"/docs/engine-configuration/access-control","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/4-engine-configuration/5-access-control.md","tags":[],"version":"current","lastUpdatedBy":"Claude","lastUpdatedAt":1762532771000,"sidebarPosition":6,"frontMatter":{"title":"Access Control","sidebar_position":6},"sidebar":"docsSidebar","previous":{"title":"Extensions & Cross-Source Subqueries","permalink":"/docs/engine-configuration/extension"},"next":{"title":"Cache Directives and Functions","permalink":"/docs/engine-configuration/cache"}}');var l=i(4848),r=i(8453);const a={title:"Access Control",sidebar_position:6},t="Access Control",d={},o=[{value:"Overview",id:"overview",level:2},{value:"Default Roles",id:"default-roles",level:2},{value:"Role Assignment",id:"role-assignment",level:2},{value:"1. API Keys",id:"1-api-keys",level:3},{value:"2. Anonymous Users",id:"2-anonymous-users",level:3},{value:"3. OAuth2/JWT Tokens",id:"3-oauth2jwt-tokens",level:3},{value:"4. OIDC Tokens",id:"4-oidc-tokens",level:3},{value:"Schema Definition",id:"schema-definition",level:2},{value:"Roles Table",id:"roles-table",level:3},{value:"Permissions Table",id:"permissions-table",level:3},{value:"Permission Behavior and Wildcards",id:"permission-behavior-and-wildcards",level:2},{value:"Default Access Behavior",id:"default-access-behavior",level:3},{value:"Wildcard Matching",id:"wildcard-matching",level:3},{value:"Default readonly Role Example",id:"default-readonly-role-example",level:4},{value:"Permission Priority",id:"permission-priority",level:3},{value:"Example: Layered Permissions",id:"example-layered-permissions",level:4},{value:"Targeted Restrictions Strategy",id:"targeted-restrictions-strategy",level:3},{value:"Creating Roles and Permissions",id:"creating-roles-and-permissions",level:2},{value:"Approach 1: Create Role with Nested Permissions (Recommended)",id:"approach-1-create-role-with-nested-permissions-recommended",level:3},{value:"Approach 2: Create Role and Permissions Separately",id:"approach-2-create-role-and-permissions-separately",level:3},{value:"Managing Roles",id:"managing-roles",level:2},{value:"Creating Roles",id:"creating-roles",level:3},{value:"Updating Roles",id:"updating-roles",level:3},{value:"Disabling Roles",id:"disabling-roles",level:3},{value:"Deleting Roles",id:"deleting-roles",level:3},{value:"Managing Permissions",id:"managing-permissions",level:2},{value:"Granting Basic Access",id:"granting-basic-access",level:3},{value:"Field-Level Permissions",id:"field-level-permissions",level:3},{value:"Wildcard Permissions",id:"wildcard-permissions",level:3},{value:"Data-Level Security",id:"data-level-security",level:2},{value:"Row-Level Filters",id:"row-level-filters",level:3},{value:"Default Values for Mutations",id:"default-values-for-mutations",level:3},{value:"Authentication Variables",id:"authentication-variables",level:2},{value:"Custom Claim Variables",id:"custom-claim-variables",level:3},{value:"Permission Flags",id:"permission-flags",level:2},{value:"Hidden Flag",id:"hidden-flag",level:3},{value:"Disabled Flag",id:"disabled-flag",level:3},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Multi-tenant Application",id:"example-1-multi-tenant-application",level:3},{value:"Example 2: Hierarchical Permissions",id:"example-2-hierarchical-permissions",level:3},{value:"Example 3: Sensitive Field Protection",id:"example-3-sensitive-field-protection",level:3},{value:"Querying Permissions",id:"querying-permissions",level:2},{value:"List All Roles",id:"list-all-roles",level:3},{value:"Check Specific Role Permissions",id:"check-specific-role-permissions",level:3},{value:"Find Permissions for a Type",id:"find-permissions-for-a-type",level:3},{value:"Permission Caching",id:"permission-caching",level:2},{value:"How Permission Caching Works",id:"how-permission-caching-works",level:3},{value:"Internal Permission Query",id:"internal-permission-query",level:3},{value:"Invalidating Permission Cache",id:"invalidating-permission-cache",level:3},{value:"Method 1: Invalidate All Role Permissions (Recommended)",id:"method-1-invalidate-all-role-permissions-recommended",level:4},{value:"Method 2: Invalidate Specific Role",id:"method-2-invalidate-specific-role",level:4},{value:"Method 3: Automatic Invalidation in Mutations",id:"method-3-automatic-invalidation-in-mutations",level:4},{value:"When to Invalidate Permission Cache",id:"when-to-invalidate-permission-cache",level:3},{value:"Performance Impact",id:"performance-impact",level:3},{value:"Example: Complete Permission Update Workflow",id:"example-complete-permission-update-workflow",level:3},{value:"Best Practices for Permission Caching",id:"best-practices-for-permission-caching",level:3},{value:"Security Considerations",id:"security-considerations",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Permission Strategy",id:"permission-strategy",level:3},{value:"Security and Maintenance",id:"security-and-maintenance",level:3},{value:"Common Patterns",id:"common-patterns",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Permission Not Applied",id:"permission-not-applied",level:3},{value:"Filter Not Working",id:"filter-not-working",level:3},{value:"Default Values Not Applied",id:"default-values-not-applied",level:3},{value:"See Also",id:"see-also",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"access-control",children:"Access Control"})}),"\n",(0,l.jsxs)(n.p,{children:["Hugr provides a comprehensive role-based access control (RBAC) system that allows fine-grained permissions management for GraphQL types and fields. Access control is managed through the ",(0,l.jsx)(n.code,{children:"roles"})," and ",(0,l.jsx)(n.code,{children:"permissions"})," tables in the core database module."]}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsx)(n.p,{children:"The access control system works by:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Assigning roles to users based on the authentication method"}),"\n",(0,l.jsx)(n.li,{children:"Defining permissions for each role to access specific GraphQL types and fields"}),"\n",(0,l.jsx)(n.li,{children:"Optionally applying filters and default values to enforce data-level security"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["All permissions are managed through the standard GraphQL API in the ",(0,l.jsx)(n.code,{children:"core"})," module."]}),"\n",(0,l.jsx)(n.h2,{id:"default-roles",children:"Default Roles"}),"\n",(0,l.jsx)(n.p,{children:"When Hugr is deployed, three default roles are automatically created:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"admin"})," - Full access to all types and fields (no restrictions)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"public"})," - Limited access for anonymous users (no default permissions; configure as needed)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"readonly"})," - Can query all data but all mutations are disabled"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"readonly"})," role is created with a single permission entry:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"INSERT INTO permissions (role, type_name, field_name, hidden, disabled)\nVALUES ('readonly', 'Mutation', '*', false, true);\n"})}),"\n",(0,l.jsx)(n.p,{children:"This configuration:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:'Allows all queries (no restrictions needed due to "open by default" behavior)'}),"\n",(0,l.jsxs)(n.li,{children:["Blocks all mutations by targeting the ",(0,l.jsx)(n.code,{children:"Mutation"})," root type with a wildcard field"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"You can customize these roles or create new ones based on your security requirements."}),"\n",(0,l.jsx)(n.h2,{id:"role-assignment",children:"Role Assignment"}),"\n",(0,l.jsx)(n.p,{children:"Roles are assigned to users based on the configured authentication scheme:"}),"\n",(0,l.jsx)(n.h3,{id:"1-api-keys",children:"1. API Keys"}),"\n",(0,l.jsx)(n.p,{children:"For API key authentication, roles are configured through:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Request headers that identify the username and user ID"}),"\n",(0,l.jsx)(n.li,{children:"Role assignment in the API key configuration"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["See ",(0,l.jsx)(n.a,{href:"/docs/deployment/auth",children:"Authentication Setup"})," for details on configuring API keys."]}),"\n",(0,l.jsx)(n.h3,{id:"2-anonymous-users",children:"2. Anonymous Users"}),"\n",(0,l.jsx)(n.p,{children:"Anonymous (unauthenticated) requests are automatically assigned a role defined in the configuration settings."}),"\n",(0,l.jsx)(n.h3,{id:"3-oauth2jwt-tokens",children:"3. OAuth2/JWT Tokens"}),"\n",(0,l.jsx)(n.p,{children:"For OAuth2 and JWT authentication, roles are determined from:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Token claims"}),"\n",(0,l.jsx)(n.li,{children:"Token scopes"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"4-oidc-tokens",children:"4. OIDC Tokens"}),"\n",(0,l.jsx)(n.p,{children:"For OpenID Connect authentication, roles are extracted from:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Token claims"}),"\n",(0,l.jsx)(n.li,{children:"Token scopes"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"schema-definition",children:"Schema Definition"}),"\n",(0,l.jsx)(n.h3,{id:"roles-table",children:"Roles Table"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"roles"})," table defines available roles in the system:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'"""\n  Roles are the permissions that can be assigned to users\n"""\ntype roles @module(name: "core")\n  @table(name: "roles") {\n  """\n    Role name\n  """\n  name: String! @pk\n  """\n    Role description\n  """\n  description: String!\n  """\n    Role disabled flag\n  """\n  disabled: Boolean @default(value: false)\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"permissions-table",children:"Permissions Table"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"role_permissions"})," table defines what each role can access:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'"""\n  Role permissions to visible and allowed types and their fields\n  that can be assigned to roles\n"""\ntype role_permissions @module(name: "core")\n  @table(name: "permissions") {\n  "Role name"\n  role: String! @pk @field_references(\n    references_name: "roles",\n    field: "name",\n    query: "role_info"\n    references_query: "permissions"\n  )\n  "Type name, can be * for all types"\n  type_name: String! @pk\n  "Field name, can be * for all fields"\n  field_name: String! @pk\n  "Hidden flag"\n  hidden: Boolean @default(value: false)\n  "Disabled flag"\n  disabled: Boolean @default(value: false)\n  "Required filter values for the field"\n  filter: JSON\n  "Required field values for the data mutation"\n  data: JSON\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"permission-behavior-and-wildcards",children:"Permission Behavior and Wildcards"}),"\n",(0,l.jsx)(n.h3,{id:"default-access-behavior",children:"Default Access Behavior"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Important:"})," If a type or field is ",(0,l.jsx)(n.strong,{children:"not found"})," in the permissions table for a role, it is ",(0,l.jsx)(n.strong,{children:"accessible by default"}),'. This "open by default" approach allows you to create targeted restrictions without explicitly listing every allowed field.']}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'# If no permissions exist for role "viewer", all types and fields are accessible\n# To restrict access, you must explicitly add permission entries\n'})}),"\n",(0,l.jsx)(n.p,{children:"This design enables two permission strategies:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Deny-by-default"})," - Block everything with wildcards, then allow specific items"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Allow-by-default"})," - Start with full access, then block specific items"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"wildcard-matching",children:"Wildcard Matching"}),"\n",(0,l.jsxs)(n.p,{children:["You can use ",(0,l.jsx)(n.code,{children:"*"})," (asterisk) in place of type names or field names to apply rules broadly:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:'type_name: "*"'})," - Applies to all GraphQL types"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:'field_name: "*"'})," - Applies to all fields of a type"]}),"\n",(0,l.jsx)(n.li,{children:"Both wildcards - Applies globally to everything"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"default-readonly-role-example",children:"Default readonly Role Example"}),"\n",(0,l.jsxs)(n.p,{children:["When Hugr creates the core database, the ",(0,l.jsx)(n.code,{children:"readonly"})," role is configured to disable all mutations:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"INSERT INTO permissions (role, type_name, field_name, hidden, disabled)\nVALUES ('readonly', 'Mutation', '*', false, true);\n"})}),"\n",(0,l.jsx)(n.p,{children:"This single entry:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Targets the ",(0,l.jsx)(n.code,{children:"Mutation"})," type (the root mutation type in GraphQL)"]}),"\n",(0,l.jsxs)(n.li,{children:["Uses ",(0,l.jsx)(n.code,{children:"*"})," for field_name to match all mutation fields"]}),"\n",(0,l.jsxs)(n.li,{children:["Sets ",(0,l.jsx)(n.code,{children:"disabled: true"})," to block all mutations"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Result: ",(0,l.jsx)(n.code,{children:"readonly"})," role can query data but cannot make any mutations."]}),"\n",(0,l.jsx)(n.h3,{id:"permission-priority",children:"Permission Priority"}),"\n",(0,l.jsxs)(n.p,{children:["When checking access, Hugr applies the ",(0,l.jsx)(n.strong,{children:"most specific"})," permission that matches:"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Priority order (highest to lowest):"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Exact match: ",(0,l.jsx)(n.code,{children:'(type_name: "users", field_name: "email")'})]}),"\n",(0,l.jsxs)(n.li,{children:["Type with wildcard field: ",(0,l.jsx)(n.code,{children:'(type_name: "users", field_name: "*")'})]}),"\n",(0,l.jsxs)(n.li,{children:["Wildcard type with exact field: ",(0,l.jsx)(n.code,{children:'(type_name: "*", field_name: "email")'})]}),"\n",(0,l.jsxs)(n.li,{children:["Both wildcards: ",(0,l.jsx)(n.code,{children:'(type_name: "*", field_name: "*")'})]}),"\n",(0,l.jsxs)(n.li,{children:["No match: ",(0,l.jsx)(n.strong,{children:"Allowed by default"})]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"example-layered-permissions",children:"Example: Layered Permissions"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {  # Mutation type for the core module\n    insert_roles(data: {  # Mutation field\n      name: "limited_editor"\n      description: "Can edit most things except sensitive data"\n      permissions: [\n        # 1. Allow all types and fields by default (least specific)\n        {\n          type_name: "*"\n          field_name: "*"\n          disabled: false\n        }\n        # 2. Hide all email fields across all types (more specific)\n        {\n          type_name: "*"\n          field_name: "email"\n          hidden: true\n        }\n        # 3. Completely block ssn field in users type (most specific)\n        {\n          type_name: "users"\n          field_name: "ssn"\n          disabled: true\n        }\n        # 4. Block all mutations (specific type, all fields)\n        {\n          type_name: "Mutation"\n          field_name: "*"\n          disabled: true\n        }\n        # 5. But allow specific update mutation (most specific wins)\n        {\n          type_name: "Mutation"\n          field_name: "update_users"\n          disabled: false\n        }\n      ]\n    }) {\n      name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Result:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Most fields are accessible"}),"\n",(0,l.jsxs)(n.li,{children:["All ",(0,l.jsx)(n.code,{children:"email"})," fields are hidden but can be explicitly requested"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"users.ssn"})," is completely blocked"]}),"\n",(0,l.jsxs)(n.li,{children:["All mutations are blocked except ",(0,l.jsx)(n.code,{children:"update_users"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"targeted-restrictions-strategy",children:"Targeted Restrictions Strategy"}),"\n",(0,l.jsx)(n.p,{children:"The most efficient approach is to use wildcards for broad rules and specific entries for exceptions:"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example: Read-only with specific write permissions"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_roles(data: {\n      name: "content_contributor"\n      description: "Can only create articles, not edit or delete"\n      permissions: [\n        # Block all mutations\n        {\n          type_name: "Mutation"\n          field_name: "*"\n          disabled: true\n        }\n        # Except insert_articles\n        {\n          type_name: "Mutation"\n          field_name: "insert_articles"\n          disabled: false\n          data: {\n            author_id: "[$auth.user_id]"\n            status: "pending"\n          }\n        }\n      ]\n    }) {\n      name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example: Hide sensitive fields by default"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_roles(data: {\n      name: "public"\n      description: "Public access with hidden PII"\n      permissions: [\n        # Hide email across all types\n        {\n          type_name: "*"\n          field_name: "email"\n          hidden: true\n        }\n        # Hide phone across all types\n        {\n          type_name: "*"\n          field_name: "phone"\n          hidden: true\n        }\n        # Completely block SSN across all types\n        {\n          type_name: "*"\n          field_name: "ssn"\n          disabled: true\n        }\n      ]\n    }) {\n      name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example: Type-level restrictions"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_roles(data: {\n      name: "external_api"\n      description: "External API with limited access"\n      permissions: [\n        # Block entire admin types\n        {\n          type_name: "admin_settings"\n          field_name: "*"\n          disabled: true\n        }\n        {\n          type_name: "internal_logs"\n          field_name: "*"\n          disabled: true\n        }\n        # Block all mutations on sensitive table\n        {\n          type_name: "Mutation"\n          field_name: "insert_user_credentials"\n          disabled: true\n        }\n        {\n          type_name: "Mutation"\n          field_name: "update_user_credentials"\n          disabled: true\n        }\n        {\n          type_name: "Mutation"\n          field_name: "delete_user_credentials"\n          disabled: true\n        }\n      ]\n    }) {\n      name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"creating-roles-and-permissions",children:"Creating Roles and Permissions"}),"\n",(0,l.jsx)(n.p,{children:"There are two approaches to setting up roles and permissions:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Create role with nested permissions"})," - Create a role and all its permissions in a single mutation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Create separately"})," - Create a role first, then add permissions individually"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"approach-1-create-role-with-nested-permissions-recommended",children:"Approach 1: Create Role with Nested Permissions (Recommended)"}),"\n",(0,l.jsx)(n.p,{children:"The most efficient way is to create a role with all its permissions at once using nested relations:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_roles(data: {\n      name: "editor"\n      description: "Content editor with limited permissions"\n      permissions: [\n        {\n          type_name: "Query"\n          field_name: "articles"\n        }\n        {\n          type_name: "Mutation"\n          field_name: "insert_articles"\n          data: {\n            author_id: "[$auth.user_id]"\n          }\n        }\n        {\n          type_name: "Mutation"\n          field_name: "update_articles"\n          filter: {\n            author_id: { eq: "[$auth.user_id]" }\n          }\n        }\n      ]\n    }) {\n      name\n      description\n      permissions {\n        type_name\n        field_name\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"This approach:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Creates the role and all permissions in a single transaction"}),"\n",(0,l.jsx)(n.li,{children:"Cleaner and more maintainable"}),"\n",(0,l.jsx)(n.li,{children:"Reduces the number of API calls"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"approach-2-create-role-and-permissions-separately",children:"Approach 2: Create Role and Permissions Separately"}),"\n",(0,l.jsx)(n.p,{children:"Alternatively, create a role first, then add permissions individually:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    # Step 1: Create the role\n    insert_roles(data: {\n      name: "editor"\n      description: "Content editor with limited permissions"\n    }) {\n      name\n    }\n\n    # Step 2: Add permissions for this role\n    perm1: insert_role_permissions(data: {\n      role: "editor"\n      type_name: "Query"\n      field_name: "articles"\n    }) {\n      role\n      type_name\n    }\n\n    perm2: insert_role_permissions(data: {\n      role: "editor"\n      type_name: "Mutation"\n      field_name: "insert_articles"\n    }) {\n      role\n      type_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"This approach is useful when:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Adding permissions to an existing role"}),"\n",(0,l.jsx)(n.li,{children:"Managing permissions incrementally"}),"\n",(0,l.jsx)(n.li,{children:"Different team members manage roles vs. permissions"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"managing-roles",children:"Managing Roles"}),"\n",(0,l.jsx)(n.h3,{id:"creating-roles",children:"Creating Roles"}),"\n",(0,l.jsx)(n.p,{children:"Create a new role using the insert mutation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_roles(data: {\n      name: "editor"\n      description: "Can edit content but not delete"\n      disabled: false\n    }) {\n      name\n      description\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"updating-roles",children:"Updating Roles"}),"\n",(0,l.jsx)(n.p,{children:"Update existing roles:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    update_roles(\n      filter: { name: { eq: "editor" } }\n      data: {\n        description: "Content editors with limited permissions"\n      }\n    ) {\n      success\n      affected_rows\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"disabling-roles",children:"Disabling Roles"}),"\n",(0,l.jsx)(n.p,{children:"Disable a role without deleting it:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    update_roles(\n      filter: { name: { eq: "editor" } }\n      data: { disabled: true }\n    ) {\n      success\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"deleting-roles",children:"Deleting Roles"}),"\n",(0,l.jsx)(n.p,{children:"Remove a role completely:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    delete_roles(\n      filter: { name: { eq: "old_role" } }\n    ) {\n      success\n      affected_rows\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"managing-permissions",children:"Managing Permissions"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Note:"})," The ",(0,l.jsx)(n.code,{children:"data"})," argument in insert mutations accepts a single object, not an array. To create multiple permissions at once, either:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:'Create a role with nested permissions (see "Creating Roles and Permissions" above)'}),"\n",(0,l.jsx)(n.li,{children:"Use multiple mutation calls with aliases in a single request"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"granting-basic-access",children:"Granting Basic Access"}),"\n",(0,l.jsx)(n.p,{children:"Grant a role access to a specific type:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_role_permissions(data: {\n      role: "editor"\n      type_name: "Query"\n      field_name: "articles"\n      hidden: false\n      disabled: false\n    }) {\n      role\n      type_name\n      field_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"field-level-permissions",children:"Field-Level Permissions"}),"\n",(0,l.jsx)(n.p,{children:"Grant access to specific fields only. You can create permissions individually:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    # Create permission for id field\n    perm1: insert_role_permissions(data: {\n      role: "public"\n      type_name: "users"\n      field_name: "id"\n    }) {\n      role\n      type_name\n      field_name\n    }\n\n    # Create permission for name field\n    perm2: insert_role_permissions(data: {\n      role: "public"\n      type_name: "users"\n      field_name: "name"\n    }) {\n      role\n      type_name\n      field_name\n    }\n\n    # Create permission for email field (hidden)\n    perm3: insert_role_permissions(data: {\n      role: "public"\n      type_name: "users"\n      field_name: "email"\n      hidden: true  # Hidden but accessible if explicitly requested\n    }) {\n      role\n      type_name\n      field_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Or create a role with all permissions at once:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_roles(data: {\n      name: "public"\n      description: "Public access role"\n      permissions: [\n        {\n          type_name: "users"\n          field_name: "id"\n        }\n        {\n          type_name: "users"\n          field_name: "name"\n        }\n        {\n          type_name: "users"\n          field_name: "email"\n          hidden: true\n        }\n      ]\n    }) {\n      name\n      permissions {\n        type_name\n        field_name\n        hidden\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"wildcard-permissions",children:"Wildcard Permissions"}),"\n",(0,l.jsx)(n.p,{children:"Use wildcards to grant broad access:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_role_permissions(data: {\n      role: "admin"\n      type_name: "*"      # All types\n      field_name: "*"     # All fields\n    }) {\n      role\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"data-level-security",children:"Data-Level Security"}),"\n",(0,l.jsx)(n.h3,{id:"row-level-filters",children:"Row-Level Filters"}),"\n",(0,l.jsx)(n.p,{children:"Apply filters that restrict which rows a role can access. Filters are automatically applied to queries, updates, and deletes."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example: Users can only see their own records"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_role_permissions(data: {\n      role: "user"\n      type_name: "Query"\n      field_name: "orders"\n      filter: {\n        user_id: { eq: "[$auth.user_id]" }\n      }\n    }) {\n      role\n      type_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["The filter uses the same format as GraphQL query filters. See ",(0,l.jsx)(n.a,{href:"/docs/graphql/queries/",children:"Queries"})," for filter syntax."]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example: Region-based access"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_role_permissions(data: {\n      role: "regional_manager"\n      type_name: "Query"\n      field_name: "stores"\n      filter: {\n        region: { eq: "[$auth.user_region]" }\n      }\n    }) {\n      role\n      type_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example: Complex filters"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_role_permissions(data: {\n      role: "moderator"\n      type_name: "Query"\n      field_name: "comments"\n      filter: {\n        _or: [\n          { author_id: { eq: "[$auth.user_id]" } }\n          { status: { eq: "pending_review" } }\n        ]\n      }\n    }) {\n      role\n      type_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"default-values-for-mutations",children:"Default Values for Mutations"}),"\n",(0,l.jsx)(n.p,{children:"Enforce default field values in insert and update mutations. These values are applied automatically and cannot be overridden by the user."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example: Auto-set ownership"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_role_permissions(data: {\n      role: "user"\n      type_name: "Mutation"\n      field_name: "insert_articles"\n      data: {\n        author_id: "[$auth.user_id]"\n        created_by: "[$auth.user_name]"\n      }\n    }) {\n      role\n      type_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example: Enforce status on updates"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_role_permissions(data: {\n      role: "editor"\n      type_name: "Mutation"\n      field_name: "update_articles"\n      data: {\n        status: "pending_review"\n        reviewed_by: null\n      }\n    }) {\n      role\n      type_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"data"})," field uses the same format as GraphQL mutation input types."]}),"\n",(0,l.jsx)(n.h2,{id:"authentication-variables",children:"Authentication Variables"}),"\n",(0,l.jsx)(n.p,{children:"Use authentication variables in filters and default values to create dynamic, user-specific permissions:"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Variable"}),(0,l.jsx)(n.th,{children:"Description"}),(0,l.jsx)(n.th,{children:"Example Value"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"[$auth.user_name]"})}),(0,l.jsx)(n.td,{children:"Username"}),(0,l.jsx)(n.td,{children:'"john.doe"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"[$auth.user_id]"})}),(0,l.jsx)(n.td,{children:"User ID (string)"}),(0,l.jsx)(n.td,{children:'"12345"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"[$auth.user_id_int]"})}),(0,l.jsx)(n.td,{children:"User ID (integer)"}),(0,l.jsx)(n.td,{children:"12345"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"[$auth.role]"})}),(0,l.jsx)(n.td,{children:"User's role"}),(0,l.jsx)(n.td,{children:'"editor"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"[$auth.auth_type]"})}),(0,l.jsx)(n.td,{children:"Authentication type"}),(0,l.jsx)(n.td,{children:'"jwt", "apikey", "oidc"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"[$auth.provider]"})}),(0,l.jsx)(n.td,{children:"Auth provider"}),(0,l.jsx)(n.td,{children:'"google", "auth0"'})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"custom-claim-variables",children:"Custom Claim Variables"}),"\n",(0,l.jsx)(n.p,{children:"You can also access custom claims from JWT/OIDC tokens:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_role_permissions(data: {\n      role: "employee"\n      type_name: "Query"\n      field_name: "departments"\n      filter: {\n        department_id: { eq: "[$auth.department_id]" }\n      }\n    }) {\n      role\n      type_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"permission-flags",children:"Permission Flags"}),"\n",(0,l.jsx)(n.h3,{id:"hidden-flag",children:"Hidden Flag"}),"\n",(0,l.jsxs)(n.p,{children:["When ",(0,l.jsx)(n.code,{children:"hidden: true"}),", the field is not returned in queries by default but can be explicitly requested:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:"# Without explicit request - email field not returned\nquery {\n  users {\n    id\n    name\n  }\n}\n\n# With explicit request - email field is returned\nquery {\n  users {\n    id\n    name\n    email  # Must be explicitly requested\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"disabled-flag",children:"Disabled Flag"}),"\n",(0,l.jsxs)(n.p,{children:["When ",(0,l.jsx)(n.code,{children:"disabled: true"}),", the field or type is completely inaccessible:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_role_permissions(data: {\n      role: "readonly"\n      type_name: "Mutation"\n      field_name: "delete_users"\n      disabled: true  # Delete mutation blocked\n    }) {\n      role\n      type_name\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,l.jsx)(n.h3,{id:"example-1-multi-tenant-application",children:"Example 1: Multi-tenant Application"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    # Create role with permissions for multi-tenant access\n    insert_roles(data: {\n      name: "tenant_user"\n      description: "User within a tenant organization"\n      permissions: [\n        {\n          type_name: "Query"\n          field_name: "customers"\n          filter: {\n            tenant_id: { eq: "[$auth.tenant_id]" }\n          }\n        }\n        {\n          type_name: "Mutation"\n          field_name: "insert_customers"\n          data: {\n            tenant_id: "[$auth.tenant_id]"\n          }\n        }\n        {\n          type_name: "Mutation"\n          field_name: "update_customers"\n          filter: {\n            tenant_id: { eq: "[$auth.tenant_id]" }\n          }\n        }\n        {\n          type_name: "Mutation"\n          field_name: "delete_customers"\n          filter: {\n            tenant_id: { eq: "[$auth.tenant_id]" }\n          }\n        }\n      ]\n    }) {\n      name\n      description\n      permissions {\n        type_name\n        field_name\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"example-2-hierarchical-permissions",children:"Example 2: Hierarchical Permissions"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    # Viewer role - read only\n    viewer: insert_roles(data: {\n      name: "viewer"\n      description: "Read-only access to articles"\n      permissions: [\n        {\n          type_name: "Query"\n          field_name: "articles"\n        }\n        {\n          type_name: "Mutation"\n          field_name: "insert_articles"\n          disabled: true\n        }\n        {\n          type_name: "Mutation"\n          field_name: "update_articles"\n          disabled: true\n        }\n        {\n          type_name: "Mutation"\n          field_name: "delete_articles"\n          disabled: true\n        }\n      ]\n    }) {\n      name\n      description\n    }\n\n    # Editor role - can create and edit own content\n    editor: insert_roles(data: {\n      name: "editor"\n      description: "Can create and edit own articles"\n      permissions: [\n        {\n          type_name: "Query"\n          field_name: "articles"\n          filter: {\n            author_id: { eq: "[$auth.user_id]" }\n          }\n        }\n        {\n          type_name: "Mutation"\n          field_name: "insert_articles"\n          data: {\n            author_id: "[$auth.user_id]"\n            status: "draft"\n          }\n        }\n        {\n          type_name: "Mutation"\n          field_name: "update_articles"\n          filter: {\n            author_id: { eq: "[$auth.user_id]" }\n          }\n        }\n        {\n          type_name: "Mutation"\n          field_name: "delete_articles"\n          filter: {\n            author_id: { eq: "[$auth.user_id]" }\n          }\n        }\n      ]\n    }) {\n      name\n      description\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"example-3-sensitive-field-protection",children:"Example 3: Sensitive Field Protection"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  core {\n    insert_roles(data: {\n      name: "public"\n      description: "Public access with field-level restrictions"\n      permissions: [\n        # Public can see basic user info\n        {\n          type_name: "users"\n          field_name: "id"\n        }\n        {\n          type_name: "users"\n          field_name: "name"\n        }\n        {\n          type_name: "users"\n          field_name: "avatar"\n        }\n        # Email hidden but accessible if explicitly requested\n        {\n          type_name: "users"\n          field_name: "email"\n          hidden: true\n        }\n        # Phone completely blocked\n        {\n          type_name: "users"\n          field_name: "phone"\n          disabled: true\n        }\n        # SSN completely blocked\n        {\n          type_name: "users"\n          field_name: "ssn"\n          disabled: true\n        }\n      ]\n    }) {\n      name\n      permissions {\n        type_name\n        field_name\n        hidden\n        disabled\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"querying-permissions",children:"Querying Permissions"}),"\n",(0,l.jsx)(n.h3,{id:"list-all-roles",children:"List All Roles"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:"query {\n  core {\n    roles {\n      name\n      description\n      disabled\n      permissions {\n        type_name\n        field_name\n        hidden\n        disabled\n      }\n    }\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-specific-role-permissions",children:"Check Specific Role Permissions"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'query {\n  core {\n    role_permissions(\n      filter: { role: { eq: "editor" } }\n    ) {\n      type_name\n      field_name\n      hidden\n      disabled\n      filter\n      data\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"find-permissions-for-a-type",children:"Find Permissions for a Type"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'query {\n  core {\n    role_permissions(\n      filter: {\n        type_name: { eq: "articles" }\n      }\n    ) {\n      role\n      field_name\n      hidden\n      disabled\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"permission-caching",children:"Permission Caching"}),"\n",(0,l.jsx)(n.p,{children:"Hugr automatically caches role permissions to improve authorization performance. When a user makes a request, their role permissions are fetched once and cached, reducing database queries on subsequent requests."}),"\n",(0,l.jsx)(n.h3,{id:"how-permission-caching-works",children:"How Permission Caching Works"}),"\n",(0,l.jsx)(n.p,{children:"Hugr caches role permissions using a specific pattern:"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Cache Key Format"}),": ",(0,l.jsx)(n.code,{children:"RolePermissions:{role_name}"}),"\n",(0,l.jsx)(n.strong,{children:"Cache Tag"}),": ",(0,l.jsx)(n.code,{children:"$role_permissions"})]}),"\n",(0,l.jsx)(n.p,{children:"When checking permissions for a role:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"First request"}),": Query the database for role permissions"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache the result"}),": Store permissions with the role-specific key"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Subsequent requests"}),": Serve permissions from cache (1-5ms vs 50-100ms)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache until TTL"}),": Default TTL of 1 hour (configurable)"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"internal-permission-query",children:"Internal Permission Query"}),"\n",(0,l.jsx)(n.p,{children:"Here's the internal query Hugr uses to fetch and cache role permissions:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'query ($role: String!, $cacheKey: String) {\n  core {\n    info: roles_by_pk(name: $role) @cache(key: $cacheKey, tags: ["$role_permissions"]) {\n      name\n      disabled\n      permissions {\n        type_name\n        field_name\n        hidden\n        disabled\n        filter\n        data\n      }\n    }\n  }\n}\n\n# Called with:\n# { role: "editor", cacheKey: "RolePermissions:editor" }\n'})}),"\n",(0,l.jsx)(n.h3,{id:"invalidating-permission-cache",children:"Invalidating Permission Cache"}),"\n",(0,l.jsx)(n.p,{children:"After modifying roles or permissions, invalidate the cache to ensure users get updated permissions immediately."}),"\n",(0,l.jsx)(n.h4,{id:"method-1-invalidate-all-role-permissions-recommended",children:"Method 1: Invalidate All Role Permissions (Recommended)"}),"\n",(0,l.jsx)(n.p,{children:"When you update permissions, invalidate all role caches:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation UpdatePermissions {\n  # Update role permissions\n  core {\n    update_role_permissions(\n      filter: { role: { eq: "editor" } }\n      data: { disabled: false }\n    ) {\n      success\n      affected_rows\n    }\n\n    # Invalidate ALL role permissions cache\n    invalidateCache: function {\n      core {\n        cache {\n          invalidate(tags: ["$role_permissions"]) {\n            success\n            affected_rows\n            message\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"method-2-invalidate-specific-role",children:"Method 2: Invalidate Specific Role"}),"\n",(0,l.jsxs)(n.p,{children:["Use ",(0,l.jsx)(n.code,{children:"@invalidate_cache"})," directive to refresh a specific role:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'query RefreshEditorPermissions {\n  core {\n    editor: roles_by_pk(name: "editor")\n      @invalidate_cache\n      @cache(\n        key: "RolePermissions:editor",\n        tags: ["$role_permissions"]\n      ) {\n      name\n      permissions {\n        type_name\n        field_name\n        disabled\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"method-3-automatic-invalidation-in-mutations",children:"Method 3: Automatic Invalidation in Mutations"}),"\n",(0,l.jsx)(n.p,{children:"Combine permission updates with cache invalidation in a single mutation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation CreateRoleWithPermissions {\n  core {\n    # Create new role\n    insert_roles(data: {\n      name: "content_manager"\n      description: "Can manage content"\n      permissions: [\n        {\n          type_name: "articles"\n          field_name: "*"\n        }\n        {\n          type_name: "insert_articles"\n          field_name: "*"\n          data: {\n            author_id: "[$auth.user_id]"\n          }\n        }\n      ]\n    }) {\n      name\n    }\n\n    # Invalidate cache so new role is immediately available\n    invalidateCache: function {\n      core {\n        cache {\n          invalidate(tags: ["$role_permissions"]) {\n            success\n            affected_rows\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"when-to-invalidate-permission-cache",children:"When to Invalidate Permission Cache"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Always invalidate cache when"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Creating new roles"}),"\n",(0,l.jsx)(n.li,{children:"Updating role permissions"}),"\n",(0,l.jsx)(n.li,{children:"Deleting roles"}),"\n",(0,l.jsxs)(n.li,{children:["Changing ",(0,l.jsx)(n.code,{children:"hidden"})," or ",(0,l.jsx)(n.code,{children:"disabled"})," flags"]}),"\n",(0,l.jsxs)(n.li,{children:["Modifying ",(0,l.jsx)(n.code,{children:"filter"})," or ",(0,l.jsx)(n.code,{children:"data"})," constraints"]}),"\n",(0,l.jsx)(n.li,{children:"Enabling/disabling roles"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"performance-impact",children:"Performance Impact"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Without Caching"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Permission check on every request: 50-100ms"}),"\n",(0,l.jsx)(n.li,{children:"High database load for multi-user systems"}),"\n",(0,l.jsx)(n.li,{children:"Slower API response times"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"With Caching"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Permission check from cache: 1-5ms"}),"\n",(0,l.jsx)(n.li,{children:"Reduced database load by 90%+"}),"\n",(0,l.jsx)(n.li,{children:"Faster API response times"}),"\n",(0,l.jsx)(n.li,{children:"Scales to thousands of concurrent users"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example-complete-permission-update-workflow",children:"Example: Complete Permission Update Workflow"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation UpdateRoleAndInvalidateCache {\n  core {\n    # 1. Update role permissions\n    update_role_permissions(\n      filter: {\n        role: { eq: "viewer" }\n        type_name: { eq: "articles" }\n      }\n      data: {\n        hidden: false\n        disabled: false\n      }\n    ) {\n      success\n      affected_rows\n    }\n\n    # 2. Invalidate permission cache\n    invalidatePermissions: function {\n      core {\n        cache {\n          invalidate(tags: ["$role_permissions"]) {\n            success\n            affected_rows\n            message\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"best-practices-for-permission-caching",children:"Best Practices for Permission Caching"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Always Invalidate After Changes"}),": Immediately invalidate cache after any permission modifications"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use Tag-Based Invalidation"}),": Use ",(0,l.jsx)(n.code,{children:"$role_permissions"})," tag to invalidate all roles at once"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Monitor Cache Effectiveness"}),": Track ",(0,l.jsx)(n.code,{children:"affected_rows"})," to ensure cache is being cleared"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Test After Updates"}),": Verify permissions work correctly after invalidation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Consider Security"}),": Stale permissions can lead to unauthorized access or denial of valid requests"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,l.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,l.jsx)(n.strong,{children:"Important"}),": Stale permission cache can cause security issues:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Privilege Escalation"}),": Users may retain permissions after they've been revoked"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Access Denial"}),": Users may be blocked from resources they should access"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Compliance Violations"}),": Cached permissions may not reflect current security policies"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Always verify invalidation succeeds"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'mutation CriticalPermissionUpdate {\n  core {\n    update_role_permissions(...) {\n      success\n    }\n\n    # Verify invalidation succeeded\n    invalidate: function {\n      core {\n        cache {\n          invalidate(tags: ["$role_permissions"]) {\n            success\n            message\n          }\n        }\n      }\n    }\n  }\n}\n\n# Check: invalidate.function.core.cache.invalidate.success === true\n'})}),"\n",(0,l.jsxs)(n.p,{children:["For more details on caching, see ",(0,l.jsx)(n.a,{href:"/docs/engine-configuration/cache#example-8-caching-role-permissions",children:"Cache Directives"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsx)(n.h3,{id:"permission-strategy",children:"Permission Strategy"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Understand Default Behavior"}),": Remember that types/fields are ",(0,l.jsx)(n.strong,{children:"accessible by default"})," if not found in permissions table"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Choose Your Strategy"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Deny-by-default"}),": Use wildcards to block everything, then explicitly allow specific items (more secure for sensitive data)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Allow-by-default"}),": Only add permission entries to block or hide specific items (simpler for most cases)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use Wildcards Effectively"}),": Wildcards are powerful for broad rules with specific exceptions","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Block all mutations: ",(0,l.jsx)(n.code,{children:'(type_name: "Mutation", field_name: "*", disabled: true)'})]}),"\n",(0,l.jsxs)(n.li,{children:["Hide PII fields: ",(0,l.jsx)(n.code,{children:'(type_name: "*", field_name: "email", hidden: true)'})]}),"\n",(0,l.jsx)(n.li,{children:"Then add specific exceptions with higher priority rules"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"security-and-maintenance",children:"Security and Maintenance"}),"\n",(0,l.jsxs)(n.ol,{start:"4",children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Principle of Least Privilege"}),": Grant only the minimum permissions required for each role"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Leverage Priority System"}),": Use layered permissions - broad wildcard rules with specific overrides"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Test Permissions"}),": Always test with different roles to ensure permissions work as expected"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Audit Regularly"}),": Periodically review role assignments and permissions"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use Authentication Variables"}),": Leverage ",(0,l.jsx)(n.code,{children:"[$auth.*]"})," variables for dynamic, user-specific permissions"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Combine Filters"}),": Use both row-level filters and field-level permissions for defense in depth"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Document Roles"}),": Maintain clear descriptions for each role's purpose and permissions"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Version Control"}),": Track permission changes in version control alongside schema changes"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Read-only access:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'permissions: [\n  { type_name: "Mutation", field_name: "*", disabled: true }\n]\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Hide sensitive fields globally:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'permissions: [\n  { type_name: "*", field_name: "ssn", disabled: true }\n  { type_name: "*", field_name: "password", disabled: true }\n  { type_name: "*", field_name: "email", hidden: true }\n]\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Allow specific mutations only:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",children:'permissions: [\n  { type_name: "Mutation", field_name: "*", disabled: true }\n  { type_name: "Mutation", field_name: "insert_articles", disabled: false }\n  { type_name: "Mutation", field_name: "update_articles", disabled: false }\n]\n'})}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.h3,{id:"permission-not-applied",children:"Permission Not Applied"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Verify the role is not disabled: ",(0,l.jsx)(n.code,{children:"roles.disabled = false"})]}),"\n",(0,l.jsxs)(n.li,{children:["Check the permission is not disabled: ",(0,l.jsx)(n.code,{children:"role_permissions.disabled = false"})]}),"\n",(0,l.jsx)(n.li,{children:"Ensure the user has the correct role assigned"}),"\n",(0,l.jsx)(n.li,{children:"Verify authentication is working correctly"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"filter-not-working",children:"Filter Not Working"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Check filter syntax matches GraphQL filter format"}),"\n",(0,l.jsx)(n.li,{children:"Verify authentication variables are available and correctly named"}),"\n",(0,l.jsx)(n.li,{children:"Test the filter independently in a query"}),"\n",(0,l.jsx)(n.li,{children:"Check for typos in field names"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"default-values-not-applied",children:"Default Values Not Applied"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Ensure the permission targets the mutation type (e.g., ",(0,l.jsx)(n.code,{children:"insert_articles"}),", not ",(0,l.jsx)(n.code,{children:"articles"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:["Verify the ",(0,l.jsx)(n.code,{children:"data"})," field uses correct input type format"]}),"\n",(0,l.jsx)(n.li,{children:"Check that authentication variables exist and have values"}),"\n",(0,l.jsx)(n.li,{children:"Confirm the field is not explicitly set by the user (defaults don't override)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/deployment/auth",children:"Authentication Setup"})," - Configure user authentication"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/engine-configuration/cache",children:"Cache Directives"})," - Role permission caching and cache invalidation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/graphql/queries/",children:"Queries"})," - Query syntax including filters"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/engine-configuration/schema-definition/data-objects/mutations",children:"Mutations"})," - Mutation operations and input types"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/engine-configuration/schema-definition/",children:"Schema Definition"})," - Define types and fields"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>t});var s=i(6540);const l={},r=s.createContext(l);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);