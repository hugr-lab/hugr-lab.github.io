"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[3705],{2284:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>l,contentTitle:()=>g,default:()=>c,frontMatter:()=>s,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"graphql/queries/aggregations","title":"Aggregations","description":"Hugr provides powerful aggregation capabilities for analyzing data. For each data object, two aggregation query types are automatically generated: single-row aggregations (aggregation) and bucket aggregations (bucket_aggregation) for grouped results.","source":"@site/docs/5-graphql/1-queries/7-aggregations.md","sourceDirName":"5-graphql/1-queries","slug":"/graphql/queries/aggregations","permalink":"/docs/graphql/queries/aggregations","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/5-graphql/1-queries/7-aggregations.md","tags":[],"version":"current","lastUpdatedBy":"Claude","lastUpdatedAt":1762461702000,"sidebarPosition":7,"frontMatter":{"title":"Aggregations","sidebar_position":7},"sidebar":"docsSidebar","previous":{"title":"Function Fields","permalink":"/docs/graphql/queries/function-fields"},"next":{"title":"Dynamic Joins (_join)","permalink":"/docs/graphql/queries/dynamic-joins"}}');var t=a(4848),i=a(8453);const s={title:"Aggregations",sidebar_position:7},g="Aggregations",l={},o=[{value:"Single Row Aggregation",id:"single-row-aggregation",level:2},{value:"Aggregation Functions by Type",id:"aggregation-functions-by-type",level:2},{value:"Numeric Fields (Int, Float, BigInt)",id:"numeric-fields-int-float-bigint",level:3},{value:"String Fields",id:"string-fields",level:3},{value:"Boolean Fields",id:"boolean-fields",level:3},{value:"Date/Timestamp Fields",id:"datetimestamp-fields",level:3},{value:"JSON/JSONB Fields",id:"jsonjsonb-fields",level:3},{value:"Filtered Aggregation",id:"filtered-aggregation",level:2},{value:"Bucket Aggregation (GROUP BY)",id:"bucket-aggregation-group-by",level:2},{value:"Grouping by Multiple Fields",id:"grouping-by-multiple-fields",level:3},{value:"Grouping by Nested Objects",id:"grouping-by-nested-objects",level:3},{value:"Sorting Aggregations",id:"sorting-aggregations",level:2},{value:"Sort by Aggregated Values",id:"sort-by-aggregated-values",level:3},{value:"Sort by Key Fields",id:"sort-by-key-fields",level:3},{value:"Sort by Multiple Aggregations",id:"sort-by-multiple-aggregations",level:3},{value:"Time-Based Aggregations",id:"time-based-aggregations",level:2},{value:"Group by Time Buckets",id:"group-by-time-buckets",level:3},{value:"Extract Time Parts",id:"extract-time-parts",level:3},{value:"Custom Time Intervals",id:"custom-time-intervals",level:3},{value:"Multiple Aggregations with Filters",id:"multiple-aggregations-with-filters",level:2},{value:"Sorting Filtered Aggregations",id:"sorting-filtered-aggregations",level:3},{value:"Nested Aggregations",id:"nested-aggregations",level:2},{value:"Aggregating Related Data",id:"aggregating-related-data",level:3},{value:"Subquery Aggregations",id:"subquery-aggregations",level:3},{value:"Filtered Subquery Aggregations",id:"filtered-subquery-aggregations",level:3},{value:"Bucket Aggregations on Relations",id:"bucket-aggregations-on-relations",level:2},{value:"Nested Bucket Aggregations",id:"nested-bucket-aggregations",level:3},{value:"Using @unnest Directive",id:"using-unnest-directive",level:2},{value:"Aggregations with Grouping by Related Fields",id:"aggregations-with-grouping-by-related-fields",level:2},{value:"Group by Foreign Key Fields",id:"group-by-foreign-key-fields",level:3},{value:"Multiple Relation Levels",id:"multiple-relation-levels",level:3},{value:"Sub-Aggregations",id:"sub-aggregations",level:2},{value:"Aggregations with _join",id:"aggregations-with-_join",level:2},{value:"Aggregations with _spatial",id:"aggregations-with-_spatial",level:2},{value:"Pagination for Bucket Aggregations",id:"pagination-for-bucket-aggregations",level:2},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"1. Apply Filters Early",id:"1-apply-filters-early",level:3},{value:"2. Limit Aggregated Data",id:"2-limit-aggregated-data",level:3},{value:"3. Limit Bucket Results",id:"3-limit-bucket-results",level:3},{value:"4. Use Indexes",id:"4-use-indexes",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Sales Dashboard",id:"sales-dashboard",level:3},{value:"Time Series Analysis",id:"time-series-analysis",level:3},{value:"Category Statistics",id:"category-statistics",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"aggregations",children:"Aggregations"})}),"\n",(0,t.jsxs)(e.p,{children:["Hugr provides powerful aggregation capabilities for analyzing data. For each data object, two aggregation query types are automatically generated: single-row aggregations (",(0,t.jsx)(e.code,{children:"<object>_aggregation"}),") and bucket aggregations (",(0,t.jsx)(e.code,{children:"<object>_bucket_aggregation"}),") for grouped results."]}),"\n",(0,t.jsx)(e.h2,{id:"single-row-aggregation",children:"Single Row Aggregation"}),"\n",(0,t.jsx)(e.p,{children:"Aggregate all matching records into a single result:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders_aggregation {\n    _rows_count\n    total {\n      sum\n      avg\n      min\n      max\n    }\n    created_at {\n      min\n      max\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"Response:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'{\n  "data": {\n    "orders_aggregation": {\n      "_rows_count": 1523,\n      "total": {\n        "sum": 152340.50,\n        "avg": 100.03,\n        "min": 5.99,\n        "max": 9999.99\n      },\n      "created_at": {\n        "min": "2023-01-01T00:00:00Z",\n        "max": "2024-03-15T23:59:59Z"\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"aggregation-functions-by-type",children:"Aggregation Functions by Type"}),"\n",(0,t.jsx)(e.h3,{id:"numeric-fields-int-float-bigint",children:"Numeric Fields (Int, Float, BigInt)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  products_aggregation {\n    price {\n      count      # Count non-null values\n      sum        # Sum of all values\n      avg        # Average value\n      min        # Minimum value\n      max        # Maximum value\n      list(distinct: true)  # Array of values\n      any        # Any non-null value\n      last       # Last non-null value\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"string-fields",children:"String Fields"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers_aggregation {\n    name {\n      count                           # Count non-null values\n      string_agg(separator: ", ")     # Concatenate with separator\n      list(distinct: true)            # Array of values\n      any                             # Any non-null value\n      last                            # Last non-null value\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"boolean-fields",children:"Boolean Fields"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  products_aggregation {\n    in_stock {\n      count       # Count non-null values\n      bool_and    # Logical AND of all values\n      bool_or     # Logical OR of all values\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"datetimestamp-fields",children:"Date/Timestamp Fields"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders_aggregation {\n    created_at {\n      count    # Count non-null values\n      min      # Earliest date/time\n      max      # Latest date/time\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"jsonjsonb-fields",children:"JSON/JSONB Fields"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  events_aggregation {\n    metadata {\n      count(path: "user_id")           # Count specific path\n      sum(path: "amount")              # Sum numeric values\n      avg(path: "score")               # Average\n      min(path: "price")               # Minimum value\n      max(path: "price")               # Maximum value\n      list(path: "tags", distinct: true)  # Array of values\n      string_agg(path: "name", separator: ", ")  # Concatenate strings\n      bool_and(path: "active")         # Logical AND\n      bool_or(path: "enabled")         # Logical OR\n      any(path: "status")              # Any non-null value\n      last(path: "status")             # Last non-null value\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"filtered-aggregation",children:"Filtered Aggregation"}),"\n",(0,t.jsx)(e.p,{children:"Apply filters before aggregating:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  orders_aggregation(\n    filter: {\n      _and: [\n        { status: { eq: "completed" } }\n        { created_at: { gte: "2024-01-01" } }\n      ]\n    }\n  ) {\n    _rows_count\n    total {\n      sum\n      avg\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"bucket-aggregation-group-by",children:"Bucket Aggregation (GROUP BY)"}),"\n",(0,t.jsx)(e.p,{children:"Group records and aggregate each group:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders_bucket_aggregation {\n    key {\n      status\n    }\n    aggregations {\n      _rows_count\n      total {\n        sum\n        avg\n        min\n        max\n      }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"Response:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'{\n  "data": {\n    "orders_bucket_aggregation": [\n      {\n        "key": { "status": "pending" },\n        "aggregations": {\n          "_rows_count": 45,\n          "total": { "sum": 4532.10, "avg": 100.71, "min": 10.00, "max": 500.00 }\n        }\n      },\n      {\n        "key": { "status": "completed" },\n        "aggregations": {\n          "_rows_count": 1234,\n          "total": { "sum": 123456.78, "avg": 100.04, "min": 5.99, "max": 9999.99 }\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"grouping-by-multiple-fields",children:"Grouping by Multiple Fields"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders_bucket_aggregation {\n    key {\n      status\n      customer {\n        country\n      }\n    }\n    aggregations {\n      _rows_count\n      total { sum }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"grouping-by-nested-objects",children:"Grouping by Nested Objects"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders_bucket_aggregation {\n    key {\n      customer {\n        category {\n          name\n        }\n        country\n      }\n    }\n    aggregations {\n      _rows_count\n      total { sum avg }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"sorting-aggregations",children:"Sorting Aggregations"}),"\n",(0,t.jsx)(e.h3,{id:"sort-by-aggregated-values",children:"Sort by Aggregated Values"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  orders_bucket_aggregation(\n    order_by: [\n      { field: "aggregations.total.sum", direction: DESC }\n    ]\n    limit: 10\n  ) {\n    key {\n      status\n    }\n    aggregations {\n      _rows_count\n      total {\n        sum  # Must be selected for sorting\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"sort-by-key-fields",children:"Sort by Key Fields"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  products_bucket_aggregation(\n    order_by: [\n      { field: "key.category.name", direction: ASC }\n      { field: "aggregations._rows_count", direction: DESC }\n    ]\n  ) {\n    key {\n      category {\n        name\n      }\n    }\n    aggregations {\n      _rows_count\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"sort-by-multiple-aggregations",children:"Sort by Multiple Aggregations"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  orders_bucket_aggregation(\n    order_by: [\n      { field: "aggregations.total.sum", direction: DESC }\n      { field: "aggregations._rows_count", direction: DESC }\n    ]\n  ) {\n    key {\n      customer_id\n    }\n    aggregations {\n      _rows_count\n      total { sum }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"time-based-aggregations",children:"Time-Based Aggregations"}),"\n",(0,t.jsx)(e.h3,{id:"group-by-time-buckets",children:"Group by Time Buckets"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders_bucket_aggregation {\n    key {\n      created_at(bucket: month)\n    }\n    aggregations {\n      _rows_count\n      total { sum avg }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"Available time buckets:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"minute"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"hour"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"day"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"week"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"month"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"quarter"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"year"})}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"extract-time-parts",children:"Extract Time Parts"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders_bucket_aggregation {\n    key {\n      year: _created_at_part(extract: year)\n      month: _created_at_part(extract: month)\n      day: _created_at_part(extract: day)\n      hour: _created_at_part(extract: hour)\n    }\n    aggregations {\n      _rows_count\n      total { sum }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"custom-time-intervals",children:"Custom Time Intervals"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  sensor_data_bucket_aggregation {\n    key {\n      timestamp(bucket_interval: "15 minutes")\n    }\n    aggregations {\n      temperature {\n        avg\n        min\n        max\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"multiple-aggregations-with-filters",children:"Multiple Aggregations with Filters"}),"\n",(0,t.jsx)(e.p,{children:"Apply different filters to different aggregations using aliases:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  products_bucket_aggregation {\n    key {\n      category {\n        name\n      }\n    }\n    # All products\n    all: aggregations {\n      _rows_count\n      price { avg }\n    }\n    # In stock only\n    in_stock: aggregations(\n      filter: { in_stock: { eq: true } }\n    ) {\n      _rows_count\n      stock_quantity { sum }\n    }\n    # On sale only\n    on_sale: aggregations(\n      filter: { discount: { gt: 0 } }\n    ) {\n      _rows_count\n      discount { avg max }\n    }\n    # Premium products (price > 100)\n    premium: aggregations(\n      filter: { price: { gt: 100 } }\n    ) {\n      _rows_count\n      price { avg min max }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"sorting-filtered-aggregations",children:"Sorting Filtered Aggregations"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  products_bucket_aggregation(\n    order_by: [\n      { field: "premium.price.avg", direction: DESC }\n    ]\n  ) {\n    key {\n      category { name }\n    }\n    premium: aggregations(\n      filter: { price: { gt: 100 } }\n    ) {\n      _rows_count\n      price { avg }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"nested-aggregations",children:"Nested Aggregations"}),"\n",(0,t.jsx)(e.h3,{id:"aggregating-related-data",children:"Aggregating Related Data"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers_aggregation {\n    _rows_count\n    # Aggregate orders through relation\n    orders {\n      _rows_count\n      total {\n        sum\n        avg\n      }\n      # Further aggregate order details\n      order_details {\n        quantity { sum }\n        unit_price { avg }\n      }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"subquery-aggregations",children:"Subquery Aggregations"}),"\n",(0,t.jsx)(e.p,{children:"Aggregate related records for each parent:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Aggregate orders for each customer\n    orders_aggregation {\n      _rows_count\n      total {\n        sum\n        avg\n      }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"filtered-subquery-aggregations",children:"Filtered Subquery Aggregations"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # All orders\n    all_orders: orders_aggregation {\n      _rows_count\n      total { sum }\n    }\n    # Recent orders only\n    recent_orders: orders_aggregation(\n      filter: {\n        created_at: { gte: "2024-01-01" }\n      }\n    ) {\n      _rows_count\n      total { sum avg }\n    }\n    # High-value orders\n    large_orders: orders_aggregation(\n      filter: { total: { gte: 1000 } }\n    ) {\n      _rows_count\n      total { sum avg }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"bucket-aggregations-on-relations",children:"Bucket Aggregations on Relations"}),"\n",(0,t.jsx)(e.p,{children:"Group and aggregate related data:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Group orders by status\n    orders_bucket_aggregation {\n      key {\n        status\n      }\n      aggregations {\n        _rows_count\n        total { sum avg }\n      }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"nested-bucket-aggregations",children:"Nested Bucket Aggregations"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Group orders by product category\n    orders_bucket_aggregation {\n      key {\n        order_details @unnest {\n          product {\n            category {\n              name\n            }\n          }\n        }\n      }\n      aggregations {\n        _rows_count\n        total { sum }\n        order_details {\n          quantity { sum }\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"using-unnest-directive",children:"Using @unnest Directive"}),"\n",(0,t.jsx)(e.p,{children:"Flatten subquery results for aggregation:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders_bucket_aggregation {\n    key {\n      customer {\n        country\n      }\n      # Flatten order_details\n      order_details @unnest {\n        product {\n          category {\n            name\n          }\n        }\n      }\n    }\n    aggregations {\n      _rows_count\n      total { sum }\n      order_details {\n        quantity { sum }\n        unit_price { avg }\n      }\n    }\n  }\n}\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Warning"}),": ",(0,t.jsx)(e.code,{children:"@unnest"})," multiplies rows like SQL JOIN. Use carefully!"]}),"\n",(0,t.jsx)(e.h2,{id:"aggregations-with-grouping-by-related-fields",children:"Aggregations with Grouping by Related Fields"}),"\n",(0,t.jsx)(e.h3,{id:"group-by-foreign-key-fields",children:"Group by Foreign Key Fields"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders_bucket_aggregation {\n    key {\n      customer {\n        id\n        name\n        country\n      }\n    }\n    aggregations {\n      _rows_count\n      total { sum avg }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"multiple-relation-levels",children:"Multiple Relation Levels"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  order_details_bucket_aggregation {\n    key {\n      product {\n        category {\n          name\n        }\n      }\n      order {\n        customer {\n          country\n        }\n      }\n    }\n    aggregations {\n      _rows_count\n      quantity { sum }\n      unit_price { avg }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"sub-aggregations",children:"Sub-Aggregations"}),"\n",(0,t.jsx)(e.p,{children:"Apply aggregation functions to aggregated results:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query {\n  regions_bucket_aggregation {\n    key {\n      region\n    }\n    aggregations {\n      # Aggregate stores\n      stores {\n        _rows_count\n      }\n      # Sub-aggregate: aggregate the aggregations\n      stores_aggregation {\n        revenue {\n          sum {\n            sum    # Sum of sums\n            avg    # Average of sums\n            min    # Minimum sum\n            max    # Maximum sum\n          }\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"aggregations-with-_join",children:"Aggregations with _join"}),"\n",(0,t.jsx)(e.p,{children:"Aggregate dynamically joined data:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  products_aggregation {\n    _rows_count\n    price { avg }\n    # Dynamically join and aggregate reviews\n    _join(fields: ["id"]) {\n      reviews(fields: ["product_id"]) {\n        _rows_count\n        rating { avg }\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:"Bucket aggregation with _join:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  products_bucket_aggregation {\n    key {\n      category { name }\n    }\n    aggregations {\n      _rows_count\n      price { avg }\n      _join(fields: ["id"]) {\n        reviews_aggregation(fields: ["product_id"]) {\n          _rows_count\n          rating { avg }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"aggregations-with-_spatial",children:"Aggregations with _spatial"}),"\n",(0,t.jsx)(e.p,{children:"Aggregate spatially related records:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  cities_aggregation {\n    _rows_count\n    population { sum avg }\n    # Aggregate nearby locations\n    _spatial(field: "boundary", type: CONTAINS) {\n      locations(field: "point") {\n        _rows_count\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:"Bucket aggregation with spatial:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  regions_bucket_aggregation {\n    key {\n      region_type\n    }\n    aggregations {\n      _rows_count\n      area { sum }\n      _spatial(field: "boundary", type: CONTAINS) {\n        businesses_aggregation(field: "location") {\n          _rows_count\n        }\n        businesses_bucket_aggregation(field: "location") {\n          key {\n            business_type\n          }\n          aggregations {\n            _rows_count\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"pagination-for-bucket-aggregations",children:"Pagination for Bucket Aggregations"}),"\n",(0,t.jsx)(e.p,{children:"Limit and offset bucket results:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query {\n  orders_bucket_aggregation(\n    order_by: [\n      { field: "aggregations.total.sum", direction: DESC }\n    ]\n    limit: 10\n    offset: 0\n  ) {\n    key {\n      customer_id\n    }\n    aggregations {\n      _rows_count\n      total { sum }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,t.jsx)(e.h3,{id:"1-apply-filters-early",children:"1. Apply Filters Early"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'# Good - Filter before aggregation\nquery {\n  orders_aggregation(\n    filter: {\n      created_at: { gte: "2024-01-01" }\n    }\n  ) {\n    _rows_count\n    total { sum }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"2-limit-aggregated-data",children:"2. Limit Aggregated Data"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'# Use filters to reduce dataset\nquery {\n  large_table_aggregation(\n    filter: {\n      created_at: { gte: "2024-01-01" }\n    }\n    limit: 100000\n  ) {\n    _rows_count\n    amount { sum }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"3-limit-bucket-results",children:"3. Limit Bucket Results"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'# Return only top N groups\nquery {\n  orders_bucket_aggregation(\n    order_by: [\n      { field: "aggregations.total.sum", direction: DESC }\n    ]\n    limit: 100\n  ) {\n    key { customer_id }\n    aggregations {\n      total { sum }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"4-use-indexes",children:"4. Use Indexes"}),"\n",(0,t.jsx)(e.p,{children:"Ensure indexes on:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Fields used in GROUP BY (key fields)"}),"\n",(0,t.jsx)(e.li,{children:"Fields used in filters"}),"\n",(0,t.jsx)(e.li,{children:"Fields used in ORDER BY"}),"\n",(0,t.jsx)(e.li,{children:"Foreign key fields in relations"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,t.jsx)(e.h3,{id:"sales-dashboard",children:"Sales Dashboard"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query SalesDashboard {\n  # Total sales\n  orders_aggregation(\n    filter: { status: { eq: "completed" } }\n  ) {\n    _rows_count\n    total { sum avg }\n  }\n\n  # Sales by status\n  orders_bucket_aggregation {\n    key {\n      status\n    }\n    aggregations {\n      _rows_count\n      total { sum }\n    }\n  }\n\n  # Top customers\n  orders_bucket_aggregation(\n    order_by: [\n      { field: "aggregations.total.sum", direction: DESC }\n    ]\n    limit: 10\n  ) {\n    key {\n      customer {\n        id\n        name\n      }\n    }\n    aggregations {\n      _rows_count\n      total { sum }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"time-series-analysis",children:"Time Series Analysis"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:'query TimeSeries {\n  orders_bucket_aggregation(\n    filter: {\n      created_at: { gte: "2024-01-01" }\n    }\n  ) {\n    key {\n      date: created_at(bucket: day)\n    }\n    aggregations {\n      _rows_count\n      total { sum avg }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"category-statistics",children:"Category Statistics"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-graphql",children:"query CategoryStats {\n  products_bucket_aggregation {\n    key {\n      category {\n        name\n      }\n    }\n    aggregations {\n      _rows_count\n      price { avg min max }\n      in_stock: aggregations(\n        filter: { in_stock: { eq: true } }\n      ) {\n        _rows_count\n      }\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Learn about ",(0,t.jsx)(e.a,{href:"/docs/graphql/queries/dynamic-joins",children:"Dynamic Joins"})," for ad-hoc query-time joins"]}),"\n",(0,t.jsxs)(e.li,{children:["See ",(0,t.jsx)(e.a,{href:"/docs/graphql/queries/spatial",children:"Spatial Queries"})," for geographic aggregations"]}),"\n",(0,t.jsxs)(e.li,{children:["Check ",(0,t.jsx)(e.a,{href:"/docs/graphql/queries/filtering",children:"Filtering"})," for complex aggregation filters"]}),"\n"]})]})}function c(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,e,a)=>{a.d(e,{R:()=>s,x:()=>g});var r=a(6540);const t={},i=r.createContext(t);function s(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function g(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:s(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);