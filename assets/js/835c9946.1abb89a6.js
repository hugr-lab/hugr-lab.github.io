"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[2184],{7618:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"graphql/queries/relations","title":"Relations & Subqueries","description":"Hugr automatically generates relation fields based on foreign keys defined with @field_references and @references directives. These fields allow you to fetch related data in a single query, avoiding N+1 query problems and enabling complex data retrieval patterns.","source":"@site/docs/5-graphql/1-queries/5-relations.md","sourceDirName":"5-graphql/1-queries","slug":"/graphql/queries/relations","permalink":"/docs/graphql/queries/relations","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/5-graphql/1-queries/5-relations.md","tags":[],"version":"current","lastUpdatedBy":"Claude","lastUpdatedAt":1762461702000,"sidebarPosition":5,"frontMatter":{"title":"Relations & Subqueries","sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Sorting & Pagination","permalink":"/docs/graphql/queries/sorting-pagination"},"next":{"title":"Function Fields","permalink":"/docs/graphql/queries/function-fields"}}');var s=r(4848),t=r(8453);const a={title:"Relations & Subqueries",sidebar_position:5},l="Relations & Subqueries",d={},o=[{value:"Basic Relations",id:"basic-relations",level:2},{value:"One-to-One Relations",id:"one-to-one-relations",level:3},{value:"One-to-Many Relations",id:"one-to-many-relations",level:3},{value:"Many-to-Many Relations",id:"many-to-many-relations",level:3},{value:"Filtering Subqueries",id:"filtering-subqueries",level:2},{value:"Filter Related Records",id:"filter-related-records",level:3},{value:"Complex Subquery Filters",id:"complex-subquery-filters",level:3},{value:"Filter by Nested Relations",id:"filter-by-nested-relations",level:3},{value:"Sorting Subqueries",id:"sorting-subqueries",level:2},{value:"order_by for Subqueries",id:"order_by-for-subqueries",level:3},{value:"Sort by Related Fields",id:"sort-by-related-fields",level:3},{value:"nested_order_by",id:"nested_order_by",level:3},{value:"Limiting Subqueries",id:"limiting-subqueries",level:2},{value:"Basic Limit",id:"basic-limit",level:3},{value:"nested_limit and nested_offset",id:"nested_limit-and-nested_offset",level:3},{value:"Nested Relations",id:"nested-relations",level:2},{value:"Multi-Level Nesting",id:"multi-level-nesting",level:3},{value:"Filtering Nested Relations",id:"filtering-nested-relations",level:3},{value:"Aggregating Related Data",id:"aggregating-related-data",level:2},{value:"Single Row Aggregation",id:"single-row-aggregation",level:3},{value:"Filtered Aggregation",id:"filtered-aggregation",level:3},{value:"Nested Aggregations",id:"nested-aggregations",level:3},{value:"Bucket Aggregation on Relations",id:"bucket-aggregation-on-relations",level:3},{value:"Complex Bucket Aggregations",id:"complex-bucket-aggregations",level:3},{value:"Predefined Joins",id:"predefined-joins",level:2},{value:"Custom Join Fields",id:"custom-join-fields",level:3},{value:"Complex Join Conditions",id:"complex-join-conditions",level:3},{value:"Aggregating Custom Joins",id:"aggregating-custom-joins",level:3},{value:"Table Function Joins",id:"table-function-joins",level:2},{value:"Using @table_function_call_join",id:"using-table_function_call_join",level:3},{value:"Limitations",id:"limitations",level:3},{value:"Alternative: Parameterized Views",id:"alternative-parameterized-views",level:3},{value:"Inner Joins",id:"inner-joins",level:2},{value:"Basic INNER JOIN",id:"basic-inner-join",level:3},{value:"Combining with Filters",id:"combining-with-filters",level:3},{value:"Multiple INNER JOINs",id:"multiple-inner-joins",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"Self-Referential Relations",id:"self-referential-relations",level:2},{value:"Hierarchical Data",id:"hierarchical-data",level:3},{value:"Multi-Level Hierarchies",id:"multi-level-hierarchies",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"1. Always Limit Subqueries",id:"1-always-limit-subqueries",level:3},{value:"2. Use Aggregations Instead",id:"2-use-aggregations-instead",level:3},{value:"3. Filter Early",id:"3-filter-early",level:3},{value:"4. Select Only Required Fields",id:"4-select-only-required-fields",level:3},{value:"5. Use Batch Loading",id:"5-use-batch-loading",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Master-Detail View",id:"master-detail-view",level:3},{value:"Recent Activity",id:"recent-activity",level:3},{value:"Dashboard Statistics",id:"dashboard-statistics",level:3},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"relations--subqueries",children:"Relations & Subqueries"})}),"\n",(0,s.jsxs)(n.p,{children:["Hugr automatically generates relation fields based on foreign keys defined with ",(0,s.jsx)(n.code,{children:"@field_references"})," and ",(0,s.jsx)(n.code,{children:"@references"})," directives. These fields allow you to fetch related data in a single query, avoiding N+1 query problems and enabling complex data retrieval patterns."]}),"\n",(0,s.jsx)(n.h2,{id:"basic-relations",children:"Basic Relations"}),"\n",(0,s.jsx)(n.h3,{id:"one-to-one-relations",children:"One-to-One Relations"}),"\n",(0,s.jsx)(n.p,{children:"Fetch a single related record:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  orders {\n    id\n    total\n    # One-to-one: each order has one customer\n    customer {\n      id\n      name\n      email\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"one-to-many-relations",children:"One-to-Many Relations"}),"\n",(0,s.jsx)(n.p,{children:"Fetch multiple related records:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # One-to-many: each customer has many orders\n    orders {\n      id\n      total\n      created_at\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"many-to-many-relations",children:"Many-to-Many Relations"}),"\n",(0,s.jsx)(n.p,{children:"Access related records through junction tables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  products {\n    id\n    name\n    # Many-to-many through product_categories junction\n    categories {\n      id\n      name\n      description\n    }\n  }\n\n  categories {\n    id\n    name\n    # Reverse many-to-many\n    products {\n      id\n      name\n      price\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"filtering-subqueries",children:"Filtering Subqueries"}),"\n",(0,s.jsx)(n.h3,{id:"filter-related-records",children:"Filter Related Records"}),"\n",(0,s.jsx)(n.p,{children:"Apply filters to subqueries:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # Only pending orders\n    pending_orders: orders(\n      filter: { status: { eq: "pending" } }\n    ) {\n      id\n      status\n      total\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"complex-subquery-filters",children:"Complex Subquery Filters"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # High-value recent orders\n    important_orders: orders(\n      filter: {\n        _and: [\n          { total: { gte: 1000 } }\n          { created_at: { gte: "2024-01-01" } }\n          { status: { in: ["pending", "processing"] } }\n        ]\n      }\n    ) {\n      id\n      total\n      created_at\n      status\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"filter-by-nested-relations",children:"Filter by Nested Relations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # Orders containing electronic products\n    electronics_orders: orders(\n      filter: {\n        order_details: {\n          any_of: {\n            product: {\n              category: { name: { eq: "Electronics" } }\n            }\n          }\n        }\n      }\n    ) {\n      id\n      total\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"sorting-subqueries",children:"Sorting Subqueries"}),"\n",(0,s.jsx)(n.h3,{id:"order_by-for-subqueries",children:"order_by for Subqueries"}),"\n",(0,s.jsx)(n.p,{children:"Sort related records:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # Most recent orders first\n    orders(\n      order_by: [{ field: "created_at", direction: DESC }]\n    ) {\n      id\n      created_at\n      total\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"sort-by-related-fields",children:"Sort by Related Fields"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  orders {\n    id\n    total\n    # Order details sorted by product name\n    order_details(\n      order_by: [{ field: "product.name", direction: ASC }]\n    ) {\n      quantity\n      product {\n        name\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"nested_order_by",children:"nested_order_by"}),"\n",(0,s.jsx)(n.p,{children:"Sort after the join is performed:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers(limit: 10) {\n    id\n    name\n    orders(\n      nested_order_by: [{ field: "total", direction: DESC }]\n      nested_limit: 5\n    ) {\n      id\n      total\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Difference between ",(0,s.jsx)(n.code,{children:"order_by"})," and ",(0,s.jsx)(n.code,{children:"nested_order_by"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"order_by"})," - Applied before join (to the orders table)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"nested_order_by"})," - Applied after join (to orders for each customer)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"limiting-subqueries",children:"Limiting Subqueries"}),"\n",(0,s.jsx)(n.h3,{id:"basic-limit",children:"Basic Limit"}),"\n",(0,s.jsx)(n.p,{children:"Limit the number of related records:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # Only last 5 orders\n    recent_orders: orders(\n      order_by: [{ field: "created_at", direction: DESC }]\n      limit: 5\n    ) {\n      id\n      created_at\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"nested_limit-and-nested_offset",children:"nested_limit and nested_offset"}),"\n",(0,s.jsx)(n.p,{children:"Control pagination per parent record:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # 5 orders per customer, skip first 10\n    orders(\n      nested_order_by: [{ field: "created_at", direction: DESC }]\n      nested_limit: 5\n      nested_offset: 10\n    ) {\n      id\n      created_at\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"nested-relations",children:"Nested Relations"}),"\n",(0,s.jsx)(n.h3,{id:"multi-level-nesting",children:"Multi-Level Nesting"}),"\n",(0,s.jsx)(n.p,{children:"Query through multiple relation levels:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    orders {\n      id\n      total\n      order_details {\n        quantity\n        unit_price\n        product {\n          id\n          name\n          category {\n            id\n            name\n          }\n        }\n      }\n      shipper {\n        name\n        phone\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"filtering-nested-relations",children:"Filtering Nested Relations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    orders(\n      filter: { status: { eq: "completed" } }\n    ) {\n      id\n      status\n      order_details(\n        filter: {\n          product: {\n            category: { name: { eq: "Electronics" } }\n          }\n        }\n      ) {\n        quantity\n        product {\n          name\n          category {\n            name\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"aggregating-related-data",children:"Aggregating Related Data"}),"\n",(0,s.jsx)(n.h3,{id:"single-row-aggregation",children:"Single Row Aggregation"}),"\n",(0,s.jsx)(n.p,{children:"Get aggregated statistics for related records:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Aggregate all orders\n    orders_aggregation {\n      _rows_count\n      total {\n        sum\n        avg\n        min\n        max\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"filtered-aggregation",children:"Filtered Aggregation"}),"\n",(0,s.jsx)(n.p,{children:"Aggregate with filters:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # All orders stats\n    all_orders: orders_aggregation {\n      _rows_count\n      total { sum }\n    }\n    # Only completed orders\n    completed_orders: orders_aggregation(\n      filter: { status: { eq: "completed" } }\n    ) {\n      _rows_count\n      total { sum }\n    }\n    # High-value orders\n    large_orders: orders_aggregation(\n      filter: { total: { gte: 1000 } }\n    ) {\n      _rows_count\n      total { sum avg }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"nested-aggregations",children:"Nested Aggregations"}),"\n",(0,s.jsx)(n.p,{children:"Aggregate through multiple levels:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Aggregate orders and their details\n    orders_aggregation {\n      _rows_count\n      total { sum }\n      # Aggregate order details within orders\n      order_details {\n        quantity { sum }\n        unit_price { avg }\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"bucket-aggregation-on-relations",children:"Bucket Aggregation on Relations"}),"\n",(0,s.jsx)(n.p,{children:"Group and aggregate related data:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Group orders by status\n    orders_bucket_aggregation {\n      key {\n        status\n      }\n      aggregations {\n        _rows_count\n        total {\n          sum\n          avg\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"complex-bucket-aggregations",children:"Complex Bucket Aggregations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Group orders by product category\n    orders_bucket_aggregation {\n      key {\n        order_details @unnest {\n          product {\n            category {\n              name\n            }\n          }\n        }\n      }\n      aggregations {\n        _rows_count\n        total { sum }\n        order_details {\n          quantity { sum }\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"predefined-joins",children:"Predefined Joins"}),"\n",(0,s.jsx)(n.h3,{id:"custom-join-fields",children:"Custom Join Fields"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"@join"})," directive for custom join conditions:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# Schema definition\nextend type customers {\n  # Spatial join\n  nearby_stores: [stores] @join(\n    references_name: "stores"\n    sql: "ST_DWithin([source.location], [dest.location], 5000)"\n  )\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Query custom joins:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    location\n    # Stores within 5km\n    nearby_stores {\n      id\n      name\n      location\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important:"})," Predefined joins created with ",(0,s.jsx)(n.code,{children:"@join"})," directive cannot be used in filter conditions. To restrict parent records based on join results, use ",(0,s.jsx)(n.code,{children:"inner: true"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Only customers with nearby stores\n    nearby_stores(inner: true) {\n      id\n      name\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This returns only customers who have at least one store within 5km."}),"\n",(0,s.jsx)(n.h3,{id:"complex-join-conditions",children:"Complex Join Conditions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# Schema definition\nextend type orders {\n  similar_orders: [orders] @join(\n    references_name: "orders"\n    source_fields: ["customer_id"]\n    references_fields: ["customer_id"]\n    sql: """\n      [source.id] != [dest.id] AND\n      ABS([source.total] - [dest.total]) < 100\n    """\n  )\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Query with complex joins:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  orders {\n    id\n    total\n    customer_id\n    # Similar orders from same customer\n    similar_orders(limit: 5) {\n      id\n      total\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"inner: true"})," to include only orders that have similar orders:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  orders {\n    id\n    total\n    # Only orders with similar orders\n    similar_orders(\n      limit: 5\n      inner: true\n    ) {\n      id\n      total\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"aggregating-custom-joins",children:"Aggregating Custom Joins"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Aggregate nearby stores\n    nearby_stores_aggregation {\n      _rows_count\n    }\n    # Group nearby stores by type\n    nearby_stores_bucket_aggregation {\n      key {\n        store_type\n      }\n      aggregations {\n        _rows_count\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"table-function-joins",children:"Table Function Joins"}),"\n",(0,s.jsx)(n.h3,{id:"using-table_function_call_join",children:"Using @table_function_call_join"}),"\n",(0,s.jsxs)(n.p,{children:["For functions returning sets of related data, use ",(0,s.jsx)(n.code,{children:"@table_function_call_join"})," to join function results with object fields."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"How Argument Mapping Works:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"args"})," parameter maps function arguments to object fields (not hardcoded values)"]}),"\n",(0,s.jsx)(n.li,{children:"Function arguments not in the mapping become field parameters in queries"}),"\n",(0,s.jsx)(n.li,{children:"Parameter requirements match the function's argument requirements"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# Function definition\nextend type Function {\n  get_sensor_readings(\n    sensor_id: Int!\n    from_time: Timestamp!\n    to_time: Timestamp!\n  ): [SensorReading] @function(\n    name: "fetch_readings"\n    is_table: true\n  )\n}\n\n# Field definition\nextend type sensors {\n  readings: [SensorReading] @table_function_call_join(\n    references_name: "get_sensor_readings"\n    args: {\n      sensor_id: "id"  # Maps sensor_id argument to sensors.id field\n    }\n    source_fields: ["id"]\n    references_fields: ["sensor_id"]\n  )\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," The ",(0,s.jsx)(n.code,{children:"readings"})," field requires ",(0,s.jsx)(n.code,{children:"from_time"})," and ",(0,s.jsx)(n.code,{children:"to_time"})," parameters (unmapped function arguments):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  sensors {\n    id\n    name\n    # from_time and to_time are required because they weren\'t mapped\n    readings(\n      from_time: "2024-01-01T00:00:00Z"\n      to_time: "2024-01-31T23:59:59Z"\n      limit: 100\n    ) {\n      timestamp\n      value\n      unit\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"limitations",children:"Limitations"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important:"})," Fields created with ",(0,s.jsx)(n.code,{children:"@table_function_call_join"})," do not support standard query arguments like ",(0,s.jsx)(n.code,{children:"filter"}),", ",(0,s.jsx)(n.code,{children:"order_by"}),", ",(0,s.jsx)(n.code,{children:"limit"}),", ",(0,s.jsx)(n.code,{children:"offset"}),", ",(0,s.jsx)(n.code,{children:"inner"}),", or aggregations (",(0,s.jsx)(n.code,{children:"_aggregation"}),", ",(0,s.jsx)(n.code,{children:"_bucket_aggregation"}),")."]}),"\n",(0,s.jsxs)(n.p,{children:["For advanced filtering, sorting, and aggregation, use ",(0,s.jsx)(n.strong,{children:"parameterized views"})," instead."]}),"\n",(0,s.jsx)(n.h3,{id:"alternative-parameterized-views",children:"Alternative: Parameterized Views"}),"\n",(0,s.jsx)(n.p,{children:"Parameterized views behave like regular data objects but require arguments, providing full query capabilities:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# Define parameterized view\ntype sensor_readings_view @view(\n  name: "sensor_readings_by_period"\n  sql: """\n    SELECT * FROM get_sensor_readings([sensor_id], [from_time], [to_time])\n  """\n) @args(name: "sensor_readings_args", required: true) {\n  sensor_id: Int! @pk\n  timestamp: Timestamp! @pk\n  value: Float!\n  unit: String!\n}\n\ninput sensor_readings_args {\n  sensor_id: Int!\n  from_time: Timestamp!\n  to_time: Timestamp!\n}\n\n# Create relation to parameterized view\nextend type sensors {\n  readings: [sensor_readings_view] @join(\n    references_name: "sensor_readings_view"\n    source_fields: ["id"]\n    references_fields: ["sensor_id"]\n  )\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Now you can use all standard query features:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  sensors {\n    id\n    name\n    # Full filtering, sorting, pagination support\n    high_readings: readings(\n      args: {\n        sensor_id: 123\n        from_time: "2024-01-01T00:00:00Z"\n        to_time: "2024-01-31T23:59:59Z"\n      }\n      filter: { value: { gte: 100 } }\n      order_by: [{ field: "timestamp", direction: DESC }]\n      limit: 50\n    ) {\n      timestamp\n      value\n    }\n\n    # Aggregations work too\n    readings_aggregation(\n      args: {\n        sensor_id: 123\n        from_time: "2024-01-01T00:00:00Z"\n        to_time: "2024-01-31T23:59:59Z"\n      }\n    ) {\n      _rows_count\n      value {\n        avg\n        min\n        max\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits of parameterized views:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Full support for ",(0,s.jsx)(n.code,{children:"filter"}),", ",(0,s.jsx)(n.code,{children:"order_by"}),", ",(0,s.jsx)(n.code,{children:"limit"}),", ",(0,s.jsx)(n.code,{children:"offset"}),", ",(0,s.jsx)(n.code,{children:"distinct_on"})]}),"\n",(0,s.jsxs)(n.li,{children:["Aggregation queries (",(0,s.jsx)(n.code,{children:"_aggregation"}),", ",(0,s.jsx)(n.code,{children:"_bucket_aggregation"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Nested queries with ",(0,s.jsx)(n.code,{children:"inner"})," parameter"]}),"\n",(0,s.jsx)(n.li,{children:"Can be used in relation filters"}),"\n",(0,s.jsx)(n.li,{children:"Better performance through query optimization"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"inner-joins",children:"Inner Joins"}),"\n",(0,s.jsxs)(n.p,{children:["By default, Hugr uses LEFT JOINs for subqueries, which means parent records are included even if they have no related records. Use ",(0,s.jsx)(n.code,{children:"inner: true"})," to switch to INNER JOIN behavior."]}),"\n",(0,s.jsx)(n.h3,{id:"basic-inner-join",children:"Basic INNER JOIN"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Only customers with orders - customers without orders are excluded\n    orders(inner: true) {\n      id\n      total\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"With LEFT JOIN (default):"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Returns all customers"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"orders"})," field is empty array for customers without orders"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["With INNER JOIN (",(0,s.jsx)(n.code,{children:"inner: true"}),"):"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Returns only customers who have orders"}),"\n",(0,s.jsx)(n.li,{children:"Customers without orders are completely excluded from results"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"combining-with-filters",children:"Combining with Filters"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # Only customers with pending orders\n    pending_orders: orders(\n      filter: { status: { eq: "pending" } }\n      inner: true\n    ) {\n      id\n      status\n      total\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"This returns only customers who have at least one pending order."}),"\n",(0,s.jsx)(n.h3,{id:"multiple-inner-joins",children:"Multiple INNER JOINs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Must have orders\n    orders(inner: true) {\n      id\n      # Must have order details\n      order_details(inner: true) {\n        product {\n          name\n        }\n        quantity\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Returns only customers who have orders that have order details."}),"\n",(0,s.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Find active relationships:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query {\n  products {\n    id\n    name\n    # Only products with active orders\n    orders(\n      filter: { status: { in: ["pending", "processing"] } }\n      inner: true\n    ) {\n      id\n      status\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Data validation:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  orders {\n    id\n    # Ensure order has customer (data integrity check)\n    customer(inner: true) {\n      id\n      name\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," For one-to-one relations, ",(0,s.jsx)(n.code,{children:"inner: true"})," excludes records where the relation is NULL."]}),"\n",(0,s.jsx)(n.h2,{id:"self-referential-relations",children:"Self-Referential Relations"}),"\n",(0,s.jsx)(n.h3,{id:"hierarchical-data",children:"Hierarchical Data"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# Schema definition\ntype employees @table(name: "employees") {\n  id: Int! @pk\n  name: String!\n  manager_id: Int @field_references(\n    references_name: "employees"\n    field: "id"\n    query: "manager"\n    references_query: "subordinates"\n  )\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Query hierarchies:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  employees {\n    id\n    name\n    # Direct manager\n    manager {\n      id\n      name\n    }\n    # Direct reports\n    subordinates {\n      id\n      name\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"multi-level-hierarchies",children:"Multi-Level Hierarchies"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  employees {\n    id\n    name\n    manager {\n      id\n      name\n      # Manager's manager\n      manager {\n        id\n        name\n      }\n    }\n    subordinates {\n      id\n      name\n      # Subordinates' subordinates\n      subordinates {\n        id\n        name\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,s.jsx)(n.h3,{id:"1-always-limit-subqueries",children:"1. Always Limit Subqueries"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"# Good\nquery {\n  customers {\n    id\n    orders(limit: 10) {\n      id\n    }\n  }\n}\n\n# Avoid - May fetch thousands of orders per customer\nquery {\n  customers {\n    id\n    orders {\n      id\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-use-aggregations-instead",children:"2. Use Aggregations Instead"}),"\n",(0,s.jsx)(n.p,{children:"When you only need counts or statistics:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"# Better\nquery {\n  customers {\n    id\n    orders_aggregation {\n      _rows_count\n      total { sum }\n    }\n  }\n}\n\n# Avoid\nquery {\n  customers {\n    id\n    orders {\n      id\n      total\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-filter-early",children:"3. Filter Early"}),"\n",(0,s.jsx)(n.p,{children:"Apply filters at the top level when possible:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# Better - Filter customers first\nquery {\n  customers(filter: { country: { eq: "USA" } }) {\n    id\n    orders {\n      id\n    }\n  }\n}\n\n# Less efficient - Filter after join\nquery {\n  orders(filter: { customer: { country: { eq: "USA" } } }) {\n    id\n    customer {\n      id\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-select-only-required-fields",children:"4. Select Only Required Fields"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"# Good\nquery {\n  customers {\n    id\n    orders(limit: 5) {\n      id\n      total\n    }\n  }\n}\n\n# Avoid - Fetching unnecessary fields\nquery {\n  customers {\n    id\n    name\n    email\n    phone\n    address\n    orders(limit: 5) {\n      id\n      total\n      status\n      created_at\n      updated_at\n      notes\n      metadata\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"5-use-batch-loading",children:"5. Use Batch Loading"}),"\n",(0,s.jsx)(n.p,{children:"Hugr automatically batches subqueries to avoid N+1 problems."}),"\n",(0,s.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"master-detail-view",children:"Master-Detail View"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query GetOrderDetails($orderId: Int!) {\n  orders_by_pk(id: $orderId) {\n    id\n    order_date\n    status\n    total\n    customer {\n      name\n      email\n      phone\n    }\n    order_details {\n      quantity\n      unit_price\n      product {\n        name\n        sku\n      }\n    }\n    shipper {\n      name\n      phone\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"recent-activity",children:"Recent Activity"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'query GetCustomerActivity($customerId: Int!) {\n  customers_by_pk(id: $customerId) {\n    id\n    name\n    recent_orders: orders(\n      order_by: [{ field: "created_at", direction: DESC }]\n      limit: 10\n    ) {\n      id\n      created_at\n      status\n      total\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"dashboard-statistics",children:"Dashboard Statistics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query GetDashboard {\n  customers_aggregation {\n    _rows_count\n  }\n\n  customers(limit: 10) {\n    id\n    name\n    orders_aggregation {\n      _rows_count\n      total { sum }\n    }\n  }\n\n  orders_bucket_aggregation {\n    key {\n      status\n    }\n    aggregations {\n      _rows_count\n      total { sum }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Learn about ",(0,s.jsx)(n.a,{href:"/docs/graphql/queries/function-fields",children:"Function Fields"})," to embed function calls in data objects"]}),"\n",(0,s.jsxs)(n.li,{children:["See ",(0,s.jsx)(n.a,{href:"/docs/graphql/queries/aggregations",children:"Aggregations"})," for detailed aggregation patterns"]}),"\n",(0,s.jsxs)(n.li,{children:["Check ",(0,s.jsx)(n.a,{href:"/docs/graphql/queries/dynamic-joins",children:"Dynamic Joins"})," for ad-hoc query-time joins"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>l});var i=r(6540);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);