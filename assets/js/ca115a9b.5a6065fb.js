"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[1578],{6218:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"querying/jq-endpoint","title":"JQ Query Endpoint","description":"REST API endpoint for executing GraphQL queries with JQ transformations","source":"@site/docs/6-querying/5-jq-endpoint.md","sourceDirName":"6-querying","slug":"/querying/jq-endpoint","permalink":"/docs/querying/jq-endpoint","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/6-querying/5-jq-endpoint.md","tags":[],"version":"current","lastUpdatedBy":"VGSML","lastUpdatedAt":1770931358000,"sidebarPosition":5,"frontMatter":{"title":"JQ Query Endpoint","sidebar_position":5,"description":"REST API endpoint for executing GraphQL queries with JQ transformations","keywords":["jq","rest","api","endpoint","transformations","caching"]},"sidebar":"docsSidebar","previous":{"title":"Python Client (hugr-client)","permalink":"/docs/querying/python-client"},"next":{"title":"Deployment","permalink":"/docs/category/deployment"}}');var i=r(4848),a=r(8453);const t={title:"JQ Query Endpoint",sidebar_position:5,description:"REST API endpoint for executing GraphQL queries with JQ transformations",keywords:["jq","rest","api","endpoint","transformations","caching"]},l="JQ Query Endpoint",d={},o=[{value:"Overview",id:"overview",level:2},{value:"Endpoint Details",id:"endpoint-details",level:2},{value:"Request Format",id:"request-format",level:2},{value:"Headers",id:"headers",level:3},{value:"Required Headers",id:"required-headers",level:4},{value:"Optional Authentication",id:"optional-authentication",level:4},{value:"Optional Caching Headers",id:"optional-caching-headers",level:4},{value:"Request Body",id:"request-body",level:3},{value:"JQ Input",id:"jq-input",level:3},{value:"Response Format",id:"response-format",level:2},{value:"Success Response",id:"success-response",level:3},{value:"Error Response",id:"error-response",level:3},{value:"HTTP Status Codes",id:"http-status-codes",level:3},{value:"Examples",id:"examples",level:2},{value:"Basic Query",id:"basic-query",level:3},{value:"Query with Variables",id:"query-with-variables",level:3},{value:"Error Handling",id:"error-handling",level:3},{value:"With Authentication",id:"with-authentication",level:3},{value:"Caching with TTL",id:"caching-with-ttl",level:3},{value:"Custom Cache Key",id:"custom-cache-key",level:3},{value:"Cache Invalidation",id:"cache-invalidation",level:3},{value:"Complex Transformation",id:"complex-transformation",level:3},{value:"Aggregation and Grouping",id:"aggregation-and-grouping",level:3},{value:"Use Cases",id:"use-cases",level:2},{value:"Data Export Pipelines",id:"data-export-pipelines",level:3},{value:"Dashboard Data Feed",id:"dashboard-data-feed",level:3},{value:"Webhook Data Transformation",id:"webhook-data-transformation",level:3},{value:"Report Generation",id:"report-generation",level:3},{value:"Comparison with Built-in jq() Query",id:"comparison-with-built-in-jq-query",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Use Appropriate Cache TTL",id:"1-use-appropriate-cache-ttl",level:3},{value:"2. Tag Related Queries",id:"2-tag-related-queries",level:3},{value:"3. Meaningful Cache Keys",id:"3-meaningful-cache-keys",level:3},{value:"4. Handle Errors in JQ",id:"4-handle-errors-in-jq",level:3},{value:"5. Filter in GraphQL, Not JQ",id:"5-filter-in-graphql-not-jq",level:3},{value:"6. Limit Data Volume",id:"6-limit-data-volume",level:3},{value:"7. Invalidate Cache on Data Changes",id:"7-invalidate-cache-on-data-changes",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Access Control",id:"access-control",level:3},{value:"Sensitive Data",id:"sensitive-data",level:3},{value:"Rate Limiting",id:"rate-limiting",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Invalid JQ Expression",id:"invalid-jq-expression",level:3},{value:"Cache Not Working",id:"cache-not-working",level:3},{value:"Empty Response",id:"empty-response",level:3},{value:"Timeout Errors",id:"timeout-errors",level:3},{value:"See Also",id:"see-also",level:2},{value:"Documentation",id:"documentation",level:3},{value:"Examples",id:"examples-1",level:3},{value:"Tools",id:"tools",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"jq-query-endpoint",children:"JQ Query Endpoint"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"/jq-query"})," REST endpoint provides a powerful way to execute GraphQL queries with server-side JQ transformations. Unlike the built-in ",(0,i.jsx)(n.code,{children:"jq()"})," GraphQL query, this endpoint returns the transformation result directly as the HTTP response and provides access to the complete GraphQL response (including errors) within JQ expressions."]}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"/jq-query"})," endpoint is designed for scenarios where you need:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Direct transformation results without GraphQL envelope"}),"\n",(0,i.jsx)(n.li,{children:"Access to GraphQL errors in JQ expressions"}),"\n",(0,i.jsx)(n.li,{children:"HTTP-based caching control via headers"}),"\n",(0,i.jsx)(n.li,{children:"Standalone data processing pipelines"}),"\n",(0,i.jsx)(n.li,{children:"Integration with non-GraphQL clients"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"endpoint-details",children:"Endpoint Details"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Method"}),": ",(0,i.jsx)(n.code,{children:"POST"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"URL"}),": ",(0,i.jsx)(n.code,{children:"/jq-query"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Content-Type"}),": ",(0,i.jsx)(n.code,{children:"application/json"})]}),"\n",(0,i.jsx)(n.h2,{id:"request-format",children:"Request Format"}),"\n",(0,i.jsx)(n.h3,{id:"headers",children:"Headers"}),"\n",(0,i.jsx)(n.h4,{id:"required-headers",children:"Required Headers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Content-Type: application/json\n"})}),"\n",(0,i.jsx)(n.h4,{id:"optional-authentication",children:"Optional Authentication"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Authorization: Bearer <token>\n"})}),"\n",(0,i.jsx)(n.p,{children:"Use when your hugr instance requires authentication."}),"\n",(0,i.jsx)(n.h4,{id:"optional-caching-headers",children:"Optional Caching Headers"}),"\n",(0,i.jsxs)(n.p,{children:["When hugr has caching configured (see ",(0,i.jsx)(n.a,{href:"/docs/deployment/caching",children:"Caching Configuration"}),"), you can control caching behavior:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"X-Hugr-Cache: <ttl_seconds or duration>\nX-Hugr-Cache-Key: <custom_cache_key>\nX-Hugr-Cache-Tags: <tag1,tag2,tag3>\nX-Hugr-Cache-Invalidate: <true|false>\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Caching Headers Reference"}),":"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Header"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"X-Hugr-Cache"})}),(0,i.jsx)(n.td,{children:"String"}),(0,i.jsxs)(n.td,{children:["Cache TTL (time-to-live). Accepts seconds (e.g., ",(0,i.jsx)(n.code,{children:"300"}),") or duration format (e.g., ",(0,i.jsx)(n.code,{children:"5m"}),", ",(0,i.jsx)(n.code,{children:"1h"}),", ",(0,i.jsx)(n.code,{children:"30s"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"X-Hugr-Cache-Key"})}),(0,i.jsx)(n.td,{children:"String"}),(0,i.jsx)(n.td,{children:"Custom cache key. If omitted, computed as hash of request body. User's role is automatically appended."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"X-Hugr-Cache-Tags"})}),(0,i.jsx)(n.td,{children:"String"}),(0,i.jsxs)(n.td,{children:["Comma-separated list of tags for grouped cache invalidation (e.g., ",(0,i.jsx)(n.code,{children:"users,analytics,reports"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"X-Hugr-Cache-Invalidate"})}),(0,i.jsx)(n.td,{children:"Boolean"}),(0,i.jsxs)(n.td,{children:["When ",(0,i.jsx)(n.code,{children:"true"}),", invalidates existing cache entry and re-executes query."]})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cache Key Format"}),": ",(0,i.jsx)(n.code,{children:"<custom_key or hash(request_body)>:<user_role>"})]}),"\n",(0,i.jsx)(n.h3,{id:"request-body",children:"Request Body"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "jq": "<jq_expression>",\n  "query": {\n    "query": "<graphql_query>",\n    "variables": {\n      "var1": "value1",\n      "var2": "value2"\n    },\n    "operationName": "<operation_name>"\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fields"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"jq"})," (string, required): JQ expression to apply to the GraphQL response"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"query"})," (object, required): GraphQL query details","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"query"})," (string, required): GraphQL query text"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"variables"})," (object, optional): Query variables. Supports the ",(0,i.jsxs)(n.a,{href:"/docs/graphql/jq-transformations#_jq-variable-input-transformations",children:[(0,i.jsx)(n.code,{children:"_jq"})," variable input transformation"]})," for dynamically computing variables before query execution."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"operationName"})," (string, optional): Operation name for named queries"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"jq-input",children:"JQ Input"}),"\n",(0,i.jsxs)(n.p,{children:["The JQ expression receives the ",(0,i.jsx)(n.strong,{children:"complete GraphQL response"}),", including:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data"})," - Query results"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"extensions"})," - Extensions object"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"errors"})," - GraphQL errors (if any)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This is different from the built-in ",(0,i.jsx)(n.code,{children:"jq()"})," query, which only receives the ",(0,i.jsx)(n.code,{children:"data"})," field."]}),"\n",(0,i.jsx)(n.h2,{id:"response-format",children:"Response Format"}),"\n",(0,i.jsx)(n.h3,{id:"success-response",children:"Success Response"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"HTTP Status"}),": ",(0,i.jsx)(n.code,{children:"200 OK"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Body"}),": The result of the JQ transformation (direct output, no GraphQL envelope)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:"<jq_transformation_result>\n"})}),"\n",(0,i.jsx)(n.p,{children:"The response format depends on your JQ expression:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Array if JQ returns an array"}),"\n",(0,i.jsx)(n.li,{children:"Object if JQ returns an object"}),"\n",(0,i.jsx)(n.li,{children:"Primitive value if JQ returns a string/number/boolean"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-response",children:"Error Response"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"HTTP Status"}),": ",(0,i.jsx)(n.code,{children:"400 Bad Request"}),", ",(0,i.jsx)(n.code,{children:"401 Unauthorized"}),", or ",(0,i.jsx)(n.code,{children:"500 Internal Server Error"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Body"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Error message description"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"http-status-codes",children:"HTTP Status Codes"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Code"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"200 OK"})}),(0,i.jsx)(n.td,{children:"Successful transformation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"400 Bad Request"})}),(0,i.jsx)(n.td,{children:"Invalid JQ expression or GraphQL query syntax"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"401 Unauthorized"})}),(0,i.jsx)(n.td,{children:"Missing or invalid authentication"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"500 Internal Server Error"})}),(0,i.jsx)(n.td,{children:"Server-side error during processing"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.h3,{id:"basic-query",children:"Basic Query"}),"\n",(0,i.jsx)(n.p,{children:"Execute a simple GraphQL query and transform the result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jq": ".data.users | map({id, name})",\n    "query": {\n      "query": "{ users { id name email created_at } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n  {"id": 1, "name": "Alice"},\n  {"id": 2, "name": "Bob"},\n  {"id": 3, "name": "Charlie"}\n]\n'})}),"\n",(0,i.jsx)(n.h3,{id:"query-with-variables",children:"Query with Variables"}),"\n",(0,i.jsx)(n.p,{children:"Use GraphQL variables and access them in JQ:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jq": ".data.users | map(select(.country == $country))",\n    "query": {\n      "query": "query($country: String!) { users { id name country } }",\n      "variables": {\n        "country": "USA"\n      }\n    }\n  }\'\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n  {"id": 1, "name": "Alice", "country": "USA"},\n  {"id": 5, "name": "David", "country": "USA"}\n]\n'})}),"\n",(0,i.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.p,{children:"Handle GraphQL errors gracefully in JQ:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jq": "if .errors then {error: \\"Query failed\\", details: .errors} else .data.users end",\n    "query": {\n      "query": "{ users { id name invalid_field } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"})," (when query has errors):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Query failed",\n  "details": [\n    {\n      "message": "Cannot query field \'invalid_field\' on type \'User\'",\n      "locations": [{"line": 1, "column": 20}]\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"with-authentication",children:"With Authentication"}),"\n",(0,i.jsx)(n.p,{children:"Include Bearer token for authenticated requests:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \\\n  -d \'{\n    "jq": ".data.orders | map({id, total, customer: .customer.name})",\n    "query": {\n      "query": "{ orders { id total customer { name } } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsx)(n.h3,{id:"caching-with-ttl",children:"Caching with TTL"}),"\n",(0,i.jsx)(n.p,{children:"Cache results for 5 minutes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -H "X-Hugr-Cache: 5m" \\\n  -H "X-Hugr-Cache-Tags: users,analytics" \\\n  -d \'{\n    "jq": ".data.users_aggregation",\n    "query": {\n      "query": "{ users_aggregation { _rows_count total_revenue { sum } } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"First request"}),": Executes query, caches result for 5 minutes\n",(0,i.jsx)(n.strong,{children:"Subsequent requests"})," (within 5 min): Returns cached result instantly"]}),"\n",(0,i.jsx)(n.h3,{id:"custom-cache-key",children:"Custom Cache Key"}),"\n",(0,i.jsx)(n.p,{children:"Use meaningful cache keys for dashboard queries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -H "X-Hugr-Cache: 300" \\\n  -H "X-Hugr-Cache-Key: dashboard:daily-stats:2024-01-15" \\\n  -H "X-Hugr-Cache-Tags: dashboard,analytics,daily" \\\n  -d \'{\n    "jq": ".data | {users: .users_aggregation._rows_count, orders: .orders_aggregation._rows_count, revenue: .orders_aggregation.total.sum}",\n    "query": {\n      "query": "{ users_aggregation { _rows_count } orders_aggregation { _rows_count total { sum } } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cache Key"}),": ",(0,i.jsx)(n.code,{children:"dashboard:daily-stats:2024-01-15:<user_role>"}),"\n",(0,i.jsx)(n.strong,{children:"TTL"}),": 300 seconds (5 minutes)"]}),"\n",(0,i.jsx)(n.h3,{id:"cache-invalidation",children:"Cache Invalidation"}),"\n",(0,i.jsx)(n.p,{children:"Force cache refresh when underlying data changes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -H "X-Hugr-Cache: 1h" \\\n  -H "X-Hugr-Cache-Key: product-catalog" \\\n  -H "X-Hugr-Cache-Invalidate: true" \\\n  -d \'{\n    "jq": ".data.products | group_by(.category)",\n    "query": {\n      "query": "{ products { id name category price } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsx)(n.p,{children:"This request:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Invalidates cache for key ",(0,i.jsx)(n.code,{children:"product-catalog:<role>"})]}),"\n",(0,i.jsx)(n.li,{children:"Executes the query"}),"\n",(0,i.jsx)(n.li,{children:"Caches new result with 1-hour TTL"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"complex-transformation",children:"Complex Transformation"}),"\n",(0,i.jsx)(n.p,{children:"Transform nested data into flat structure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jq": ".data.customers | map(.orders[] | {customer_id: .customer_id, customer_name: .customer_name, order_id: .id, order_total: .total}) | flatten",\n    "query": {\n      "query": "{ customers { id name as customer_name orders { id customer_id: id total } } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsx)(n.h3,{id:"aggregation-and-grouping",children:"Aggregation and Grouping"}),"\n",(0,i.jsx)(n.p,{children:"Group and aggregate data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -H "X-Hugr-Cache: 10m" \\\n  -d \'{\n    "jq": ".data.orders | group_by(.status) | map({status: .[0].status, count: length, total: map(.amount) | add, avg: (map(.amount) | add / length)})",\n    "query": {\n      "query": "{ orders { id status amount } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "status": "completed",\n    "count": 150,\n    "total": 45000,\n    "avg": 300\n  },\n  {\n    "status": "pending",\n    "count": 25,\n    "total": 7500,\n    "avg": 300\n  },\n  {\n    "status": "cancelled",\n    "count": 10,\n    "total": 2000,\n    "avg": 200\n  }\n]\n'})}),"\n",(0,i.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsx)(n.h3,{id:"data-export-pipelines",children:"Data Export Pipelines"}),"\n",(0,i.jsx)(n.p,{children:"Transform GraphQL data into formats required by external systems:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jq": ".data.orders | map({order_id: .id, customer: .customer.email, items: (.items | map(.product.name) | join(\\", \\")), total: .total})",\n    "query": {\n      "query": "{ orders { id total customer { email } items { product { name } } } }"\n    }\n  }\' > orders_export.json\n'})}),"\n",(0,i.jsx)(n.h3,{id:"dashboard-data-feed",children:"Dashboard Data Feed"}),"\n",(0,i.jsx)(n.p,{children:"Prepare data for BI dashboards with caching:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -H "X-Hugr-Cache: 15m" \\\n  -H "X-Hugr-Cache-Key: dashboard:sales-overview" \\\n  -d \'{\n    "jq": "{summary: {total_orders: .data.orders_aggregation._rows_count, total_revenue: .data.orders_aggregation.total.sum, avg_order_value: (.data.orders_aggregation.total.sum / .data.orders_aggregation._rows_count)}, by_status: (.data.status_breakdown.key | map({status: .status, count: .aggregations._rows_count}))}",\n    "query": {\n      "query": "{ orders_aggregation { _rows_count total { sum } } status_breakdown: orders_bucket_aggregation { key { status } aggregations { _rows_count } } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsx)(n.h3,{id:"webhook-data-transformation",children:"Webhook Data Transformation"}),"\n",(0,i.jsx)(n.p,{children:"Transform data before sending to webhooks:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Get transformed data\nDATA=$(curl -s -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jq": ".data.new_orders | map({id, customer_email: .customer.email, total})",\n    "query": {\n      "query": "{ new_orders: orders(filter: {status: {eq: \\"new\\"}}) { id total customer { email } } }"\n    }\n  }\')\n\n# Send to webhook\ncurl -X POST https://example.com/webhook \\\n  -H "Content-Type: application/json" \\\n  -d "$DATA"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"report-generation",children:"Report Generation"}),"\n",(0,i.jsx)(n.p,{children:"Generate structured reports:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/jq-query \\\n  -H "Content-Type: application/json" \\\n  -H "X-Hugr-Cache: 1h" \\\n  -d \'{\n    "jq": "{report_date: now | strftime(\\"%Y-%m-%d\\"), metrics: {total_users: .data.users_aggregation._rows_count, active_users: .data.active_users._rows_count, conversion_rate: ((.data.orders_aggregation._rows_count / .data.users_aggregation._rows_count) * 100 | floor)}}",\n    "query": {\n      "query": "{ users_aggregation { _rows_count } active_users: users_aggregation(filter: {last_login: {gte: \\"2024-01-01\\"}}) { _rows_count } orders_aggregation { _rows_count } }"\n    }\n  }\'\n'})}),"\n",(0,i.jsx)(n.h2,{id:"comparison-with-built-in-jq-query",children:"Comparison with Built-in jq() Query"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"Built-in jq()"}),(0,i.jsx)(n.th,{children:"/jq-query Endpoint"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"JQ Input"})}),(0,i.jsxs)(n.td,{children:["Only ",(0,i.jsx)(n.code,{children:"data"})," field"]}),(0,i.jsxs)(n.td,{children:["Complete GraphQL response (",(0,i.jsx)(n.code,{children:"data"}),", ",(0,i.jsx)(n.code,{children:"extensions"}),", ",(0,i.jsx)(n.code,{children:"errors"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Response Format"})}),(0,i.jsxs)(n.td,{children:["GraphQL response with ",(0,i.jsx)(n.code,{children:"extensions.jq"})]}),(0,i.jsx)(n.td,{children:"Direct JQ result as HTTP response"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Original Data"})}),(0,i.jsxs)(n.td,{children:["In ",(0,i.jsx)(n.code,{children:"data"})," field"]}),(0,i.jsx)(n.td,{children:"Not preserved (unless included in JQ)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Error Access"})}),(0,i.jsx)(n.td,{children:"Not available to JQ"}),(0,i.jsxs)(n.td,{children:["Available in ",(0,i.jsx)(n.code,{children:".errors"})," field"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Caching"})}),(0,i.jsxs)(n.td,{children:["Via ",(0,i.jsx)(n.code,{children:"@cache"})," directive"]}),(0,i.jsxs)(n.td,{children:["Via HTTP headers (",(0,i.jsx)(n.code,{children:"X-Hugr-Cache-*"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Use Case"})}),(0,i.jsx)(n.td,{children:"Inline transformations in GraphQL"}),(0,i.jsx)(n.td,{children:"Standalone transformations, data pipelines"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Client Integration"})}),(0,i.jsx)(n.td,{children:"GraphQL clients"}),(0,i.jsx)(n.td,{children:"Any HTTP client (curl, fetch, axios)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Chaining"})}),(0,i.jsx)(n.td,{children:"Easy (nested jq queries)"}),(0,i.jsx)(n.td,{children:"Manual (multiple requests)"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"1-use-appropriate-cache-ttl",children:"1. Use Appropriate Cache TTL"}),"\n",(0,i.jsx)(n.p,{children:"Choose cache duration based on data volatility:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Real-time data: short TTL\nX-Hugr-Cache: 30s\n\n# Semi-static data: medium TTL\nX-Hugr-Cache: 5m\n\n# Static/reference data: long TTL\nX-Hugr-Cache: 1h\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-tag-related-queries",children:"2. Tag Related Queries"}),"\n",(0,i.jsx)(n.p,{children:"Use tags for easier cache management:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Tag by feature area\nX-Hugr-Cache-Tags: dashboard,sales,analytics\n\n# Invalidate all dashboard queries later\n# (implementation depends on cache backend)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-meaningful-cache-keys",children:"3. Meaningful Cache Keys"}),"\n",(0,i.jsx)(n.p,{children:"Use descriptive keys for better observability:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Good: Descriptive\nX-Hugr-Cache-Key: report:monthly-sales:2024-01\n\n# Less optimal: Auto-generated\n# (omit header to use request body hash)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-handle-errors-in-jq",children:"4. Handle Errors in JQ"}),"\n",(0,i.jsx)(n.p,{children:"Always check for GraphQL errors:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'"jq": "if .errors then {error: .errors[0].message} else .data.users end"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"5-filter-in-graphql-not-jq",children:"5. Filter in GraphQL, Not JQ"}),"\n",(0,i.jsx)(n.p,{children:"Apply filters in GraphQL for better performance:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Good: Filter in GraphQL\n{\n  "jq": ".data.users | map({id, name})",\n  "query": {\n    "query": "{ users(filter: {active: {eq: true}}) { id name } }"\n  }\n}\n\n# Less efficient: Filter in JQ\n{\n  "jq": ".data.users | map(select(.active == true)) | map({id, name})",\n  "query": {\n    "query": "{ users { id name active } }"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"6-limit-data-volume",children:"6. Limit Data Volume"}),"\n",(0,i.jsxs)(n.p,{children:["Use GraphQL ",(0,i.jsx)(n.code,{children:"limit"})," to reduce processing:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'{\n  "query": {\n    "query": "{ users(limit: 100) { id name } }"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"7-invalidate-cache-on-data-changes",children:"7. Invalidate Cache on Data Changes"}),"\n",(0,i.jsx)(n.p,{children:"Force refresh when source data changes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# After updating products\ncurl -X POST http://localhost:8080/jq-query \\\n  -H "X-Hugr-Cache: 1h" \\\n  -H "X-Hugr-Cache-Key: product-catalog" \\\n  -H "X-Hugr-Cache-Invalidate: true" \\\n  -d \'{...}\'\n'})}),"\n",(0,i.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,i.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsx)(n.p,{children:"Always use authentication for production:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -X POST http://localhost:8080/jq-query \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -d '{...}'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"access-control",children:"Access Control"}),"\n",(0,i.jsx)(n.p,{children:"JQ transformations respect the same access control as GraphQL queries. Users can only access data they're authorized to see."}),"\n",(0,i.jsx)(n.h3,{id:"sensitive-data",children:"Sensitive Data"}),"\n",(0,i.jsx)(n.p,{children:"Remove sensitive fields in JQ expressions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'"jq": ".data.users | map({id, name} | del(.ssn, .password))"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,i.jsx)(n.p,{children:"Implement rate limiting on the /jq-query endpoint to prevent abuse."}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"invalid-jq-expression",children:"Invalid JQ Expression"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),": ",(0,i.jsx)(n.code,{children:'400 Bad Request - "Invalid JQ expression"'})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Test your JQ expression using the ",(0,i.jsx)(n.a,{href:"https://jqlang.github.io/jq/",children:"jq command-line tool"})," or ",(0,i.jsx)(n.a,{href:"https://jqplay.org/",children:"jqplay.org"})]}),"\n",(0,i.jsx)(n.h3,{id:"cache-not-working",children:"Cache Not Working"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue"}),": Cache headers ignored"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Checklist"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Verify caching is configured: ",(0,i.jsx)(n.a,{href:"/docs/deployment/caching",children:"Caching Configuration"})]}),"\n",(0,i.jsxs)(n.li,{children:["Check ",(0,i.jsx)(n.code,{children:"CACHE_L1_ENABLED"})," or ",(0,i.jsx)(n.code,{children:"CACHE_L2_ENABLED"})," is ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsxs)(n.li,{children:["Ensure valid TTL format (e.g., ",(0,i.jsx)(n.code,{children:"5m"}),", ",(0,i.jsx)(n.code,{children:"300"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"empty-response",children:"Empty Response"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue"}),": Endpoint returns empty result"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Debug"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Check the full GraphQL response\n"jq": "."\n\n# Then narrow down\n"jq": ".data"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"timeout-errors",children:"Timeout Errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue"}),": Request times out"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"limit"})," to GraphQL query"]}),"\n",(0,i.jsx)(n.li,{children:"Filter data in GraphQL, not JQ"}),"\n",(0,i.jsx)(n.li,{children:"Reduce query complexity"}),"\n",(0,i.jsx)(n.li,{children:"Consider pagination"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsx)(n.h3,{id:"documentation",children:"Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/graphql/jq-transformations",children:"JQ Transformations"})," - Complete JQ transformations guide"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/deployment/caching",children:"Caching Configuration"})," - Configure L1/L2 cache"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/graphql/queries",children:"GraphQL Queries"})," - GraphQL query documentation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://jqlang.github.io/jq/manual/",children:"Official JQ Manual"})," - JQ language reference"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"examples-1",children:"Examples"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/engine-configuration/data-sources/http",children:"HTTP Data Sources"})," - JQ in HTTP functions"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tools",children:"Tools"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://jqplay.org/",children:"JQ Play"})," - Online JQ playground"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/stedolan/jq/wiki/Cookbook",children:"JQ Cookbook"})," - Common patterns"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>l});var s=r(6540);const i={},a=s.createContext(i);function t(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);