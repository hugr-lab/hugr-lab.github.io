"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[8456],{3741:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"engine-configuration/data-sources/embeddings","title":"Embeddings and Semantic Search","description":"Add embeddings models and perform semantic search queries.","source":"@site/docs/4-engine-configuration/1-data-sources/7-embeddings.md","sourceDirName":"4-engine-configuration/1-data-sources","slug":"/engine-configuration/data-sources/embeddings","permalink":"/docs/engine-configuration/data-sources/embeddings","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/4-engine-configuration/1-data-sources/7-embeddings.md","tags":[],"version":"current","lastUpdatedBy":"VGSML","lastUpdatedAt":1770666164000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Embeddings and Semantic Search","description":"Add embeddings models and perform semantic search queries."},"sidebar":"docsSidebar","previous":{"title":"Extension Data Source","permalink":"/docs/engine-configuration/data-sources/extension"},"next":{"title":"Object Storage Access Configuration","permalink":"/docs/engine-configuration/storage-access"}}');var d=t(4848),i=t(8453);const a={sidebar_position:8,title:"Embeddings and Semantic Search",description:"Add embeddings models and perform semantic search queries."},o=void 0,r={},c=[{value:"Defining an Embeddings Data Source",id:"defining-an-embeddings-data-source",level:2}];function l(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Embeddings"})," data source allows you to integrate vector embeddings models into your Hugr instance. This enables you to generate vector representations of text data and perform semantic search queries based on vector similarity."]}),"\n",(0,d.jsx)(n.p,{children:"The embeddings model should be accessible via a REST API endpoint that accepts POST requests with JSON payload containing the text to be embedded. The response should include the generated vector. The structure of the request and response should be the same as used by OpenAI embeddings API."}),"\n",(0,d.jsx)(n.h2,{id:"defining-an-embeddings-data-source",children:"Defining an Embeddings Data Source"}),"\n",(0,d.jsxs)(n.p,{children:["To define an embeddings data source use GraphQL API to add a record to the ",(0,d.jsx)(n.code,{children:"data_sources"})," table. The ",(0,d.jsx)(n.code,{children:"type"})," of the data source should be set to ",(0,d.jsx)(n.code,{children:"embeddings"}),". The ",(0,d.jsx)(n.code,{children:"path"})," should contain the url of the embeddings model endpoint and it allows to pass additional parameters:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["model - model name, e.g. ",(0,d.jsx)(n.code,{children:"text-embedding-3-small"})]}),"\n",(0,d.jsx)(n.li,{children:"api_key - API key for authentication, if required by the model provider"}),"\n",(0,d.jsx)(n.li,{children:"timeout - request timeout in seconds (default is 10)"}),"\n",(0,d.jsxs)(n.li,{children:["api_key_header - custom header name for the API key (default is ",(0,d.jsx)(n.code,{children:"Authorization"}),")"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-graphql",children:"mutation addEmbeddingsDataSource($data: data_sources_mut_input_data! = {}) {\n  core {\n    insert_data_sources(data: $data) {\n      name\n      description\n      as_module\n      disabled\n      path\n      prefix\n      read_only\n      self_defined\n      type\n    }\n  }\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"Variables:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "name": "openai_embeddings",\n    "type": "embeddings",\n    "path": "https://api.openai.com/v1/embeddings?model=text-embedding-3-small&api_key=YOUR_API_KEY",\n    "prefix": "",\n    "description": "OpenAI Embeddings Model",\n  }\n}\n'})}),"\n",(0,d.jsx)(n.p,{children:"It allows you to get embeddings for text through the unified GraphQL API."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-graphql",children:'query {\n    function {\n        create_embedding(\n            model: "openai_embeddings"\n            input: "Hello, world!"\n        )\n    }\n}\n'})}),"\n",(0,d.jsxs)(n.p,{children:["It also allows you to set up the model for the table or view, that contains the vector field. You should use the ",(0,d.jsx)(n.code,{children:'@embeddings(model: "openai_embeddings", vector: "vec", distance: Cosine)'})," directive to specify the model for the vector field. The vector field should be of type ",(0,d.jsx)(n.code,{children:"Vector"}),"."]}),"\n",(0,d.jsxs)(n.p,{children:["If it would be set up, you can use the ",(0,d.jsx)(n.code,{children:"similarity"})," argument in the queries to perform semantic search based on vector similarity."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-graphql",children:'type documents @table(name: "documents") \n    @embeddings(\n        model: "openai_embeddings"\n        vector: "vec"\n        distance: Cosine\n    ) {\n  id: BigInt! @pk @default(sequence: "documents_id_seq")\n  category: String!\n  content: String!\n  vec: Vector! @dim(len: 1536)\n}\n'})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-graphql",children:'query {\n  documents(\n    filter: { category: { eq: "news" } }\n    semantic: {\n      query: "Hugr is an open-source data platform"\n      limit: 5\n    }\n  ) {\n    id\n    content\n    vec\n  }\n}\n'})}),"\n",(0,d.jsx)(n.p,{children:"It also allows you to perform mutations with vector fields. The vector will be generated automatically using the specified embeddings model."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_documents(\n    data: {\n        category: "news"\n        content: "Hugr is an open-source data platform"\n    }\n    summary: "Hugr is an open-source data platform that allows you to create GraphQL APIs over your databases."\n  ) {\n    id\n    vec\n  }\n  update_documents(\n    filter: { id: { eq: 1 } }\n    data: { content: "Updated content" }\n    summary: "Updated summary"\n  ) {\n    success\n    message\n    affected_rows\n  }\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var s=t(6540);const d={},i=s.createContext(d);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);