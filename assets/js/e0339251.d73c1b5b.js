"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[649],{7348:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"graphql/mutations","title":"Mutations: Create, Update, Delete","description":"Mutations in Hugr allow you to modify data through the GraphQL API. Hugr automatically generates mutation operations for all tables defined in your schema, providing create (insert), update, and delete functionality with full transaction support.","source":"@site/docs/5-graphql/2-mutations.md","sourceDirName":"5-graphql","slug":"/graphql/mutations","permalink":"/docs/graphql/mutations","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/5-graphql/2-mutations.md","tags":[],"version":"current","lastUpdatedBy":"Claude","lastUpdatedAt":1762521867000,"sidebarPosition":3,"frontMatter":{"title":"Mutations: Create, Update, Delete","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"GraphQL Operations","permalink":"/docs/docs/5-graphql"},"next":{"title":"GraphQL Extensions","permalink":"/docs/graphql/extensions"}}');var i=t(4848),s=t(8453);const r={title:"Mutations: Create, Update, Delete",sidebar_position:3},l="Mutations",d={},o=[{value:"Overview",id:"overview",level:2},{value:"Insert Mutations",id:"insert-mutations",level:2},{value:"Basic Insert",id:"basic-insert",level:3},{value:"Insert with Nested Relations",id:"insert-with-nested-relations",level:3},{value:"Batch Insert",id:"batch-insert",level:3},{value:"Update Mutations",id:"update-mutations",level:2},{value:"Basic Update",id:"basic-update",level:3},{value:"Bulk Updates",id:"bulk-updates",level:3},{value:"Conditional Updates",id:"conditional-updates",level:3},{value:"Update with Relations Filter",id:"update-with-relations-filter",level:3},{value:"Delete Mutations",id:"delete-mutations",level:2},{value:"Basic Delete",id:"basic-delete",level:3},{value:"Bulk Delete",id:"bulk-delete",level:3},{value:"Conditional Delete",id:"conditional-delete",level:3},{value:"Soft Delete",id:"soft-delete",level:3},{value:"Return Values",id:"return-values",level:2},{value:"Insert Return Types",id:"insert-return-types",level:3},{value:"Operation Result Type",id:"operation-result-type",level:3},{value:"Transaction Behavior",id:"transaction-behavior",level:2},{value:"Input Types",id:"input-types",level:2},{value:"Insert Input Type",id:"insert-input-type",level:3},{value:"Update Input Type",id:"update-input-type",level:3},{value:"Auto-Generated Values",id:"auto-generated-values",level:2},{value:"Sequences and Auto-Increment",id:"sequences-and-auto-increment",level:3},{value:"Default Values",id:"default-values",level:3},{value:"Cache Invalidation",id:"cache-invalidation",level:2},{value:"Schema-Level Cache",id:"schema-level-cache",level:3},{value:"Manual Cache Invalidation",id:"manual-cache-invalidation",level:3},{value:"Selective Cache Invalidation",id:"selective-cache-invalidation",level:3},{value:"Semantic Search Integration",id:"semantic-search-integration",level:2},{value:"Update with Embeddings",id:"update-with-embeddings",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Constraint Violations",id:"constraint-violations",level:3},{value:"Validation Errors",id:"validation-errors",level:3},{value:"Transaction Failures",id:"transaction-failures",level:3},{value:"Filter Operators",id:"filter-operators",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Use Transactions for Related Operations",id:"use-transactions-for-related-operations",level:3},{value:"Request Only Needed Fields",id:"request-only-needed-fields",level:3},{value:"Use Batch Operations",id:"use-batch-operations",level:3},{value:"Validate Input Data",id:"validate-input-data",level:3},{value:"Handle Errors Gracefully",id:"handle-errors-gracefully",level:3},{value:"Use Aliases for Multiple Mutations",id:"use-aliases-for-multiple-mutations",level:3},{value:"Consider Cache Invalidation Strategy",id:"consider-cache-invalidation-strategy",level:3},{value:"See Also",id:"see-also",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"mutations",children:"Mutations"})}),"\n",(0,i.jsx)(n.p,{children:"Mutations in Hugr allow you to modify data through the GraphQL API. Hugr automatically generates mutation operations for all tables defined in your schema, providing create (insert), update, and delete functionality with full transaction support."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Hugr mutations provide:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CRUD Operations"}),": Insert, update, and delete records"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Transactional Integrity"}),": All mutations in a single request execute atomically"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Relationship Support"}),": Insert nested related records in one operation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Flexible Filtering"}),": Update/delete multiple records with complex filters"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return Values"}),": Get back inserted/updated data or operation results"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cache Invalidation"}),": Automatic cache invalidation when data changes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Soft Delete Support"}),": Mark records as deleted without physical removal"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"insert-mutations",children:"Insert Mutations"}),"\n",(0,i.jsx)(n.h3,{id:"basic-insert",children:"Basic Insert"}),"\n",(0,i.jsx)(n.p,{children:"Insert a single record into a table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_customers(data: {\n    name: "John Doe"\n    email: "john@example.com"\n    phone: "+1-555-0123"\n    status: "active"\n  }) {\n    id\n    name\n    email\n    created_at\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Response:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "insert_customers": {\n      "id": 123,\n      "name": "John Doe",\n      "email": "john@example.com",\n      "created_at": "2024-01-15T10:30:00Z"\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"insert-with-nested-relations",children:"Insert with Nested Relations"}),"\n",(0,i.jsx)(n.p,{children:"Insert a record with related data in a single transaction:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_customers(data: {\n    name: "Jane Smith"\n    email: "jane@example.com"\n    status: "active"\n\n    # One-to-one or many-to-one relation\n    profile: {\n      bio: "Software engineer"\n      avatar_url: "https://example.com/avatar.jpg"\n    }\n\n    # One-to-many relation\n    addresses: [\n      {\n        street: "123 Main St"\n        city: "New York"\n        state: "NY"\n        type: "billing"\n      }\n      {\n        street: "456 Oak Ave"\n        city: "Boston"\n        state: "MA"\n        type: "shipping"\n      }\n    ]\n\n    # Deeply nested relations\n    orders: [\n      {\n        order_date: "2024-01-15"\n        status: "pending"\n        order_details: [\n          {\n            product_id: 101\n            quantity: 2\n            unit_price: 50.00\n          }\n          {\n            product_id: 102\n            quantity: 1\n            unit_price: 75.00\n          }\n        ]\n      }\n    ]\n  }) {\n    id\n    name\n    email\n    profile {\n      bio\n    }\n    addresses {\n      id\n      city\n      type\n    }\n    orders {\n      id\n      status\n      order_details {\n        product_id\n        quantity\n        unit_price\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"batch-insert",children:"Batch Insert"}),"\n",(0,i.jsx)(n.p,{children:"Insert multiple records at once:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_products_batch(data: [\n    {\n      name: "Product A"\n      sku: "PROD-A-001"\n      price: 29.99\n      category_id: 5\n    }\n    {\n      name: "Product B"\n      sku: "PROD-B-001"\n      price: 39.99\n      category_id: 5\n    }\n    {\n      name: "Product C"\n      sku: "PROD-C-001"\n      price: 49.99\n      category_id: 6\n    }\n  ]) {\n    affected_rows\n    success\n    message\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"update-mutations",children:"Update Mutations"}),"\n",(0,i.jsx)(n.h3,{id:"basic-update",children:"Basic Update"}),"\n",(0,i.jsx)(n.p,{children:"Update records matching a filter:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  update_customers(\n    filter: { id: { eq: 123 } }\n    data: {\n      email: "newemail@example.com"\n      phone: "+1-555-9999"\n      updated_at: "2024-01-20T15:30:00Z"\n    }\n  ) {\n    affected_rows\n    success\n    message\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Response:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "update_customers": {\n      "affected_rows": 1,\n      "success": true,\n      "message": "Updated successfully"\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"bulk-updates",children:"Bulk Updates"}),"\n",(0,i.jsx)(n.p,{children:"Update multiple records with a single mutation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  update_products(\n    filter: {\n      category_id: { eq: 5 }\n      status: { eq: "active" }\n    }\n    data: {\n      discount_percentage: 15\n      sale_ends_at: "2024-02-01T00:00:00Z"\n      on_sale: true\n    }\n  ) {\n    affected_rows\n    success\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"conditional-updates",children:"Conditional Updates"}),"\n",(0,i.jsx)(n.p,{children:"Use complex filters for targeted updates:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  update_orders(\n    filter: {\n      _and: [\n        { status: { eq: "pending" } }\n        { created_at: { lt: "2024-01-01" } }\n        { customer: {\n            status: { eq: "active" }\n            country: { eq: "USA" }\n          }\n        }\n      ]\n    }\n    data: {\n      status: "cancelled"\n      cancelled_reason: "Order expired"\n      cancelled_at: "2024-01-20T10:00:00Z"\n    }\n  ) {\n    affected_rows\n    message\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"update-with-relations-filter",children:"Update with Relations Filter"}),"\n",(0,i.jsx)(n.p,{children:"Update based on related data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  update_products(\n    filter: {\n      category: {\n        name: { eq: "Electronics" }\n        active: { eq: true }\n      }\n      supplier: {\n        country: { in: ["USA", "Canada"] }\n      }\n      price: { gte: 100 }\n    }\n    data: {\n      premium: true\n      warranty_months: 24\n    }\n  ) {\n    affected_rows\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"delete-mutations",children:"Delete Mutations"}),"\n",(0,i.jsx)(n.h3,{id:"basic-delete",children:"Basic Delete"}),"\n",(0,i.jsx)(n.p,{children:"Delete records matching a filter:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"mutation {\n  delete_customers(\n    filter: { id: { eq: 123 } }\n  ) {\n    affected_rows\n    success\n    message\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"bulk-delete",children:"Bulk Delete"}),"\n",(0,i.jsx)(n.p,{children:"Delete multiple records:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  delete_logs(\n    filter: {\n      created_at: { lt: "2023-01-01" }\n      level: { in: ["debug", "info"] }\n    }\n  ) {\n    affected_rows\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"conditional-delete",children:"Conditional Delete"}),"\n",(0,i.jsx)(n.p,{children:"Delete with complex conditions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  delete_sessions(\n    filter: {\n      _or: [\n        { expires_at: { lt: "2024-01-20T00:00:00Z" } }\n        {\n          _and: [\n            { last_activity: { lt: "2024-01-01" } }\n            { user: { status: { eq: "inactive" } } }\n          ]\n        }\n      ]\n    }\n  ) {\n    affected_rows\n    message\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"soft-delete",children:"Soft Delete"}),"\n",(0,i.jsxs)(n.p,{children:["For tables with soft delete enabled (using ",(0,i.jsx)(n.code,{children:"@soft_delete"})," directive):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"mutation {\n  delete_customers(\n    filter: { id: { eq: 123 } }\n  ) {\n    affected_rows  # Record marked as deleted, not physically removed\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The record is not physically deleted but marked with a ",(0,i.jsx)(n.code,{children:"deleted_at"})," timestamp. To query soft-deleted records, use the ",(0,i.jsx)(n.code,{children:"@with_deleted"})," directive:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers @with_deleted {\n    id\n    name\n    email\n    deleted_at\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"To permanently delete soft-deleted records:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"mutation {\n  delete_customers(\n    filter: {\n      deleted_at: { is_null: false }\n    }\n    hard_delete: true\n  ) {\n    affected_rows\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"return-values",children:"Return Values"}),"\n",(0,i.jsx)(n.h3,{id:"insert-return-types",children:"Insert Return Types"}),"\n",(0,i.jsx)(n.p,{children:"For tables with primary keys, insert mutations return the inserted record(s):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_customers(data: { name: "Test User", email: "test@example.com" }) {\n    id          # Auto-generated primary key\n    name\n    email\n    created_at  # Auto-generated timestamp\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"operation-result-type",children:"Operation Result Type"}),"\n",(0,i.jsxs)(n.p,{children:["For tables without primary keys, or for update/delete operations, mutations return ",(0,i.jsx)(n.code,{children:"OperationResult"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"type OperationResult {\n  affected_rows: Int!    # Number of rows affected\n  success: Boolean!      # Operation success status\n  message: String        # Optional message (e.g., error details)\n  last_id: BigInt        # Last inserted ID (for inserts with sequences)\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "update_customers": {\n      "affected_rows": 5,\n      "success": true,\n      "message": "Updated successfully"\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"transaction-behavior",children:"Transaction Behavior"}),"\n",(0,i.jsx)(n.p,{children:"All mutations within a single GraphQL request execute within a transaction. Either all operations succeed, or all are rolled back:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation ComplexTransaction {\n  # Step 1: Update inventory\n  update_inventory: update_products(\n    filter: { id: { eq: 100 } }\n    data: { stock: 45 }\n  ) {\n    affected_rows\n  }\n\n  # Step 2: Create order\n  create_order: insert_orders(data: {\n    customer_id: 50\n    product_id: 100\n    quantity: 5\n    total_amount: 250.00\n  }) {\n    id\n    order_number\n  }\n\n  # Step 3: Update customer\n  update_customer: update_customers(\n    filter: { id: { eq: 50 } }\n    data: {\n      last_order_date: "2024-01-15"\n      total_orders: { increment: 1 }\n    }\n  ) {\n    affected_rows\n  }\n\n  # Step 4: Insert audit log\n  create_audit: insert_audit_logs(data: {\n    action: "order_created"\n    entity_type: "order"\n    user_id: 50\n  }) {\n    id\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"If any operation fails, the entire transaction is rolled back, ensuring data consistency."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important:"})," All mutations in a transaction must operate on tables within the same data source. Cross-data-source transactions are not supported."]}),"\n",(0,i.jsx)(n.h2,{id:"input-types",children:"Input Types"}),"\n",(0,i.jsx)(n.p,{children:"Hugr automatically generates input types for mutations:"}),"\n",(0,i.jsx)(n.h3,{id:"insert-input-type",children:"Insert Input Type"}),"\n",(0,i.jsxs)(n.p,{children:["The insert input type (",(0,i.jsx)(n.code,{children:"<table>_mut_input_data"}),") includes:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All direct fields"}),"\n",(0,i.jsx)(n.li,{children:"Nested relations (one-to-one, many-to-one, one-to-many)"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"input customers_mut_input_data {\n  # Scalar fields\n  name: String!\n  email: String!\n  phone: String\n  status: String\n\n  # One-to-one or many-to-one relations\n  profile: customer_profiles_mut_input_data\n\n  # One-to-many relations\n  addresses: [customer_addresses_mut_input_data]\n  orders: [orders_mut_input_data]\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"update-input-type",children:"Update Input Type"}),"\n",(0,i.jsxs)(n.p,{children:["The update input type (",(0,i.jsx)(n.code,{children:"<table>_mut_data"}),") contains only direct fields (no relations):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"input customers_mut_data {\n  name: String\n  email: String\n  phone: String\n  status: String\n  updated_at: Timestamp\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Relations cannot be updated through update mutations. To modify relations, use separate insert/update/delete mutations for the related tables."}),"\n",(0,i.jsx)(n.h2,{id:"auto-generated-values",children:"Auto-Generated Values"}),"\n",(0,i.jsx)(n.h3,{id:"sequences-and-auto-increment",children:"Sequences and Auto-Increment"}),"\n",(0,i.jsx)(n.p,{children:"Fields with sequences or auto-increment are automatically populated:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'type orders @table(name: "orders") {\n  id: BigInt! @pk @default(sequence: "orders_id_seq")\n  order_number: Int! @default(sequence: "order_number_seq")\n  created_at: Timestamp! @default(insert_exp: "NOW()")\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"You don't need to provide these fields in insert mutations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"mutation {\n  insert_orders(data: {\n    customer_id: 50\n    total_amount: 100.00\n    # id, order_number, and created_at are auto-generated\n  }) {\n    id           # Auto-generated\n    order_number # Auto-generated\n    created_at   # Auto-generated\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"default-values",children:"Default Values"}),"\n",(0,i.jsx)(n.p,{children:"Fields with default values are optional in mutations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'type customers @table(name: "customers") {\n  status: String! @default(value: "pending")\n  created_at: Timestamp! @default(insert_exp: "NOW()")\n  updated_at: Timestamp! @default(\n    insert_exp: "NOW()",\n    update_exp: "NOW()"\n  )\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_customers(data: {\n    name: "John Doe"\n    email: "john@example.com"\n    # status defaults to "pending"\n    # created_at defaults to NOW()\n    # updated_at defaults to NOW()\n  }) {\n    id\n    status      # Will be "pending"\n    created_at  # Will be current timestamp\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"cache-invalidation",children:"Cache Invalidation"}),"\n",(0,i.jsxs)(n.p,{children:["When using the ",(0,i.jsx)(n.code,{children:"@cache"})," directive on data objects, Hugr automatically invalidates the cache when mutations are executed."]}),"\n",(0,i.jsx)(n.h3,{id:"schema-level-cache",children:"Schema-Level Cache"}),"\n",(0,i.jsxs)(n.p,{children:["If a data object is marked with ",(0,i.jsx)(n.code,{children:"@cache"})," and ",(0,i.jsx)(n.code,{children:"tags"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'type customers @table(name: "customers")\n  @cache(ttl: 300, tags: ["customers"]) {\n  id: ID!\n  name: String!\n  email: String!\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Any mutation on the ",(0,i.jsx)(n.code,{children:"customers"})," table automatically invalidates all cached queries with the ",(0,i.jsx)(n.code,{children:"customers"})," tag:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  # This mutation will invalidate all cached queries tagged with "customers"\n  insert_customers(data: {\n    name: "New Customer"\n    email: "new@example.com"\n  }) {\n    id\n    name\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"manual-cache-invalidation",children:"Manual Cache Invalidation"}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"@invalidate_cache"})," directive to manually invalidate cache:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"mutation {\n  # Update data and invalidate cache\n  update_products(\n    filter: { category_id: { eq: 5 } }\n    data: { discount_percentage: 20 }\n  ) @invalidate_cache {\n    affected_rows\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"selective-cache-invalidation",children:"Selective Cache Invalidation"}),"\n",(0,i.jsx)(n.p,{children:"For complex scenarios, use tags to invalidate specific cached queries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_orders(data: {\n    customer_id: 123\n    total_amount: 500.00\n  }) {\n    id\n  }\n\n  # Invalidate customer-specific cache\n  _invalidate_cache_by_tags: invalidate_cache(tags: ["customer_123", "orders"])\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/docs/engine-configuration/cache",children:"Cache Directives"})," for more details."]}),"\n",(0,i.jsx)(n.h2,{id:"semantic-search-integration",children:"Semantic Search Integration"}),"\n",(0,i.jsxs)(n.p,{children:["For data objects with embeddings configured for semantic search, use the ",(0,i.jsx)(n.code,{children:"summary"})," parameter to generate vector representations:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_documents(\n    data: {\n      title: "Introduction to GraphQL"\n      content: "GraphQL is a query language for APIs and a runtime for fulfilling those queries with your existing data."\n      author_id: 10\n    }\n    summary: "GraphQL is a query language for APIs and a runtime for fulfilling those queries with your existing data."\n  ) {\n    id\n    title\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"summary"})," parameter:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Triggers embedding generation using the configured embedding model"}),"\n",(0,i.jsx)(n.li,{children:"Stores the vector representation for semantic search"}),"\n",(0,i.jsx)(n.li,{children:"Can be different from the content field (e.g., a concise summary)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"update-with-embeddings",children:"Update with Embeddings"}),"\n",(0,i.jsxs)(n.p,{children:["When updating documents, provide the ",(0,i.jsx)(n.code,{children:"summary"})," parameter to regenerate embeddings:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  update_documents(\n    filter: { id: { eq: 1 } }\n    data: {\n      content: "Updated content about GraphQL and its benefits."\n    }\n    summary: "GraphQL query language benefits and use cases."\n  ) {\n    affected_rows\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/docs/graphql/queries/vector-search",children:"Vector Search"})," for more details on semantic search."]}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.h3,{id:"constraint-violations",children:"Constraint Violations"}),"\n",(0,i.jsx)(n.p,{children:"If a mutation violates database constraints (unique, foreign key, not null), Hugr returns an error:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_customers(data: {\n    name: "John Doe"\n    email: "existing@example.com"  # Duplicate email\n  }) {\n    id\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Response:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "errors": [\n    {\n      "message": "duplicate key value violates unique constraint \\"customers_email_key\\"",\n      "path": ["insert_customers"],\n      "extensions": {\n        "code": "CONSTRAINT_VIOLATION"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"validation-errors",children:"Validation Errors"}),"\n",(0,i.jsx)(n.p,{children:"Invalid input data returns validation errors:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "errors": [\n    {\n      "message": "Field \'email\' is required but not provided",\n      "path": ["insert_customers"],\n      "extensions": {\n        "code": "BAD_USER_INPUT"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"transaction-failures",children:"Transaction Failures"}),"\n",(0,i.jsx)(n.p,{children:"If any mutation in a transaction fails, all operations are rolled back:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "errors": [\n    {\n      "message": "Transaction rolled back due to constraint violation in update_inventory",\n      "extensions": {\n        "code": "TRANSACTION_FAILED"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"filter-operators",children:"Filter Operators"}),"\n",(0,i.jsxs)(n.p,{children:["Mutations support the same filter operators as queries. See ",(0,i.jsx)(n.a,{href:"/docs/graphql/queries/filtering",children:"Filtering"})," for complete documentation."]}),"\n",(0,i.jsx)(n.p,{children:"Common operators:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Equality"}),": ",(0,i.jsx)(n.code,{children:"eq"}),", ",(0,i.jsx)(n.code,{children:"neq"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Comparison"}),": ",(0,i.jsx)(n.code,{children:"gt"}),", ",(0,i.jsx)(n.code,{children:"gte"}),", ",(0,i.jsx)(n.code,{children:"lt"}),", ",(0,i.jsx)(n.code,{children:"lte"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"List"}),": ",(0,i.jsx)(n.code,{children:"in"}),", ",(0,i.jsx)(n.code,{children:"not_in"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Text"}),": ",(0,i.jsx)(n.code,{children:"like"}),", ",(0,i.jsx)(n.code,{children:"ilike"}),", ",(0,i.jsx)(n.code,{children:"starts_with"}),", ",(0,i.jsx)(n.code,{children:"ends_with"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Null checks"}),": ",(0,i.jsx)(n.code,{children:"is_null"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Boolean logic"}),": ",(0,i.jsx)(n.code,{children:"_and"}),", ",(0,i.jsx)(n.code,{children:"_or"}),", ",(0,i.jsx)(n.code,{children:"_not"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Relations"}),": Filter by related object fields"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example with multiple operators:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  delete_orders(\n    filter: {\n      _or: [\n        { status: { in: ["cancelled", "expired"] } }\n        {\n          _and: [\n            { created_at: { lt: "2023-01-01" } }\n            { customer: {\n                status: { eq: "inactive" }\n                last_login: { lt: "2022-01-01" }\n              }\n            }\n          ]\n        }\n      ]\n    }\n  ) {\n    affected_rows\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"use-transactions-for-related-operations",children:"Use Transactions for Related Operations"}),"\n",(0,i.jsx)(n.p,{children:"Always group related mutations in a single request to ensure atomicity:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"# Good: Atomic transaction\nmutation {\n  deduct_inventory: update_products(\n    filter: { id: { eq: 100 } }\n    data: { stock: { decrement: 5 } }\n  ) {\n    affected_rows\n  }\n\n  create_order: insert_orders(data: {\n    product_id: 100\n    quantity: 5\n  }) {\n    id\n  }\n}\n\n# Bad: Separate requests (not atomic)\n# Request 1\nmutation { update_products(...) { affected_rows } }\n# Request 2\nmutation { insert_orders(...) { id } }\n"})}),"\n",(0,i.jsx)(n.h3,{id:"request-only-needed-fields",children:"Request Only Needed Fields"}),"\n",(0,i.jsx)(n.p,{children:"For insert mutations with large schemas, only request fields you need:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"mutation {\n  insert_customers(data: { ... }) {\n    id  # Only get the ID back\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"use-batch-operations",children:"Use Batch Operations"}),"\n",(0,i.jsx)(n.p,{children:"For multiple inserts, use batch operations for better performance:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'# Good: Single batch operation\nmutation {\n  insert_products_batch(data: [\n    { name: "Product 1", price: 10 }\n    { name: "Product 2", price: 20 }\n    { name: "Product 3", price: 30 }\n  ]) {\n    affected_rows\n  }\n}\n\n# Avoid: Multiple single inserts\nmutation {\n  p1: insert_products(data: { name: "Product 1", price: 10 }) { id }\n  p2: insert_products(data: { name: "Product 2", price: 20 }) { id }\n  p3: insert_products(data: { name: "Product 3", price: 30 }) { id }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"validate-input-data",children:"Validate Input Data"}),"\n",(0,i.jsx)(n.p,{children:"Validate data on the client side before sending mutations to reduce errors:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Client-side validation\nif (!email.match(/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/)) {\n  throw new Error("Invalid email format");\n}\n\n// Then send mutation\nconst result = await client.mutate({\n  mutation: INSERT_CUSTOMER,\n  variables: { email }\n});\n'})}),"\n",(0,i.jsx)(n.h3,{id:"handle-errors-gracefully",children:"Handle Errors Gracefully"}),"\n",(0,i.jsx)(n.p,{children:"Always check for errors in mutation responses:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const result = await client.mutate({\n  mutation: INSERT_CUSTOMER,\n  variables: { data }\n});\n\nif (result.errors) {\n  // Handle specific error types\n  result.errors.forEach(error => {\n    if (error.extensions?.code === 'CONSTRAINT_VIOLATION') {\n      // Handle constraint violation\n    } else if (error.extensions?.code === 'BAD_USER_INPUT') {\n      // Handle validation error\n    }\n  });\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"use-aliases-for-multiple-mutations",children:"Use Aliases for Multiple Mutations"}),"\n",(0,i.jsx)(n.p,{children:"When executing multiple mutations of the same type, use aliases:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"mutation {\n  createCustomer1: insert_customers(data: { ... }) { id }\n  createCustomer2: insert_customers(data: { ... }) { id }\n  createCustomer3: insert_customers(data: { ... }) { id }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"consider-cache-invalidation-strategy",children:"Consider Cache Invalidation Strategy"}),"\n",(0,i.jsxs)(n.p,{children:["Plan your cache invalidation strategy when using ",(0,i.jsx)(n.code,{children:"@cache"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'# Strategy 1: Let auto-invalidation work\ntype products @table(name: "products")\n  @cache(ttl: 300, tags: ["products"]) {\n  # ...\n}\n\n# Strategy 2: Manual selective invalidation\nmutation {\n  update_products(filter: { category_id: { eq: 5 } }, data: { ... }) {\n    affected_rows\n  }\n\n  # Only invalidate category-specific cache\n  _invalidate: invalidate_cache(tags: ["products_category_5"])\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/engine-configuration/schema-definition/data-objects/mutations",children:"Mutations Definition"})," - Learn how to define mutations in schema"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/graphql/queries/filtering",children:"Filtering"})," - Complete guide to filter operators"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/graphql/queries/relations",children:"Relations"})," - Working with related data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/engine-configuration/cache",children:"Cache Directives"})," - Cache management"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/engine-configuration/schema-definition/data-types",children:"Data Types"})," - Supported data types"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/graphql/queries/vector-search",children:"Vector Search"})," - Semantic search with embeddings"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var a=t(6540);const i={},s=a.createContext(i);function r(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);