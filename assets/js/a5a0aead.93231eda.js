"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[1707],{6467:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>t,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"graphql/queries/dynamic-joins","title":"Dynamic Joins (_join)","description":"Every data object in Hugr includes a special _join field that allows you to create ad-hoc joins at query time. This is particularly useful for joining data that doesn\'t have predefined foreign key relationships, joining across different data sources, or creating complex join patterns dynamically.","source":"@site/docs/5-graphql/1-queries/8-dynamic-joins.md","sourceDirName":"5-graphql/1-queries","slug":"/graphql/queries/dynamic-joins","permalink":"/docs/graphql/queries/dynamic-joins","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/5-graphql/1-queries/8-dynamic-joins.md","tags":[],"version":"current","lastUpdatedBy":"Claude","lastUpdatedAt":1762461702000,"sidebarPosition":8,"frontMatter":{"title":"Dynamic Joins (_join)","sidebar_position":8},"sidebar":"docsSidebar","previous":{"title":"Aggregations","permalink":"/docs/graphql/queries/aggregations"},"next":{"title":"Spatial Queries (_spatial)","permalink":"/docs/graphql/queries/spatial"}}');var s=i(4848),d=i(8453);const l={title:"Dynamic Joins (_join)",sidebar_position:8},o="Dynamic Joins (_join)",t={},a=[{value:"Basic Dynamic Join",id:"basic-dynamic-join",level:2},{value:"Simple Join by Single Field",id:"simple-join-by-single-field",level:3},{value:"Join by Multiple Fields",id:"join-by-multiple-fields",level:3},{value:"Cross-Source Joins",id:"cross-source-joins",level:2},{value:"Multi-Source Aggregation",id:"multi-source-aggregation",level:3},{value:"Joining with Filters",id:"joining-with-filters",level:2},{value:"Filter Joined Data",id:"filter-joined-data",level:3},{value:"Filter Before Join",id:"filter-before-join",level:3},{value:"Sorting Joined Data",id:"sorting-joined-data",level:2},{value:"order_by for Pre-Join Sorting",id:"order_by-for-pre-join-sorting",level:3},{value:"nested_order_by for Post-Join Sorting",id:"nested_order_by-for-post-join-sorting",level:3},{value:"Pagination for Joined Data",id:"pagination-for-joined-data",level:2},{value:"limit and offset (Pre-Join)",id:"limit-and-offset-pre-join",level:3},{value:"nested_limit and nested_offset (Post-Join)",id:"nested_limit-and-nested_offset-post-join",level:3},{value:"Aggregating Joined Data",id:"aggregating-joined-data",level:2},{value:"Single Row Aggregation",id:"single-row-aggregation",level:3},{value:"Filtered Aggregation",id:"filtered-aggregation",level:3},{value:"Bucket Aggregation",id:"bucket-aggregation",level:3},{value:"Nested Bucket Aggregation",id:"nested-bucket-aggregation",level:3},{value:"Aggregating with Joined Data",id:"aggregating-with-joined-data",level:2},{value:"Using _join in Grouping Keys",id:"using-_join-in-grouping-keys",level:3},{value:"Complex Join Patterns",id:"complex-join-patterns",level:2},{value:"Chain Multiple Joins",id:"chain-multiple-joins",level:3},{value:"Multiple Joins on Same Level",id:"multiple-joins-on-same-level",level:3},{value:"Join with Function Results",id:"join-with-function-results",level:3},{value:"Using inner Argument",id:"using-inner-argument",level:2},{value:"LEFT JOIN (default)",id:"left-join-default",level:3},{value:"INNER JOIN",id:"inner-join",level:3},{value:"With Filters",id:"with-filters",level:3},{value:"Cross-Source INNER JOIN",id:"cross-source-inner-join",level:3},{value:"Advanced Join Scenarios",id:"advanced-join-scenarios",level:2},{value:"Join with Computed Fields",id:"join-with-computed-fields",level:3},{value:"Join with Array Fields",id:"join-with-array-fields",level:3},{value:"Self-Join",id:"self-join",level:3},{value:"Combining _join with _spatial",id:"combining-_join-with-_spatial",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"1. Filter Joined Data",id:"1-filter-joined-data",level:3},{value:"2. Use distinct for Performance",id:"2-use-distinct-for-performance",level:3},{value:"3. Always Use Limit",id:"3-always-use-limit",level:3},{value:"4. Filter Parent Data Early",id:"4-filter-parent-data-early",level:3},{value:"5. Use Aggregations When Possible",id:"5-use-aggregations-when-possible",level:3},{value:"6. Index Join Fields",id:"6-index-join-fields",level:3},{value:"7. Limit Parent Query",id:"7-limit-parent-query",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Enrichment from External Source",id:"enrichment-from-external-source",level:3},{value:"Denormalized Reporting",id:"denormalized-reporting",level:3},{value:"Audit Trail",id:"audit-trail",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Planning Errors (SQL Generation)",id:"planning-errors-sql-generation",level:3},{value:"SQL Execution Errors",id:"sql-execution-errors",level:3},{value:"Next Steps",id:"next-steps",level:2}];function c(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"dynamic-joins-_join",children:"Dynamic Joins (_join)"})}),"\n",(0,s.jsxs)(e.p,{children:["Every data object in Hugr includes a special ",(0,s.jsx)(e.code,{children:"_join"})," field that allows you to create ad-hoc joins at query time. This is particularly useful for joining data that doesn't have predefined foreign key relationships, joining across different data sources, or creating complex join patterns dynamically."]}),"\n",(0,s.jsx)(e.h2,{id:"basic-dynamic-join",children:"Basic Dynamic Join"}),"\n",(0,s.jsx)(e.h3,{id:"simple-join-by-single-field",children:"Simple Join by Single Field"}),"\n",(0,s.jsx)(e.p,{children:"Join two data objects by matching field values:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    email\n    # Join with orders at query time\n    _join(fields: ["id"]) {\n      orders(fields: ["customer_id"]) {\n        id\n        total\n        created_at\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["This creates a join where ",(0,s.jsx)(e.code,{children:"customers.id = orders.customer_id"}),"."]}),"\n",(0,s.jsx)(e.h3,{id:"join-by-multiple-fields",children:"Join by Multiple Fields"}),"\n",(0,s.jsx)(e.p,{children:"For composite keys, specify multiple fields:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  order_details {\n    order_id\n    product_id\n    quantity\n    # Join by multiple fields\n    _join(fields: ["product_id", "supplier_id"]) {\n      supplier_products(fields: ["product_id", "supplier_id"]) {\n        price\n        lead_time\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["This creates: ",(0,s.jsx)(e.code,{children:"order_details.product_id = supplier_products.product_id AND order_details.supplier_id = supplier_products.supplier_id"}),"."]}),"\n",(0,s.jsx)(e.h2,{id:"cross-source-joins",children:"Cross-Source Joins"}),"\n",(0,s.jsx)(e.p,{children:"Join data from different data sources:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  # PostgreSQL customers\n  postgres_customers {\n    id\n    email\n    # Join with MySQL users by email\n    _join(fields: ["email"]) {\n      mysql_users(fields: ["email"]) {\n        last_login\n        preferences\n        activity_score\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"multi-source-aggregation",children:"Multi-Source Aggregation"}),"\n",(0,s.jsx)(e.p,{children:"Combine data from multiple sources:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  # DuckDB analytics\n  analytics_customers {\n    customer_id\n    lifetime_value\n    # Join with PostgreSQL orders\n    _join(fields: ["customer_id"]) {\n      postgres_orders(fields: ["customer_id"]) {\n        id\n        status\n        total\n      }\n      # And aggregate\n      postgres_orders_aggregation(fields: ["customer_id"]) {\n        _rows_count\n        total { sum avg }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"joining-with-filters",children:"Joining with Filters"}),"\n",(0,s.jsx)(e.h3,{id:"filter-joined-data",children:"Filter Joined Data"}),"\n",(0,s.jsx)(e.p,{children:"Apply filters to the joined data:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      orders(\n        fields: ["customer_id"]\n        filter: {\n          _and: [\n            { status: { eq: "completed" } }\n            { total: { gte: 100 } }\n          ]\n        }\n      ) {\n        id\n        total\n        status\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"filter-before-join",children:"Filter Before Join"}),"\n",(0,s.jsxs)(e.p,{children:["The ",(0,s.jsx)(e.code,{children:"filter"})," argument applies ",(0,s.jsx)(e.strong,{children:"before"})," the join:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      # Filter orders before joining\n      orders(\n        fields: ["customer_id"]\n        filter: {\n          created_at: { gte: "2024-01-01" }\n        }\n      ) {\n        id\n        created_at\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"sorting-joined-data",children:"Sorting Joined Data"}),"\n",(0,s.jsx)(e.h3,{id:"order_by-for-pre-join-sorting",children:"order_by for Pre-Join Sorting"}),"\n",(0,s.jsxs)(e.p,{children:["Sort ",(0,s.jsx)(e.strong,{children:"before"})," the join:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      orders(\n        fields: ["customer_id"]\n        order_by: [{ field: "created_at", direction: DESC }]\n        limit: 5\n      ) {\n        id\n        created_at\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"nested_order_by-for-post-join-sorting",children:"nested_order_by for Post-Join Sorting"}),"\n",(0,s.jsxs)(e.p,{children:["Sort ",(0,s.jsx)(e.strong,{children:"after"})," the join:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      orders(\n        fields: ["customer_id"]\n        nested_order_by: [{ field: "total", direction: DESC }]\n        nested_limit: 5\n      ) {\n        id\n        total\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"pagination-for-joined-data",children:"Pagination for Joined Data"}),"\n",(0,s.jsx)(e.h3,{id:"limit-and-offset-pre-join",children:"limit and offset (Pre-Join)"}),"\n",(0,s.jsx)(e.p,{children:"Applied before the join:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    _join(fields: ["id"]) {\n      orders(\n        fields: ["customer_id"]\n        limit: 100\n        offset: 0\n      ) {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"nested_limit-and-nested_offset-post-join",children:"nested_limit and nested_offset (Post-Join)"}),"\n",(0,s.jsx)(e.p,{children:"Applied after the join (per parent record):"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers(limit: 10) {\n    id\n    name\n    _join(fields: ["id"]) {\n      # Get 5 orders per customer\n      orders(\n        fields: ["customer_id"]\n        nested_order_by: [{ field: "created_at", direction: DESC }]\n        nested_limit: 5\n        nested_offset: 0\n      ) {\n        id\n        created_at\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"aggregating-joined-data",children:"Aggregating Joined Data"}),"\n",(0,s.jsx)(e.h3,{id:"single-row-aggregation",children:"Single Row Aggregation"}),"\n",(0,s.jsx)(e.p,{children:"Aggregate all joined records:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      orders_aggregation(fields: ["customer_id"]) {\n        _rows_count\n        total {\n          sum\n          avg\n          min\n          max\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"filtered-aggregation",children:"Filtered Aggregation"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      # All orders\n      all_orders: orders_aggregation(fields: ["customer_id"]) {\n        _rows_count\n        total { sum }\n      }\n      # Completed orders only\n      completed_orders: orders_aggregation(\n        fields: ["customer_id"]\n        filter: { status: { eq: "completed" } }\n      ) {\n        _rows_count\n        total { sum avg }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"bucket-aggregation",children:"Bucket Aggregation"}),"\n",(0,s.jsx)(e.p,{children:"Group and aggregate joined data:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      # Group orders by status\n      orders_bucket_aggregation(fields: ["customer_id"]) {\n        key {\n          status\n        }\n        aggregations {\n          _rows_count\n          total {\n            sum\n            avg\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"nested-bucket-aggregation",children:"Nested Bucket Aggregation"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      orders_bucket_aggregation(\n        fields: ["customer_id"]\n        order_by: [\n          { field: "aggregations.total.sum", direction: DESC }\n        ]\n      ) {\n        key {\n          status\n          created_at(bucket: month)\n        }\n        aggregations {\n          _rows_count\n          total { sum avg }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"aggregating-with-joined-data",children:"Aggregating with Joined Data"}),"\n",(0,s.jsx)(e.p,{children:"Join in aggregation queries:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  # Aggregate products\n  products_aggregation {\n    _rows_count\n    price { avg }\n    # Join with reviews and aggregate\n    _join(fields: ["id"]) {\n      reviews_aggregation(fields: ["product_id"]) {\n        _rows_count\n        rating {\n          avg\n          min\n          max\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"Bucket aggregation with joins:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  products_bucket_aggregation {\n    key {\n      category {\n        name\n      }\n    }\n    aggregations {\n      _rows_count\n      price { avg }\n      # Join and aggregate reviews per category\n      _join(fields: ["id"]) {\n        reviews_aggregation(fields: ["product_id"]) {\n          _rows_count\n          rating { avg }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"using-_join-in-grouping-keys",children:"Using _join in Grouping Keys"}),"\n",(0,s.jsxs)(e.p,{children:["You can use ",(0,s.jsx)(e.code,{children:"_join"})," in bucket aggregation keys to group by fields from joined data:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  orders_bucket_aggregation {\n    key {\n      # Group by joined customer\'s country\n      _join(fields: ["customer_id"]) {\n        customers(fields: ["id"]) {\n          country\n          segment\n        }\n      }\n      status\n    }\n    aggregations {\n      _rows_count\n      total { sum avg }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"This groups orders by customer country, customer segment, and order status."}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Practical example"})," - Sales by region and product category:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  sales_bucket_aggregation {\n    key {\n      # Join to get customer region\n      customer_info: _join(fields: ["customer_id"]) {\n        customers(fields: ["id"]) {\n          region\n          city\n        }\n      }\n      # Join to get product category\n      product_info: _join(fields: ["product_id"]) {\n        products(fields: ["id"]) {\n          category {\n            name\n          }\n        }\n      }\n    }\n    aggregations {\n      _rows_count\n      amount { sum avg }\n      quantity { sum }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"This creates a multi-dimensional analysis grouping sales by customer region, customer city, and product category."}),"\n",(0,s.jsx)(e.h2,{id:"complex-join-patterns",children:"Complex Join Patterns"}),"\n",(0,s.jsx)(e.h3,{id:"chain-multiple-joins",children:"Chain Multiple Joins"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # First join: get orders\n    _join(fields: ["id"]) {\n      orders(fields: ["customer_id"]) {\n        id\n        total\n        # Nested join: get order items\n        _join(fields: ["id"]) {\n          order_details(fields: ["order_id"]) {\n            quantity\n            product {\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"multiple-joins-on-same-level",children:"Multiple Joins on Same Level"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Important:"})," When using multiple ",(0,s.jsx)(e.code,{children:"_join"})," fields on the same level, you must use aliases to avoid name conflicts."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    email\n    # MUST use aliases for multiple joins\n    orders_join: _join(fields: ["id"]) {\n      # Join with orders\n      orders(fields: ["customer_id"]) {\n        id\n        total\n      }\n    }\n    # Second join with different source\n    crm_join: _join(fields: ["email"]) {\n      # Join with external system\n      crm_contacts(fields: ["email"]) {\n        last_contact\n        notes\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"join-with-function-results",children:"Join with Function Results"}),"\n",(0,s.jsx)(e.p,{children:"Combine joins with function calls:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # Get recommendations from function\n    recommendations(limit: 5) {\n      product_id\n      score\n      # Join to get product details\n      _join(fields: ["product_id"]) {\n        products(fields: ["id"]) {\n          id\n          name\n          price\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"using-inner-argument",children:"Using inner Argument"}),"\n",(0,s.jsxs)(e.p,{children:["Control join type (LEFT vs INNER). By default, dynamic joins use LEFT JOIN, which includes all parent records even if no matching child records exist. Use ",(0,s.jsx)(e.code,{children:"inner: true"})," to switch to INNER JOIN behavior."]}),"\n",(0,s.jsx)(e.h3,{id:"left-join-default",children:"LEFT JOIN (default)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # LEFT JOIN - includes all customers\n    _join(fields: ["id"]) {\n      orders(fields: ["customer_id"]) {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Result:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"All customers are returned"}),"\n",(0,s.jsx)(e.li,{children:"Customers without orders have empty joined data"}),"\n",(0,s.jsx)(e.li,{children:"Use when you want to see all parent records"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"inner-join",children:"INNER JOIN"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    # INNER JOIN - only customers with orders\n    _join(fields: ["id"]) {\n      orders(\n        fields: ["customer_id"]\n        inner: true\n      ) {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Result:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Only customers with orders are returned"}),"\n",(0,s.jsx)(e.li,{children:"Customers without orders are completely excluded"}),"\n",(0,s.jsx)(e.li,{children:"Use when you only need records with matching joins"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"with-filters",children:"With Filters"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      # Only customers with high-value orders\n      orders(\n        fields: ["customer_id"]\n        filter: { total: { gte: 1000 } }\n        inner: true\n      ) {\n        id\n        total\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"Returns only customers who have orders with total >= 1000."}),"\n",(0,s.jsx)(e.h3,{id:"cross-source-inner-join",children:"Cross-Source INNER JOIN"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  postgres_customers {\n    id\n    email\n    # Only customers who exist in MySQL\n    _join(fields: ["email"]) {\n      mysql_users(\n        fields: ["email"]\n        inner: true\n      ) {\n        last_login\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"Returns only customers that exist in both databases."}),"\n",(0,s.jsx)(e.h2,{id:"advanced-join-scenarios",children:"Advanced Join Scenarios"}),"\n",(0,s.jsx)(e.h3,{id:"join-with-computed-fields",children:"Join with Computed Fields"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  orders {\n    id\n    customer_email  # Computed field\n    _join(fields: ["customer_email"]) {\n      external_users(fields: ["email"]) {\n        subscription_tier\n        account_status\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"join-with-array-fields",children:"Join with Array Fields"}),"\n",(0,s.jsxs)(e.p,{children:["When joining with array fields, joins use ",(0,s.jsx)(e.strong,{children:"strict equality"})," with logical AND across all specified fields."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  products {\n    id\n    primary_tag_id  # Single value field\n    # Join uses strict equality: products.primary_tag_id = tags.id\n    _join(fields: ["primary_tag_id"]) {\n      tags(fields: ["id"]) {\n        name\n        description\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Note:"})," Array field joins use exact value matching, not array containment. Multiple fields are joined with AND condition (field1 = field1 AND field2 = field2)."]}),"\n",(0,s.jsx)(e.h3,{id:"self-join",children:"Self-Join"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  employees {\n    id\n    name\n    manager_id\n    # Self-join to get manager info\n    _join(fields: ["manager_id"]) {\n      manager: employees(fields: ["id"]) {\n        id\n        name\n        title\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"combining-_join-with-_spatial",children:"Combining _join with _spatial"}),"\n",(0,s.jsx)(e.p,{children:"Join dynamically and then apply spatial filters:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    name\n    _join(fields: ["id"]) {\n      orders(fields: ["customer_id"]) {\n        id\n        delivery_location\n        # Spatial join on delivery locations\n        _spatial(field: "delivery_location", type: DWITHIN, buffer: 5000) {\n          warehouses(field: "location") {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsx)(e.h3,{id:"1-filter-joined-data",children:"1. Filter Joined Data"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Important:"})," Always apply filters to joined data to reduce the dataset and improve performance."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'# Good - Filter joined data\nquery {\n  customers {\n    id\n    _join(fields: ["id"]) {\n      orders(\n        fields: ["customer_id"]\n        filter: {\n          created_at: { gte: "2024-01-01" }\n          status: { eq: "completed" }\n        }\n      ) {\n        id\n        total\n      }\n    }\n  }\n}\n\n# Avoid - Fetching all orders without filters\nquery {\n  customers {\n    id\n    _join(fields: ["id"]) {\n      orders(fields: ["customer_id"]) {\n        id\n        total\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"2-use-distinct-for-performance",children:"2. Use distinct for Performance"}),"\n",(0,s.jsxs)(e.p,{children:["Use ",(0,s.jsx)(e.code,{children:"distinct"})," parameter when joining to eliminate duplicate rows and speed up queries:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    _join(fields: ["id"]) {\n      orders(\n        fields: ["customer_id"]\n        distinct: true  # Eliminates duplicate rows\n      ) {\n        status\n        payment_method\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"distinct"})," is particularly useful:"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"When joining produces duplicate rows"}),"\n",(0,s.jsx)(e.li,{children:"In aggregations to count unique values"}),"\n",(0,s.jsx)(e.li,{children:"When fetching lookup/reference data"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"3-always-use-limit",children:"3. Always Use Limit"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'# Good - Limit joined data\nquery {\n  customers {\n    id\n    _join(fields: ["id"]) {\n      orders(\n        fields: ["customer_id"]\n        limit: 100\n      ) {\n        id\n      }\n    }\n  }\n}\n\n# Avoid - May fetch thousands of orders\nquery {\n  customers {\n    id\n    _join(fields: ["id"]) {\n      orders(fields: ["customer_id"]) {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"4-filter-parent-data-early",children:"4. Filter Parent Data Early"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'# Good - Filter before join\nquery {\n  customers(filter: { country: { eq: "USA" } }) {\n    id\n    _join(fields: ["id"]) {\n      orders(fields: ["customer_id"]) {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"5-use-aggregations-when-possible",children:"5. Use Aggregations When Possible"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'# Better - Use aggregation\nquery {\n  customers {\n    id\n    _join(fields: ["id"]) {\n      orders_aggregation(fields: ["customer_id"]) {\n        _rows_count\n        total { sum }\n      }\n    }\n  }\n}\n\n# Avoid - Fetching all orders just for count\nquery {\n  customers {\n    id\n    _join(fields: ["id"]) {\n      orders(fields: ["customer_id"]) {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"6-index-join-fields",children:"6. Index Join Fields"}),"\n",(0,s.jsx)(e.p,{children:"Ensure indexes on:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Source fields (left side of join)"}),"\n",(0,s.jsx)(e.li,{children:"Target fields (right side of join)"}),"\n",(0,s.jsx)(e.li,{children:"Fields used in filters"}),"\n",(0,s.jsx)(e.li,{children:"Fields used in sorting"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"7-limit-parent-query",children:"7. Limit Parent Query"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'# Good - Limit parent records\nquery {\n  customers(limit: 10) {\n    id\n    _join(fields: ["id"]) {\n      orders(fields: ["customer_id"]) {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,s.jsx)(e.h3,{id:"enrichment-from-external-source",children:"Enrichment from External Source"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  products {\n    id\n    sku\n    # Enrich with external inventory data\n    _join(fields: ["sku"]) {\n      external_inventory(fields: ["sku"]) {\n        warehouse_location\n        quantity_on_hand\n        next_restock_date\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"denormalized-reporting",children:"Denormalized Reporting"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  fact_sales {\n    sale_id\n    amount\n    sale_date\n    # Join multiple dimensions - use aliases for multiple joins\n    customer_dimension: _join(fields: ["customer_id"]) {\n      dim_customers(fields: ["id"]) {\n        name\n        segment\n      }\n    }\n    product_dimension: _join(fields: ["product_id"]) {\n      dim_products(fields: ["id"]) {\n        name\n        category\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"audit-trail",children:"Audit Trail"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  orders {\n    id\n    created_at\n    updated_at\n    # Join with audit log\n    _join(fields: ["id"]) {\n      audit_log(\n        fields: ["entity_id"]\n        filter: {\n          entity_type: { eq: "order" }\n        }\n        order_by: [{ field: "timestamp", direction: DESC }]\n      ) {\n        timestamp\n        action\n        user_id\n        changes\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(e.p,{children:"Dynamic join errors are categorized into two types:"}),"\n",(0,s.jsx)(e.h3,{id:"planning-errors-sql-generation",children:"Planning Errors (SQL Generation)"}),"\n",(0,s.jsx)(e.p,{children:"These errors are detected during query planning when generating SQL. They include specific paths to the problematic query part and detailed error messages."}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Type mismatch:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id  # Int\n    _join(fields: ["id"]) {\n      # Error: Type mismatch - id is Int, customer_email is String\n      orders(fields: ["customer_email"]) {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"Response:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": [\n    {\n      "message": "Type mismatch in join fields: Int cannot be joined with String (field \'id\' vs \'customer_email\')",\n      "path": ["customers", "_join", "orders"],\n      "extensions": {\n        "code": "TYPE_MISMATCH"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Invalid field names:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    _join(fields: ["id"]) {\n      orders(fields: ["non_existent_field"]) {\n        id\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"Response:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": [\n    {\n      "message": "Field \'non_existent_field\' does not exist in type \'orders\'",\n      "path": ["customers", "_join", "orders"]\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"Planning errors are caught before SQL execution and provide:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Specific error paths pointing to the problematic query part"}),"\n",(0,s.jsx)(e.li,{children:"Clear error messages explaining what went wrong"}),"\n",(0,s.jsx)(e.li,{children:"Validation of field names, types, and join conditions"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"sql-execution-errors",children:"SQL Execution Errors"}),"\n",(0,s.jsx)(e.p,{children:"Errors during SQL execution (runtime errors in the database) are reported at the query level:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": [\n    {\n      "message": "SQL execution error: <database error message>"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Learn about ",(0,s.jsx)(e.a,{href:"/docs/graphql/queries/spatial",children:"Spatial Queries"})," for geographic joins"]}),"\n",(0,s.jsxs)(e.li,{children:["See ",(0,s.jsx)(e.a,{href:"/docs/graphql/queries/aggregations",children:"Aggregations"})," for aggregating joined data"]}),"\n",(0,s.jsxs)(e.li,{children:["Check ",(0,s.jsx)(e.a,{href:"/docs/graphql/queries/relations",children:"Relations"})," for predefined foreign key relationships"]}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>o});var r=i(6540);const s={},d=r.createContext(s);function l(n){const e=r.useContext(d);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),r.createElement(d.Provider,{value:e},n.children)}}}]);