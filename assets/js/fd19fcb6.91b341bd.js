"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[6614],{8453:(e,n,a)=>{a.d(n,{R:()=>t,x:()=>l});var s=a(6540);const r={},i=s.createContext(r);function t(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(i.Provider,{value:n},e.children)}},9545:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>c,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"graphql/queries/cube-hypertable","title":"Cube & Hypertable Queries","description":"Hugr provides special table type directives for optimized analytical and time-series queries. The @cube directive enables OLAP-style pre-aggregation for analytical workloads, while @hypertable leverages TimescaleDB for efficient time-series data handling.","source":"@site/docs/5-graphql/1-queries/13-cube-hypertable.md","sourceDirName":"5-graphql/1-queries","slug":"/graphql/queries/cube-hypertable","permalink":"/docs/graphql/queries/cube-hypertable","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/5-graphql/1-queries/13-cube-hypertable.md","tags":[],"version":"current","lastUpdatedBy":"Claude","lastUpdatedAt":1762461917000,"sidebarPosition":13,"frontMatter":{"title":"Cube & Hypertable Queries","sidebar_position":13},"sidebar":"docsSidebar","previous":{"title":"Generated Fields & Transformations","permalink":"/docs/graphql/queries/generated-fields"},"next":{"title":"Mutations: Create, Update, Delete","permalink":"/docs/graphql/mutations"}}');var r=a(4848),i=a(8453);const t={title:"Cube & Hypertable Queries",sidebar_position:13},l="Cube & Hypertable Queries",u={},o=[{value:"Cube Queries",id:"cube-queries",level:2},{value:"Schema Example",id:"schema-example",level:3},{value:"Basic Cube Queries",id:"basic-cube-queries",level:3},{value:"Measurement Aggregation Functions",id:"measurement-aggregation-functions",level:3},{value:"Numeric Types (Int, BigInt, Float)",id:"numeric-types-int-bigint-float",level:4},{value:"Boolean Types",id:"boolean-types",level:4},{value:"Date and Timestamp Types",id:"date-and-timestamp-types",level:4},{value:"Dimensions and Automatic Grouping",id:"dimensions-and-automatic-grouping",level:3},{value:"Relations in Cube Queries",id:"relations-in-cube-queries",level:3},{value:"Filtering Cube Data",id:"filtering-cube-data",level:3},{value:"Sorting Cube Results",id:"sorting-cube-results",level:3},{value:"Pagination with Cubes",id:"pagination-with-cubes",level:3},{value:"Mixed Measurements and Dimensions",id:"mixed-measurements-and-dimensions",level:3},{value:"Cube Aggregations",id:"cube-aggregations",level:3},{value:"Standard Aggregations",id:"standard-aggregations",level:4},{value:"Double Aggregation with measurement_func",id:"double-aggregation-with-measurement_func",level:4},{value:"Measurement as Dimension (Without measurement_func)",id:"measurement-as-dimension-without-measurement_func",level:4},{value:"Mixed: Dimensions and Double Aggregation",id:"mixed-dimensions-and-double-aggregation",level:4},{value:"Bucket Aggregations with Cubes",id:"bucket-aggregations-with-cubes",level:3},{value:"Hypertable Queries",id:"hypertable-queries",level:2},{value:"Schema Example",id:"schema-example-1",level:3},{value:"Basic Hypertable Queries",id:"basic-hypertable-queries",level:3},{value:"Time Bucketing in Hypertables",id:"time-bucketing-in-hypertables",level:3},{value:"Custom Time Intervals",id:"custom-time-intervals",level:3},{value:"Time-Range Queries",id:"time-range-queries",level:3},{value:"Continuous Aggregates",id:"continuous-aggregates",level:3},{value:"Downsampling Time-Series Data",id:"downsampling-time-series-data",level:3},{value:"Gap Filling",id:"gap-filling",level:3},{value:"Latest Values",id:"latest-values",level:3},{value:"Filtering by Sensor Conditions",id:"filtering-by-sensor-conditions",level:3},{value:"Combined Cube + Hypertable",id:"combined-cube--hypertable",level:2},{value:"Querying Combined Types",id:"querying-combined-types",level:3},{value:"Time-Series Analysis",id:"time-series-analysis",level:3},{value:"Real-Time Dashboard Query",id:"real-time-dashboard-query",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Cube Performance Tips",id:"cube-performance-tips",level:3},{value:"Hypertable Performance Tips",id:"hypertable-performance-tips",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Sales Analytics",id:"sales-analytics",level:3},{value:"IoT Monitoring",id:"iot-monitoring",level:3},{value:"Financial Metrics",id:"financial-metrics",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Planning Errors",id:"planning-errors",level:3},{value:"Execution Errors",id:"execution-errors",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"cube--hypertable-queries",children:"Cube & Hypertable Queries"})}),"\n",(0,r.jsxs)(n.p,{children:["Hugr provides special table type directives for optimized analytical and time-series queries. The ",(0,r.jsx)(n.code,{children:"@cube"})," directive enables OLAP-style pre-aggregation for analytical workloads, while ",(0,r.jsx)(n.code,{children:"@hypertable"})," leverages TimescaleDB for efficient time-series data handling."]}),"\n",(0,r.jsx)(n.h2,{id:"cube-queries",children:"Cube Queries"}),"\n",(0,r.jsxs)(n.p,{children:["Tables marked with ",(0,r.jsx)(n.code,{children:"@cube"})," are optimized for analytical queries with automatic pre-aggregation. Fields marked with ",(0,r.jsx)(n.code,{children:"@measurement"})," are aggregated, while all other fields become dimensions for grouping."]}),"\n",(0,r.jsx)(n.h3,{id:"schema-example",children:"Schema Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'type sales @table(name: "sales") @cube {\n  id: BigInt! @pk\n\n  # Dimensions (used for grouping)\n  customer_id: Int!\n  product_id: Int!\n  store_id: Int!\n  sale_date: Date!\n  region: String!\n\n  # Measurements (aggregated)\n  quantity: Int! @measurement\n  unit_price: Float! @measurement\n  total_amount: Float! @measurement\n  discount: Float! @measurement\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"basic-cube-queries",children:"Basic Cube Queries"}),"\n",(0,r.jsxs)(n.p,{children:["Query cubes using the ",(0,r.jsx)(n.code,{children:"measurement_func"})," argument on measurement fields:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales {\n    # Dimensions (grouped by)\n    sale_date(bucket: month)\n    region\n\n    # Measurements with aggregation functions\n    total_revenue: total_amount(measurement_func: SUM)\n    total_quantity: quantity(measurement_func: SUM)\n    avg_price: unit_price(measurement_func: AVG)\n    max_discount: discount(measurement_func: MAX)\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "sales": [\n      {\n        "sale_date": "2024-01-01T00:00:00Z",\n        "region": "North",\n        "total_revenue": 125000.00,\n        "total_quantity": 850,\n        "avg_price": 147.06,\n        "max_discount": 25.00\n      },\n      {\n        "sale_date": "2024-01-01T00:00:00Z",\n        "region": "South",\n        "total_revenue": 98000.00,\n        "total_quantity": 720,\n        "avg_price": 136.11,\n        "max_discount": 20.00\n      }\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"measurement-aggregation-functions",children:"Measurement Aggregation Functions"}),"\n",(0,r.jsxs)(n.p,{children:["Available ",(0,r.jsx)(n.code,{children:"measurement_func"})," values by field type:"]}),"\n",(0,r.jsx)(n.h4,{id:"numeric-types-int-bigint-float",children:"Numeric Types (Int, BigInt, Float)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales {\n    region\n\n    # Sum of all values\n    total: total_amount(measurement_func: SUM)\n\n    # Average value\n    average: total_amount(measurement_func: AVG)\n\n    # Minimum value\n    min_sale: total_amount(measurement_func: MIN)\n\n    # Maximum value\n    max_sale: total_amount(measurement_func: MAX)\n\n    # Any non-null value\n    sample: total_amount(measurement_func: ANY)\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"boolean-types",children:"Boolean Types"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'type events @table(name: "events") @cube {\n  event_id: BigInt! @pk\n  category: String!\n  is_successful: Boolean! @measurement\n  has_error: Boolean! @measurement\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Query:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  events {\n    category\n\n    # Logical OR of all values\n    any_successful: is_successful(measurement_func: OR)\n\n    # Logical AND of all values\n    all_successful: is_successful(measurement_func: AND)\n\n    # Any value\n    sample_success: is_successful(measurement_func: ANY)\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"date-and-timestamp-types",children:"Date and Timestamp Types"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'type orders @table(name: "orders") @cube {\n  id: BigInt! @pk\n  customer_id: Int!\n  first_order_date: Date! @measurement\n  last_order_date: Date! @measurement\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Query:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  orders {\n    customer_id\n\n    # Earliest date\n    first_purchase: first_order_date(measurement_func: MIN)\n\n    # Latest date\n    last_purchase: last_order_date(measurement_func: MAX)\n\n    # Any date value\n    sample_date: first_order_date(measurement_func: ANY)\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dimensions-and-automatic-grouping",children:"Dimensions and Automatic Grouping"}),"\n",(0,r.jsx)(n.p,{children:"All non-measurement fields automatically become dimensions for grouping:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales {\n    # These fields define the grouping\n    sale_date(bucket: quarter)\n    region\n\n    # Measurements are aggregated within each group\n    total_amount(measurement_func: SUM)\n    quantity(measurement_func: SUM)\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Data is grouped by ",(0,r.jsx)(n.code,{children:"sale_date"})," (by quarter) and ",(0,r.jsx)(n.code,{children:"region"})]}),"\n",(0,r.jsx)(n.li,{children:"Measurements are aggregated within each group"}),"\n",(0,r.jsxs)(n.li,{children:["SQL equivalent: ",(0,r.jsx)(n.code,{children:"GROUP BY DATE_TRUNC('quarter', sale_date), region"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"relations-in-cube-queries",children:"Relations in Cube Queries"}),"\n",(0,r.jsx)(n.p,{children:"When querying related data, foreign keys are automatically included in grouping:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales {\n    # customer_id automatically included in GROUP BY\n    customer {\n      id\n      name\n      country\n    }\n\n    # product_id automatically included in GROUP BY\n    product {\n      id\n      name\n      category {\n        name\n      }\n    }\n\n    # Aggregated measurements\n    total_revenue: total_amount(measurement_func: SUM)\n    avg_quantity: quantity(measurement_func: AVG)\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," Including related objects adds their foreign keys to the GROUP BY clause, affecting aggregation granularity."]}),"\n",(0,r.jsx)(n.h3,{id:"filtering-cube-data",children:"Filtering Cube Data"}),"\n",(0,r.jsx)(n.p,{children:"Apply filters before aggregation:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sales(\n    filter: {\n      sale_date: {\n        gte: "2024-01-01"\n        lt: "2024-04-01"\n      }\n      region: { eq: "North" }\n      total_amount: { gte: 100 }\n    }\n  ) {\n    sale_date(bucket: month)\n    region\n    total_amount(measurement_func: SUM)\n    quantity(measurement_func: SUM)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"sorting-cube-results",children:"Sorting Cube Results"}),"\n",(0,r.jsx)(n.p,{children:"Sort by dimensions or aggregated measurements:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sales(\n    order_by: [\n      { field: "sale_date", direction: DESC }\n      { field: "total_amount", direction: DESC }\n    ]\n  ) {\n    sale_date(bucket: month)\n    region\n    total_amount(measurement_func: SUM)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"pagination-with-cubes",children:"Pagination with Cubes"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"limit"})," and ",(0,r.jsx)(n.code,{children:"offset"})," for pagination:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query TopRegions($page: Int!) {\n  sales(\n    limit: 10\n    offset: $page  # Calculate: $page * 10 before query\n    order_by: [{ field: "total_amount", direction: DESC }]\n  ) {\n    region\n    total_amount(measurement_func: SUM)\n    quantity(measurement_func: SUM)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"mixed-measurements-and-dimensions",children:"Mixed Measurements and Dimensions"}),"\n",(0,r.jsxs)(n.p,{children:["Measurement fields without ",(0,r.jsx)(n.code,{children:"measurement_func"})," become dimensions:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales {\n    # Dimensions\n    sale_date(bucket: month)\n    region\n\n    # Measurement used as dimension (distinct values)\n    unit_price\n\n    # Aggregated measurements\n    total_revenue: total_amount(measurement_func: SUM)\n    total_quantity: quantity(measurement_func: SUM)\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Result:"})," Groups by ",(0,r.jsx)(n.code,{children:"sale_date"}),", ",(0,r.jsx)(n.code,{children:"region"}),", and ",(0,r.jsx)(n.code,{children:"unit_price"}),", then aggregates measurements within each group."]}),"\n",(0,r.jsx)(n.h3,{id:"cube-aggregations",children:"Cube Aggregations"}),"\n",(0,r.jsxs)(n.p,{children:["Use standard aggregation queries with cubes. Measurement fields in aggregations can use ",(0,r.jsx)(n.code,{children:"measurement_func"})," for double aggregation."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Important:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["With ",(0,r.jsx)(n.code,{children:"measurement_func"}),": Applies double aggregation (cube aggregation \u2192 aggregation query)"]}),"\n",(0,r.jsxs)(n.li,{children:["Without ",(0,r.jsx)(n.code,{children:"measurement_func"}),": Measurement field becomes a dimension and is added to GROUP BY"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"standard-aggregations",children:"Standard Aggregations"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sales_aggregation(\n    filter: {\n      sale_date: { gte: "2024-01-01" }\n    }\n  ) {\n    _rows_count\n    total_amount {\n      sum\n      avg\n      min\n      max\n    }\n    quantity {\n      sum\n      avg\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"double-aggregation-with-measurement_func",children:"Double Aggregation with measurement_func"}),"\n",(0,r.jsxs)(n.p,{children:["When using ",(0,r.jsx)(n.code,{children:"measurement_func"})," in cube aggregations, you perform double aggregation:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales_aggregation {\n    _rows_count\n\n    # Double aggregation:\n    # 1. Cube pre-aggregates with SUM per group\n    # 2. Aggregation query sums those sums\n    total_amount(measurement_func: SUM) {\n      sum    # Sum of sums\n      avg    # Average of sums\n      min    # Minimum sum\n      max    # Maximum sum\n    }\n\n    # Average of averages\n    unit_price(measurement_func: AVG) {\n      avg\n      min\n      max\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"measurement-as-dimension-without-measurement_func",children:"Measurement as Dimension (Without measurement_func)"}),"\n",(0,r.jsxs)(n.p,{children:["When you query a measurement field without ",(0,r.jsx)(n.code,{children:"measurement_func"}),", it becomes a dimension:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales_aggregation {\n    # unit_price used as dimension - added to GROUP BY\n    unit_price {\n      list    # List of distinct unit prices\n      count   # Count of distinct unit prices\n    }\n\n    # Other measurements aggregated within each unit_price group\n    total_amount {\n      sum\n    }\n    quantity {\n      sum\n    }\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Result:"})," Groups by distinct ",(0,r.jsx)(n.code,{children:"unit_price"})," values, then aggregates ",(0,r.jsx)(n.code,{children:"total_amount"})," and ",(0,r.jsx)(n.code,{children:"quantity"})," within each group."]}),"\n",(0,r.jsx)(n.h4,{id:"mixed-dimensions-and-double-aggregation",children:"Mixed: Dimensions and Double Aggregation"}),"\n",(0,r.jsx)(n.p,{children:"Combine both approaches:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sales_aggregation(\n    filter: {\n      sale_date: { gte: "2024-01-01" }\n    }\n  ) {\n    # Dimension field (regular aggregation)\n    sale_date {\n      min\n      max\n    }\n\n    # Measurement as dimension (no measurement_func)\n    unit_price {\n      list\n      count\n    }\n\n    # Measurement with double aggregation\n    total_amount(measurement_func: SUM) {\n      sum    # Sum of sums\n      avg    # Average of sums\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"bucket-aggregations-with-cubes",children:"Bucket Aggregations with Cubes"}),"\n",(0,r.jsx)(n.p,{children:"Group cubes by multiple dimensions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales_bucket_aggregation {\n    key {\n      quarter: sale_date(bucket: quarter)\n      region\n      product {\n        category {\n          name\n        }\n      }\n    }\n    aggregations {\n      _rows_count\n      total_amount {\n        sum\n        avg\n      }\n      quantity {\n        sum\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"hypertable-queries",children:"Hypertable Queries"}),"\n",(0,r.jsxs)(n.p,{children:["Tables marked with ",(0,r.jsx)(n.code,{children:"@hypertable"})," leverage TimescaleDB for optimized time-series queries. These tables must have a timestamp field marked with ",(0,r.jsx)(n.code,{children:"@timescale_key"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"schema-example-1",children:"Schema Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'type sensor_readings @table(name: "sensor_readings") @hypertable {\n  sensor_id: Int! @pk\n  timestamp: Timestamp! @pk @timescale_key\n  temperature: Float!\n  humidity: Float!\n  pressure: Float!\n  battery_level: Float!\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"basic-hypertable-queries",children:"Basic Hypertable Queries"}),"\n",(0,r.jsx)(n.p,{children:"Query with time-based filtering:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sensor_readings(\n    filter: {\n      timestamp: {\n        gte: "2024-01-01T00:00:00Z"\n        lt: "2024-01-02T00:00:00Z"\n      }\n      sensor_id: { eq: 123 }\n    }\n    order_by: [{ field: "timestamp", direction: ASC }]\n    limit: 100\n  ) {\n    sensor_id\n    timestamp\n    temperature\n    humidity\n    pressure\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"time-bucketing-in-hypertables",children:"Time Bucketing in Hypertables"}),"\n",(0,r.jsxs)(n.p,{children:["Use the ",(0,r.jsx)(n.code,{children:"bucket"})," argument on timestamp fields for time-series aggregation:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sensor_readings_bucket_aggregation {\n    key {\n      # TimescaleDB time_bucket function\n      hour: timestamp(bucket: hour)\n      sensor_id\n    }\n    aggregations {\n      _rows_count\n      temperature {\n        avg\n        min\n        max\n      }\n      humidity {\n        avg\n      }\n      pressure {\n        avg\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "sensor_readings_bucket_aggregation": [\n      {\n        "key": {\n          "hour": "2024-01-15T00:00:00Z",\n          "sensor_id": 123\n        },\n        "aggregations": {\n          "_rows_count": 3600,\n          "temperature": {\n            "avg": 22.5,\n            "min": 21.0,\n            "max": 24.0\n          },\n          "humidity": {\n            "avg": 45.2\n          },\n          "pressure": {\n            "avg": 1013.25\n          }\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"custom-time-intervals",children:"Custom Time Intervals"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"bucket_interval"})," for custom time windows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sensor_readings_bucket_aggregation {\n    key {\n      # 15-minute intervals\n      time_window: timestamp(bucket_interval: "15 minutes")\n      sensor_id\n    }\n    aggregations {\n      temperature {\n        avg\n        min\n        max\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"time-range-queries",children:"Time-Range Queries"}),"\n",(0,r.jsx)(n.p,{children:"Efficiently query time ranges:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query RecentReadings($sensorId: Int!, $hours: Int!) {\n  sensor_readings(\n    filter: {\n      sensor_id: { eq: $sensorId }\n      timestamp: {\n        gte: "2024-01-15T00:00:00Z"  # Calculate: NOW() - $hours\n      }\n    }\n    order_by: [{ field: "timestamp", direction: DESC }]\n    limit: 1000\n  ) {\n    timestamp\n    temperature\n    humidity\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"continuous-aggregates",children:"Continuous Aggregates"}),"\n",(0,r.jsx)(n.p,{children:"Query materialized continuous aggregates:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'# Define continuous aggregate view\ntype hourly_sensor_stats @view(\n  name: "hourly_sensor_stats"\n) @hypertable {\n  sensor_id: Int! @pk\n  hour: Timestamp! @pk @timescale_key\n  avg_temperature: Float!\n  avg_humidity: Float!\n  min_temperature: Float!\n  max_temperature: Float!\n  reading_count: Int!\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Query the continuous aggregate:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  hourly_sensor_stats(\n    filter: {\n      hour: {\n        gte: "2024-01-01T00:00:00Z"\n        lt: "2024-02-01T00:00:00Z"\n      }\n    }\n    order_by: [{ field: "hour", direction: ASC }]\n  ) {\n    hour\n    sensor_id\n    avg_temperature\n    avg_humidity\n    min_temperature\n    max_temperature\n    reading_count\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"downsampling-time-series-data",children:"Downsampling Time-Series Data"}),"\n",(0,r.jsx)(n.p,{children:"Aggregate high-frequency data into lower-frequency summaries:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sensor_readings_bucket_aggregation(\n    filter: {\n      timestamp: {\n        gte: "2024-01-01T00:00:00Z"\n        lt: "2024-01-08T00:00:00Z"\n      }\n    }\n  ) {\n    key {\n      # Downsample to daily\n      day: timestamp(bucket: day)\n      sensor_id\n    }\n    aggregations {\n      _rows_count\n      temperature {\n        avg\n        min\n        max\n        list\n      }\n      battery_level {\n        min\n        last\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"gap-filling",children:"Gap Filling"}),"\n",(0,r.jsx)(n.p,{children:"Identify and handle gaps in time-series data:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sensor_readings(\n    filter: {\n      sensor_id: { eq: 123 }\n      timestamp: {\n        gte: "2024-01-15T00:00:00Z"\n        lt: "2024-01-16T00:00:00Z"\n      }\n    }\n    order_by: [{ field: "timestamp", direction: ASC }]\n  ) {\n    timestamp\n    temperature\n    # Calculate time since previous reading in query\n    _timestamp_part(extract: epoch)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"latest-values",children:"Latest Values"}),"\n",(0,r.jsx)(n.p,{children:"Get the most recent reading per sensor:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sensor_readings_bucket_aggregation {\n    key {\n      sensor_id\n    }\n    aggregations {\n      timestamp {\n        max\n      }\n      temperature {\n        last\n      }\n      humidity {\n        last\n      }\n      pressure {\n        last\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"filtering-by-sensor-conditions",children:"Filtering by Sensor Conditions"}),"\n",(0,r.jsx)(n.p,{children:"Filter time-series data by value thresholds:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query HighTemperatureEvents {\n  sensor_readings(\n    filter: {\n      timestamp: {\n        gte: "2024-01-01T00:00:00Z"\n      }\n      temperature: { gt: 30.0 }\n      _or: [\n        { humidity: { gt: 80.0 } }\n        { pressure: { lt: 1000.0 } }\n      ]\n    }\n    order_by: [{ field: "timestamp", direction: DESC }]\n    limit: 100\n  ) {\n    sensor_id\n    timestamp\n    temperature\n    humidity\n    pressure\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"combined-cube--hypertable",children:"Combined Cube + Hypertable"}),"\n",(0,r.jsx)(n.p,{children:"Use both directives for time-series analytical data:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'type sales_metrics @table(name: "sales_metrics")\n  @cube\n  @hypertable {\n\n  id: BigInt! @pk\n\n  # Time dimension (hypertable key)\n  timestamp: Timestamp! @timescale_key\n\n  # Other dimensions\n  product_id: Int!\n  region: String!\n  channel: String!\n\n  # Measurements (cube)\n  revenue: Float! @measurement\n  units_sold: Int! @measurement\n  customers: Int! @measurement\n  transactions: Int! @measurement\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"querying-combined-types",children:"Querying Combined Types"}),"\n",(0,r.jsx)(n.p,{children:"Query with both time bucketing and cube aggregation:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales_metrics {\n    # Time bucketing (hypertable)\n    hour: timestamp(bucket: hour)\n\n    # Dimensions\n    region\n    channel\n\n    # Aggregated measurements (cube)\n    total_revenue: revenue(measurement_func: SUM)\n    total_units: units_sold(measurement_func: SUM)\n    unique_customers: customers(measurement_func: SUM)\n    transaction_count: transactions(measurement_func: SUM)\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"time-series-analysis",children:"Time-Series Analysis"}),"\n",(0,r.jsx)(n.p,{children:"Perform detailed time-series analysis:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sales_metrics_bucket_aggregation(\n    filter: {\n      timestamp: {\n        gte: "2024-01-01T00:00:00Z"\n        lt: "2024-02-01T00:00:00Z"\n      }\n    }\n  ) {\n    key {\n      # Daily time buckets\n      day: timestamp(bucket: day)\n      region\n      channel\n    }\n    aggregations {\n      _rows_count\n      revenue {\n        sum\n        avg\n        min\n        max\n      }\n      units_sold {\n        sum\n      }\n      customers {\n        sum\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"real-time-dashboard-query",children:"Real-Time Dashboard Query"}),"\n",(0,r.jsx)(n.p,{children:"Query for real-time monitoring:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query RealtimeDashboard {\n  # Last hour performance\n  recent: sales_metrics(\n    filter: {\n      timestamp: {\n        gte: "2024-01-15T11:00:00Z"  # NOW() - 1 hour\n      }\n    }\n  ) {\n    timestamp(bucket_interval: "5 minutes")\n    region\n    revenue(measurement_func: SUM)\n    units_sold(measurement_func: SUM)\n  }\n\n  # Current totals\n  totals: sales_metrics_aggregation(\n    filter: {\n      timestamp: {\n        gte: "2024-01-15T00:00:00Z"  # Start of day\n      }\n    }\n  ) {\n    _rows_count\n    revenue {\n      sum\n      avg\n    }\n    customers {\n      sum\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,r.jsx)(n.h3,{id:"cube-performance-tips",children:"Cube Performance Tips"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Select only needed dimensions:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"# Good - Minimal dimensions\nquery {\n  sales {\n    region\n    total_amount(measurement_func: SUM)\n  }\n}\n\n# Avoid - Too many dimensions\nquery {\n  sales {\n    sale_date\n    customer_id\n    product_id\n    store_id\n    region\n    total_amount(measurement_func: SUM)\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Pre-aggregate with bucket aggregations:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"# Efficient - Use bucket aggregation\nquery {\n  sales_bucket_aggregation {\n    key {\n      month: sale_date(bucket: month)\n      region\n    }\n    aggregations {\n      total_amount { sum }\n    }\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Filter early:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sales(\n    filter: {\n      sale_date: { gte: "2024-01-01" }\n      region: { in: ["North", "South"] }\n    }\n  ) {\n    region\n    total_amount(measurement_func: SUM)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"hypertable-performance-tips",children:"Hypertable Performance Tips"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Always filter by time range:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'# Good - Time range filter\nquery {\n  sensor_readings(\n    filter: {\n      timestamp: {\n        gte: "2024-01-15T00:00:00Z"\n        lt: "2024-01-16T00:00:00Z"\n      }\n    }\n  ) {\n    timestamp\n    temperature\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Use continuous aggregates for frequent queries:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"# Better - Query continuous aggregate\nquery {\n  hourly_sensor_stats {\n    hour\n    avg_temperature\n  }\n}\n\n# Instead of - Aggregating raw data repeatedly\nquery {\n  sensor_readings_bucket_aggregation {\n    key {\n      hour: timestamp(bucket: hour)\n    }\n    aggregations {\n      temperature { avg }\n    }\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Limit result sets:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sensor_readings(\n    filter: {\n      timestamp: { gte: "2024-01-15T00:00:00Z" }\n    }\n    order_by: [{ field: "timestamp", direction: DESC }]\n    limit: 1000\n  ) {\n    timestamp\n    temperature\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"sales-analytics",children:"Sales Analytics"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query SalesAnalytics {\n  sales_bucket_aggregation(\n    filter: {\n      sale_date: {\n        gte: "2024-01-01"\n        lt: "2024-04-01"\n      }\n    }\n  ) {\n    key {\n      quarter: sale_date(bucket: quarter)\n      product {\n        category {\n          name\n        }\n      }\n      region\n    }\n    aggregations {\n      _rows_count\n      total_amount {\n        sum\n        avg\n      }\n      quantity {\n        sum\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"iot-monitoring",children:"IoT Monitoring"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query SensorMonitoring {\n  sensor_readings_bucket_aggregation(\n    filter: {\n      timestamp: {\n        gte: "2024-01-15T00:00:00Z"\n      }\n      sensor_id: { in: [123, 456, 789] }\n    }\n  ) {\n    key {\n      hour: timestamp(bucket: hour)\n      sensor_id\n    }\n    aggregations {\n      temperature {\n        avg\n        min\n        max\n      }\n      battery_level {\n        min\n        last\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"financial-metrics",children:"Financial Metrics"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query FinancialMetrics {\n  transactions(\n    filter: {\n      timestamp: { gte: "2024-01-01T00:00:00Z" }\n    }\n  ) {\n    day: timestamp(bucket: day)\n    account_type\n    total_volume: amount(measurement_func: SUM)\n    transaction_count: _rows_count\n    avg_transaction: amount(measurement_func: AVG)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(n.h3,{id:"planning-errors",children:"Planning Errors"}),"\n",(0,r.jsx)(n.p,{children:"Errors caught during query planning:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales {\n    region\n    # Invalid measurement function\n    total: total_amount(measurement_func: INVALID)\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": [\n    {\n      "message": "Invalid measurement_func \'INVALID\'. Must be one of: SUM, AVG, MIN, MAX, ANY",\n      "path": ["sales", "total_amount"],\n      "extensions": {\n        "code": "INVALID_ARGUMENT_VALUE"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"execution-errors",children:"Execution Errors"}),"\n",(0,r.jsx)(n.p,{children:"Runtime errors during SQL execution:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sensor_readings(\n    filter: {\n      timestamp: {\n        gte: "invalid-timestamp"\n      }\n    }\n  ) {\n    timestamp\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": [\n    {\n      "message": "Invalid timestamp format"\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Learn about ",(0,r.jsx)(n.a,{href:"/docs/graphql/queries/generated-fields",children:"Generated Fields"})," for timestamp transformations and measurements"]}),"\n",(0,r.jsxs)(n.li,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/graphql/queries/aggregations",children:"Aggregations"})," for standard aggregation patterns"]}),"\n",(0,r.jsxs)(n.li,{children:["Check ",(0,r.jsx)(n.a,{href:"/docs/engine-configuration/schema-definition/data-objects/special-types",children:"Schema Definition - Special Types"})," for setup details"]}),"\n",(0,r.jsxs)(n.li,{children:["Review ",(0,r.jsx)(n.a,{href:"https://docs.timescale.com/",children:"TimescaleDB Documentation"})," for hypertable features"]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);