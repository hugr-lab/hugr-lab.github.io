"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[4786],{2586:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"engine-configuration/schema-definition/data-objects/mutations","title":"Mutations","description":"Hugr automatically generates mutation operations for tables (not views). These mutations handle data modifications with support for relationships, transactions, and returning affected data.","source":"@site/docs/4-engine-configuration/3-schema-definition/3-data-objects/5-mutations.md","sourceDirName":"4-engine-configuration/3-schema-definition/3-data-objects","slug":"/engine-configuration/schema-definition/data-objects/mutations","permalink":"/docs/engine-configuration/schema-definition/data-objects/mutations","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/4-engine-configuration/3-schema-definition/3-data-objects/5-mutations.md","tags":[],"version":"current","lastUpdatedBy":"vgsml","lastUpdatedAt":1759235264000,"sidebarPosition":5,"frontMatter":{"title":"Mutations","sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Queries","permalink":"/docs/engine-configuration/schema-definition/data-objects/queries"},"next":{"title":"Aggregations","permalink":"/docs/engine-configuration/schema-definition/data-objects/aggregations"}}');var s=t(4848),i=t(8453);const r={title:"Mutations",sidebar_position:5},d="Mutations",l={},o=[{value:"Insert Mutations",id:"insert-mutations",level:2},{value:"Insert with Relations",id:"insert-with-relations",level:3},{value:"Return Values",id:"return-values",level:3},{value:"Update Mutations",id:"update-mutations",level:2},{value:"Bulk Updates",id:"bulk-updates",level:3},{value:"Conditional Updates",id:"conditional-updates",level:3},{value:"Delete Mutations",id:"delete-mutations",level:2},{value:"Bulk Deletes",id:"bulk-deletes",level:3},{value:"Soft Delete",id:"soft-delete",level:3},{value:"Input Types",id:"input-types",level:2},{value:"Insert Input Type",id:"insert-input-type",level:3},{value:"Update Input Type",id:"update-input-type",level:3},{value:"Transaction Behavior",id:"transaction-behavior",level:2},{value:"Auto-Generated Values",id:"auto-generated-values",level:2},{value:"Sequences",id:"sequences",level:3},{value:"Default Values",id:"default-values",level:3},{value:"Semantic Search and Embeddings",id:"semantic-search-and-embeddings",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"mutations",children:"Mutations"})}),"\n",(0,s.jsx)(n.p,{children:"Hugr automatically generates mutation operations for tables (not views). These mutations handle data modifications with support for relationships, transactions, and returning affected data."}),"\n",(0,s.jsx)(n.h2,{id:"insert-mutations",children:"Insert Mutations"}),"\n",(0,s.jsx)(n.p,{children:"Insert single or multiple records:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_customers(data: {\n    name: "John Doe"\n    email: "john@example.com"\n    status: "active"\n  }) {\n    id\n    name\n    email\n    created_at\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"insert-with-relations",children:"Insert with Relations"}),"\n",(0,s.jsx)(n.p,{children:"Insert related records in a single transaction:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_customers(data: {\n    name: "Jane Smith"\n    email: "jane@example.com"\n    addresses: [\n      {\n        street: "123 Main St"\n        city: "New York"\n        type: "billing"\n      }\n      {\n        street: "456 Oak Ave"\n        city: "Boston"\n        type: "shipping"\n      }\n    ]\n    orders: [\n      {\n        order_date: "2024-01-15"\n        status: "pending"\n        order_details: [\n          {\n            product_id: 1\n            quantity: 2\n            unit_price: 50.00\n          }\n        ]\n      }\n    ]\n  }) {\n    id\n    name\n    addresses {\n      id\n      type\n      city\n    }\n    orders {\n      id\n      status\n      order_details {\n        product_id\n        quantity\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"return-values",children:"Return Values"}),"\n",(0,s.jsxs)(n.p,{children:["For tables with primary keys, the mutation returns the inserted record(s). Without primary keys, it returns an ",(0,s.jsx)(n.code,{children:"OperationResult"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"type OperationResult {\n  affected_rows: Int!\n  success: Boolean!\n  message: String\n  last_id: BigInt\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"update-mutations",children:"Update Mutations"}),"\n",(0,s.jsx)(n.p,{children:"Update records matching filter conditions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  update_customers(\n    filter: { id: { eq: 123 } }\n    data: {\n      email: "newemail@example.com"\n      updated_at: "2024-01-15T10:00:00Z"\n    }\n  ) {\n    affected_rows\n    success\n    message\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"bulk-updates",children:"Bulk Updates"}),"\n",(0,s.jsx)(n.p,{children:"Update multiple records:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  update_products(\n    filter: { \n      category_id: { eq: 5 }\n      status: { eq: "active" }\n    }\n    data: {\n      discount_percentage: 15\n      sale_ends_at: "2024-02-01T00:00:00Z"\n    }\n  ) {\n    affected_rows\n    success\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"conditional-updates",children:"Conditional Updates"}),"\n",(0,s.jsx)(n.p,{children:"Use complex filters for targeted updates:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  update_orders(\n    filter: {\n      _and: [\n        { status: { eq: "pending" } }\n        { created_at: { lt: "2024-01-01" } }\n        { customer: { status: { eq: "active" } } }\n      ]\n    }\n    data: {\n      status: "cancelled"\n      cancelled_reason: "Order expired"\n    }\n  ) {\n    affected_rows\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"delete-mutations",children:"Delete Mutations"}),"\n",(0,s.jsx)(n.p,{children:"Delete records matching filter conditions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"mutation {\n  delete_customers(\n    filter: { id: { eq: 123 } }\n  ) {\n    affected_rows\n    success\n    message\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"bulk-deletes",children:"Bulk Deletes"}),"\n",(0,s.jsx)(n.p,{children:"Delete multiple records:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  delete_old_logs(\n    filter: {\n      created_at: { lt: "2023-01-01" }\n    }\n  ) {\n    affected_rows\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"soft-delete",children:"Soft Delete"}),"\n",(0,s.jsx)(n.p,{children:"For tables with soft delete enabled:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"mutation {\n  delete_customers(\n    filter: { id: { eq: 123 } }\n  ) {\n    affected_rows  # Record marked as deleted, not physically removed\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"To query including soft-deleted records:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers @with_deleted {\n    id\n    name\n    deleted_at\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"input-types",children:"Input Types"}),"\n",(0,s.jsx)(n.h3,{id:"insert-input-type",children:"Insert Input Type"}),"\n",(0,s.jsx)(n.p,{children:"Generated for each table, includes all fields and relations:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"input customers_mut_input_data {\n  # Direct fields\n  name: String!\n  email: String!\n  status: String\n  \n  # Related records (one-to-one/many-to-one)\n  profile: customer_profiles_mut_input_data\n  \n  # Related records (one-to-many)\n  addresses: [customer_addresses_mut_input_data]\n  orders: [orders_mut_input_data]\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"update-input-type",children:"Update Input Type"}),"\n",(0,s.jsx)(n.p,{children:"Contains only direct fields (no relations):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"input customers_mut_data {\n  name: String\n  email: String\n  status: String\n  updated_at: Timestamp\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"transaction-behavior",children:"Transaction Behavior"}),"\n",(0,s.jsx)(n.p,{children:"All mutations within a single GraphQL request execute in a transaction:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation ComplexTransaction {\n  # All operations succeed or fail together\n  update_inventory: update_products(\n    filter: { id: { eq: 100 } }\n    data: { stock: 45 }\n  ) {\n    affected_rows\n  }\n  \n  create_order: insert_orders(data: {\n    customer_id: 50\n    product_id: 100\n    quantity: 5\n  }) {\n    id\n  }\n  \n  update_customer: update_customers(\n    filter: { id: { eq: 50 } }\n    data: { last_order_date: "2024-01-15" }\n  ) {\n    affected_rows\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"The mutations can be executed only in one data source context."}),"\n",(0,s.jsx)(n.h2,{id:"auto-generated-values",children:"Auto-Generated Values"}),"\n",(0,s.jsx)(n.h3,{id:"sequences",children:"Sequences"}),"\n",(0,s.jsx)(n.p,{children:"For fields with sequences:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'type orders @table(name: "orders") {\n  id: BigInt! @pk @default(sequence: "orders_id_seq")\n  order_number: Int! @default(sequence: "order_number_seq")\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"The ID fields are auto-populated during insert."}),"\n",(0,s.jsx)(n.h3,{id:"default-values",children:"Default Values"}),"\n",(0,s.jsx)(n.p,{children:"Fields with default values are optional in mutations:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'type customers @table(name: "customers") {\n  status: String! @default(value: "pending")\n  created_at: Timestamp! @default(insert_exp: "NOW()", update_exp: "objects.created_at")\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"semantic-search-and-embeddings",children:"Semantic Search and Embeddings"}),"\n",(0,s.jsxs)(n.p,{children:["For data objects with embeddings, use the ",(0,s.jsx)(n.code,{children:"summary"})," parameter to generate vector representations during insert or update mutations:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  insert_documents(\n    data: {\n      title: "GraphQL Overview"\n      content: "GraphQL is a query language for APIs."\n    }\n    summary: "GraphQL is a query language for APIs."\n  ) {\n    id\n  }\n  update_documents(\n    filter: { id: { eq: 1 } }\n    data: { content: "Updated content" }\n    summary: "Updated summary"\n  ) {\n    success\n    message\n    affected_rows\n  }\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>d});var a=t(6540);const s={},i=a.createContext(s);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);