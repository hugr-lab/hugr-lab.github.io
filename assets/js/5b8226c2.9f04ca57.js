"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[3787],{5069:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"graphql/queries/function-fields","title":"Function Fields","description":"Hugr allows you to embed function calls as fields within data objects using the @functioncall and @tablefunctioncalljoin directives. This enables dynamic computations, external API calls, and custom business logic to be executed row-by-row as part of your queries.","source":"@site/docs/5-graphql/1-queries/6-function-fields.md","sourceDirName":"5-graphql/1-queries","slug":"/graphql/queries/function-fields","permalink":"/docs/graphql/queries/function-fields","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/5-graphql/1-queries/6-function-fields.md","tags":[],"version":"current","lastUpdatedBy":"Claude","lastUpdatedAt":1762461702000,"sidebarPosition":6,"frontMatter":{"title":"Function Fields","sidebar_position":6},"sidebar":"docsSidebar","previous":{"title":"Relations & Subqueries","permalink":"/docs/graphql/queries/relations"},"next":{"title":"Aggregations","permalink":"/docs/graphql/queries/aggregations"}}');var r=i(4848),s=i(8453);const a={title:"Function Fields",sidebar_position:6},l="Function Fields",c={},o=[{value:"Basic Function Fields",id:"basic-function-fields",level:2},{value:"Scalar Function Fields",id:"scalar-function-fields",level:3},{value:"Object-Returning Function Fields",id:"object-returning-function-fields",level:3},{value:"Argument Mapping",id:"argument-mapping",level:2},{value:"Full Argument Mapping",id:"full-argument-mapping",level:3},{value:"Partial Argument Mapping",id:"partial-argument-mapping",level:3},{value:"No Argument Mapping",id:"no-argument-mapping",level:3},{value:"Table Function Fields",id:"table-function-fields",level:2},{value:"Basic Table Functions",id:"basic-table-functions",level:3},{value:"Filtering Table Function Results",id:"filtering-table-function-results",level:3},{value:"Sorting Table Function Results",id:"sorting-table-function-results",level:3},{value:"Table Function with Join",id:"table-function-with-join",level:2},{value:"Limitations",id:"limitations",level:3},{value:"Alternative: Use Parameterized Views",id:"alternative-use-parameterized-views",level:3},{value:"HTTP API Function Fields",id:"http-api-function-fields",level:2},{value:"Cross-Source Function Fields",id:"cross-source-function-fields",level:2},{value:"Aggregating Function Results",id:"aggregating-function-results",level:2},{value:"Aggregating Table Functions",id:"aggregating-table-functions",level:3},{value:"Bucket Aggregation on Functions",id:"bucket-aggregation-on-functions",level:3},{value:"Conditional Function Execution",id:"conditional-function-execution",level:2},{value:"Skip NULL Arguments",id:"skip-null-arguments",level:3},{value:"Chained Function Calls",id:"chained-function-calls",level:2},{value:"Field Aliases with Functions",id:"field-aliases-with-functions",level:2},{value:"Fragments with Function Fields",id:"fragments-with-function-fields",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"1. Batch Function Execution",id:"1-batch-function-execution",level:3},{value:"2. Limit Table Function Results",id:"2-limit-table-function-results",level:3},{value:"3. Cache Expensive Functions",id:"3-cache-expensive-functions",level:3},{value:"4. Filter Before Function Calls",id:"4-filter-before-function-calls",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Enriching Data with External APIs",id:"enriching-data-with-external-apis",level:3},{value:"Dynamic Calculations",id:"dynamic-calculations",level:3},{value:"Personalized Content",id:"personalized-content",level:3},{value:"Real-Time Data",id:"real-time-data",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Planning Errors (SQL Generation)",id:"planning-errors-sql-generation",level:3},{value:"SQL Execution Errors",id:"sql-execution-errors",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"function-fields",children:"Function Fields"})}),"\n",(0,r.jsxs)(e.p,{children:["Hugr allows you to embed function calls as fields within data objects using the ",(0,r.jsx)(e.code,{children:"@function_call"})," and ",(0,r.jsx)(e.code,{children:"@table_function_call_join"})," directives. This enables dynamic computations, external API calls, and custom business logic to be executed row-by-row as part of your queries."]}),"\n",(0,r.jsx)(e.h2,{id:"basic-function-fields",children:"Basic Function Fields"}),"\n",(0,r.jsx)(e.h3,{id:"scalar-function-fields",children:"Scalar Function Fields"}),"\n",(0,r.jsx)(e.p,{children:"Add a function that returns a single value:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'# Schema definition\nextend type Function {\n  calculate_shipping_cost(\n    weight: Float!\n    distance: Float!\n  ): Float @function(name: "calc_shipping")\n}\n\nextend type orders {\n  shipping_cost: Float @function_call(\n    references_name: "calculate_shipping_cost"\n    args: {\n      weight: "total_weight"\n      distance: "shipping_distance"\n    }\n  )\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Query the function field:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders {\n    id\n    total_weight\n    shipping_distance\n    shipping_cost  # Automatically calculated per order\n  }\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"Result:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "data": {\n    "orders": [\n      {\n        "id": 1,\n        "total_weight": 5.5,\n        "shipping_distance": 150.0,\n        "shipping_cost": 12.50\n      }\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"object-returning-function-fields",children:"Object-Returning Function Fields"}),"\n",(0,r.jsx)(e.p,{children:"Functions that return structured types:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'# Schema definition\nextend type Function {\n  get_customer_tier(\n    total_spent: Float!\n    order_count: Int!\n  ): CustomerTier @function(name: "calculate_tier")\n}\n\ntype CustomerTier {\n  level: String!\n  discount_rate: Float!\n  benefits: [String!]\n}\n\nextend type customers {\n  tier: CustomerTier @function_call(\n    references_name: "get_customer_tier"\n    args: {\n      total_spent: "lifetime_value"\n      order_count: "order_count"\n    }\n  )\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Query:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    lifetime_value\n    order_count\n    tier {\n      level\n      discount_rate\n      benefits\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"argument-mapping",children:"Argument Mapping"}),"\n",(0,r.jsx)(e.h3,{id:"full-argument-mapping",children:"Full Argument Mapping"}),"\n",(0,r.jsx)(e.p,{children:"Map all function arguments from object fields:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'extend type Function {\n  validate_address(\n    street: String!\n    city: String!\n    postal_code: String!\n    country: String!\n  ): Boolean @function(name: "address_validator")\n}\n\nextend type customers {\n  is_address_valid: Boolean @function_call(\n    references_name: "validate_address"\n    args: {\n      street: "address_street"\n      city: "address_city"\n      postal_code: "postal_code"\n      country: "country"\n    }\n  )\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"partial-argument-mapping",children:"Partial Argument Mapping"}),"\n",(0,r.jsx)(e.p,{children:"Map some arguments from fields, others provided at query time:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'extend type Function {\n  convert_price(\n    amount: Float!\n    from_currency: String!\n    to_currency: String!\n  ): Float @function(name: "currency_converter")\n}\n\nextend type products {\n  price_converted: Float @function_call(\n    references_name: "convert_price"\n    args: {\n      amount: "price"\n      from_currency: "currency"\n      # to_currency will be a query argument\n    }\n  )\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Query with additional arguments:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'query {\n  products {\n    id\n    name\n    price\n    currency\n    # Specify to_currency at query time\n    price_converted(to_currency: "EUR")\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"no-argument-mapping",children:"No Argument Mapping"}),"\n",(0,r.jsx)(e.p,{children:"All arguments provided at query time:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'extend type Function {\n  get_weather(lat: Float!, lon: Float!): WeatherData\n    @function(name: "fetch_weather")\n}\n\nextend type locations {\n  weather: WeatherData @function_call(\n    references_name: "get_weather"\n    # No args mapping - all provided at query time\n  )\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Query:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  locations {\n    id\n    name\n    # Provide all arguments\n    weather(lat: 40.7, lon: -74.0) {\n      temperature\n      conditions\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"table-function-fields",children:"Table Function Fields"}),"\n",(0,r.jsx)(e.p,{children:"Functions that return multiple rows:"}),"\n",(0,r.jsx)(e.h3,{id:"basic-table-functions",children:"Basic Table Functions"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'extend type Function {\n  get_recommendations(\n    customer_id: Int!\n    limit: Int = 10\n  ): [Product] @function(\n    name: "product_recommendations"\n    is_table: true\n  )\n}\n\nextend type customers {\n  recommendations: [Product] @function_call(\n    references_name: "get_recommendations"\n    args: {\n      customer_id: "id"\n    }\n  )\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Query:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Get recommendations for each customer\n    recommendations(limit: 5) {\n      id\n      name\n      price\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"filtering-table-function-results",children:"Filtering Table Function Results"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    # Filter recommendations\n    affordable_recommendations: recommendations(\n      limit: 10\n      filter: { price: { lte: 100 } }\n    ) {\n      id\n      name\n      price\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"sorting-table-function-results",children:"Sorting Table Function Results"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'query {\n  customers {\n    id\n    # Sort by relevance score\n    recommendations(\n      limit: 10\n      order_by: [{ field: "score", direction: DESC }]\n    ) {\n      id\n      name\n      score\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"table-function-with-join",children:"Table Function with Join"}),"\n",(0,r.jsxs)(e.p,{children:["Use ",(0,r.jsx)(e.code,{children:"@table_function_call_join"})," to combine function results with join conditions. The ",(0,r.jsx)(e.code,{children:"args"})," parameter maps function arguments to object fields\u2014unmapped arguments become field parameters in queries."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'# Function definition\nextend type Function {\n  get_sensor_readings(\n    sensor_id: Int!\n    from_time: Timestamp!\n    to_time: Timestamp!\n  ): [SensorReading] @function(\n    name: "fetch_readings"\n    is_table: true\n  )\n}\n\n# Field definition\nextend type sensors {\n  readings: [SensorReading] @table_function_call_join(\n    references_name: "get_sensor_readings"\n    args: {\n      sensor_id: "id"  # Maps sensor_id to sensors.id field\n      # from_time and to_time not mapped - become query parameters\n    }\n    source_fields: ["id"]\n    references_fields: ["sensor_id"]\n  )\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Result:"})," The ",(0,r.jsx)(e.code,{children:"readings"})," field requires ",(0,r.jsx)(e.code,{children:"from_time"})," and ",(0,r.jsx)(e.code,{children:"to_time"})," parameters:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'query {\n  sensors {\n    id\n    name\n    # from_time and to_time are required query parameters\n    readings(\n      from_time: "2024-01-01T00:00:00Z"\n      to_time: "2024-01-31T23:59:59Z"\n    ) {\n      timestamp\n      value\n      unit\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Important:"})," Fields created with ",(0,r.jsx)(e.code,{children:"@table_function_call_join"})," do not support:"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"filter"}),", ",(0,r.jsx)(e.code,{children:"order_by"}),", ",(0,r.jsx)(e.code,{children:"limit"}),", ",(0,r.jsx)(e.code,{children:"offset"}),", ",(0,r.jsx)(e.code,{children:"distinct_on"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"inner"})," parameter"]}),"\n",(0,r.jsxs)(e.li,{children:["Aggregations (",(0,r.jsx)(e.code,{children:"_aggregation"}),", ",(0,r.jsx)(e.code,{children:"_bucket_aggregation"}),")"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"The directive provides basic data retrieval with argument mapping and join conditions only."}),"\n",(0,r.jsx)(e.h3,{id:"alternative-use-parameterized-views",children:"Alternative: Use Parameterized Views"}),"\n",(0,r.jsx)(e.p,{children:"For advanced filtering, sorting, and aggregation, define a parameterized view instead:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'# Define parameterized view calling the function\ntype sensor_readings_view @view(\n  name: "sensor_readings_by_period"\n  sql: "SELECT * FROM get_sensor_readings([sensor_id], [from_time], [to_time])"\n) @args(name: "sensor_readings_args", required: true) {\n  sensor_id: Int! @pk\n  timestamp: Timestamp! @pk\n  value: Float!\n  unit: String!\n}\n\ninput sensor_readings_args {\n  sensor_id: Int!\n  from_time: Timestamp!\n  to_time: Timestamp!\n}\n\n# Create relation to parameterized view\nextend type sensors {\n  readings: [sensor_readings_view] @join(\n    references_name: "sensor_readings_view"\n    source_fields: ["id"]\n    references_fields: ["sensor_id"]\n  )\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Now you get full query capabilities:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'query {\n  sensors {\n    id\n    name\n    # Filter anomalous readings\n    anomalies: readings(\n      args: {\n        sensor_id: 123\n        from_time: "2024-01-01T00:00:00Z"\n        to_time: "2024-01-31T23:59:59Z"\n      }\n      filter: {\n        _or: [\n          { value: { gt: 100 } }\n          { value: { lt: 0 } }\n        ]\n      }\n      order_by: [{ field: "timestamp", direction: DESC }]\n      limit: 50\n    ) {\n      timestamp\n      value\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"http-api-function-fields",children:"HTTP API Function Fields"}),"\n",(0,r.jsx)(e.p,{children:"Call external APIs as function fields:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'# Schema definition\nextend type Function {\n  get_geocode(\n    address: String!\n  ): GeoLocation @function(\n    name: "geocode_address"\n    sql: """\n      http_data_source_request_scalar(\n        \'[$catalog]\',\n        \'/geocode\',\n        \'GET\',\n        \'{\\"Authorization\\": \\"Bearer token\\"}\'::JSON,\n        {address: [address]}::JSON,\n        \'{}\'::JSON,\n        \'\'\n      )\n    """\n    json_cast: true\n  )\n}\n\ntype GeoLocation {\n  latitude: Float\n  longitude: Float\n  accuracy: String\n}\n\nextend type addresses {\n  geocoded: GeoLocation @function_call(\n    references_name: "get_geocode"\n    args: {\n      address: "full_address"\n    }\n  )\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Query:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  addresses {\n    id\n    full_address\n    geocoded {\n      latitude\n      longitude\n      accuracy\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"cross-source-function-fields",children:"Cross-Source Function Fields"}),"\n",(0,r.jsx)(e.p,{children:"Call functions from different data sources:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'# In extension data source\nextend type postgres_orders {\n  # Call function from MySQL data source\n  loyalty_points: Int @function_call(\n    references_name: "calculate_points"\n    module: "mysql.loyalty"\n    args: {\n      order_total: "total"\n      customer_id: "customer_id"\n    }\n  )\n\n  # Call HTTP API function\n  tracking_info: TrackingInfo @function_call(\n    references_name: "get_tracking"\n    module: "shipping_api"\n    args: {\n      tracking_number: "tracking_number"\n    }\n  )\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"aggregating-function-results",children:"Aggregating Function Results"}),"\n",(0,r.jsx)(e.h3,{id:"aggregating-table-functions",children:"Aggregating Table Functions"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    # Aggregate recommendations\n    recommendations_aggregation(limit: 100) {\n      _rows_count\n      price {\n        avg\n        min\n        max\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"bucket-aggregation-on-functions",children:"Bucket Aggregation on Functions"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    # Group recommendations by category\n    recommendations_bucket_aggregation(limit: 100) {\n      key {\n        category {\n          name\n        }\n      }\n      aggregations {\n        _rows_count\n        price {\n          avg\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"conditional-function-execution",children:"Conditional Function Execution"}),"\n",(0,r.jsx)(e.h3,{id:"skip-null-arguments",children:"Skip NULL Arguments"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'extend type Function {\n  geocode(address: String): Geometry\n    @function(\n      name: "geocode_address"\n      skip_null_arg: true  # Don\'t pass NULL to SQL function\n    )\n}\n\nextend type customers {\n  location: Geometry @function_call(\n    references_name: "geocode"\n    args: {\n      address: "full_address"\n    }\n  )\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:["When ",(0,r.jsx)(e.code,{children:"skip_null_arg: true"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["The function will be called even if ",(0,r.jsx)(e.code,{children:"full_address"})," is NULL"]}),"\n",(0,r.jsx)(e.li,{children:"But NULL won't be passed as an argument to the SQL function"}),"\n",(0,r.jsx)(e.li,{children:"Useful for optional parameters that the function can handle internally"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"chained-function-calls",children:"Chained Function Calls"}),"\n",(0,r.jsx)(e.p,{children:"Combine multiple function fields:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'extend type orders {\n  # First: calculate base discount\n  base_discount: Float @function_call(\n    references_name: "calc_base_discount"\n    args: { total: "total" }\n  )\n\n  # Second: apply loyalty bonus using base_discount\n  final_discount: Float @function_call(\n    references_name: "apply_loyalty"\n    args: {\n      customer_id: "customer_id"\n      base_discount: "base_discount"\n    }\n  )\n\n  # Third: calculate final total\n  discounted_total: Float @function_call(\n    references_name: "apply_discount"\n    args: {\n      total: "total"\n      discount: "final_discount"\n    }\n  )\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Query:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  orders {\n    id\n    total\n    base_discount\n    final_discount\n    discounted_total\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"field-aliases-with-functions",children:"Field Aliases with Functions"}),"\n",(0,r.jsx)(e.p,{children:"Rename function fields in responses:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'query {\n  products {\n    id\n    name\n    price\n    # Multiple conversions with aliases\n    price_eur: price_converted(to_currency: "EUR")\n    price_gbp: price_converted(to_currency: "GBP")\n    price_jpy: price_converted(to_currency: "JPY")\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"fragments-with-function-fields",children:"Fragments with Function Fields"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'fragment ProductWithPrices on products {\n  id\n  name\n  price\n  currency\n  price_usd: price_converted(to_currency: "USD")\n  price_eur: price_converted(to_currency: "EUR")\n}\n\nquery {\n  products {\n    ...ProductWithPrices\n  }\n\n  top_products: products(\n    order_by: [{ field: "sales", direction: DESC }]\n    limit: 10\n  ) {\n    ...ProductWithPrices\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsx)(e.h3,{id:"1-batch-function-execution",children:"1. Batch Function Execution"}),"\n",(0,r.jsx)(e.p,{children:"When possible, create functions that can process multiple rows:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'# Less efficient - called once per product\nextend type products {\n  stock_status: String @function_call(\n    references_name: "check_stock"\n    args: { product_id: "id" }\n  )\n}\n\n# More efficient - use parameterized view\ntype stock_status_view @view(\n  name: "stock_statuses"\n  sql: "SELECT * FROM check_all_stock()"\n) {\n  product_id: Int!\n  status: String!\n}\n\nextend type products {\n  stock_status: stock_status_view @join(\n    references_name: "stock_status_view"\n    source_fields: ["id"]\n    references_fields: ["product_id"]\n  )\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"2-limit-table-function-results",children:"2. Limit Table Function Results"}),"\n",(0,r.jsx)(e.p,{children:"Always limit results from table functions:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    # Always use limit\n    recommendations(limit: 10) {\n      id\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-cache-expensive-functions",children:"3. Cache Expensive Functions"}),"\n",(0,r.jsx)(e.p,{children:"Use caching for expensive function calls:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  products {\n    id\n    # Cache for 5 minutes\n    ml_recommendations: recommendations @cache(ttl: 300) {\n      id\n      name\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"4-filter-before-function-calls",children:"4. Filter Before Function Calls"}),"\n",(0,r.jsx)(e.p,{children:"Reduce the number of function executions:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"# Good - Filter first, then call function\nquery {\n  products(\n    filter: { active: { eq: true } }\n    limit: 20\n  ) {\n    id\n    recommendations(limit: 5) {\n      id\n    }\n  }\n}\n\n# Avoid - Function called for all products\nquery {\n  products {\n    id\n    recommendations(limit: 5) {\n      id\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,r.jsx)(e.h3,{id:"enriching-data-with-external-apis",children:"Enriching Data with External APIs"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  customers {\n    id\n    name\n    email\n    # Enrich with credit score\n    credit_info: credit_check {\n      score\n      rating\n      updated_at\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"dynamic-calculations",children:"Dynamic Calculations"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'query {\n  orders {\n    id\n    subtotal\n    # Calculate taxes dynamically\n    tax_amount: calculate_tax(jurisdiction: "NY")\n    # Calculate shipping\n    shipping_cost\n    # Final total\n    total: final_total(jurisdiction: "NY")\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"personalized-content",children:"Personalized Content"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query GetPersonalizedProducts($userId: Int!) {\n  customers_by_pk(id: $userId) {\n    id\n    name\n    # Personalized recommendations\n    recommendations(limit: 20) {\n      id\n      name\n      price\n      relevance_score\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"real-time-data",children:"Real-Time Data"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  sensors {\n    id\n    name\n    # Latest readings from external system\n    current_reading {\n      timestamp\n      value\n      status\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(e.p,{children:"Function field errors are categorized into two types:"}),"\n",(0,r.jsx)(e.h3,{id:"planning-errors-sql-generation",children:"Planning Errors (SQL Generation)"}),"\n",(0,r.jsx)(e.p,{children:"Validation errors caught during query planning, with specific error paths:"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Invalid argument types:"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:"query {\n  products {\n    id\n    price_converted(to_currency: 123)  # Wrong type, expects String\n  }\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"Response:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": [\n    {\n      "message": "Argument \'to_currency\' expects type String, got Int",\n      "path": ["products", "price_converted"],\n      "extensions": {\n        "code": "INVALID_ARGUMENT_TYPE"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Invalid field names in sorting/aggregations:"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'query {\n  products(\n    order_by: [{ field: "non_existent_field", direction: ASC }]\n  ) {\n    id\n    name\n  }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Response:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": [\n    {\n      "message": "Field \'non_existent_field\' does not exist in type \'products\'",\n      "path": ["products"]\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"sql-execution-errors",children:"SQL Execution Errors"}),"\n",(0,r.jsx)(e.p,{children:"Runtime errors during SQL execution, reported at query level:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-graphql",children:'query {\n  products {\n    id\n    price_converted(to_currency: "INVALID")  # Invalid at runtime\n  }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Response:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": [\n    {\n      "message": "Invalid currency code: INVALID"\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Learn about ",(0,r.jsx)(e.a,{href:"/docs/graphql/queries/aggregations",children:"Aggregations"})," for grouping and computing statistics"]}),"\n",(0,r.jsxs)(e.li,{children:["See ",(0,r.jsx)(e.a,{href:"/docs/graphql/queries/dynamic-joins",children:"Dynamic Joins"})," for ad-hoc query-time joins"]}),"\n",(0,r.jsxs)(e.li,{children:["Check ",(0,r.jsx)(e.a,{href:"/docs/graphql/queries/function-calls",children:"Function Calls"})," for direct function invocation"]}),"\n",(0,r.jsxs)(e.li,{children:["Review ",(0,r.jsx)(e.a,{href:"/docs/engine-configuration/schema-definition/data-objects/function-calls",children:"Schema Definition - Function Calls"})," for setup details"]}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>a,x:()=>l});var t=i(6540);const r={},s=t.createContext(r);function a(n){const e=t.useContext(s);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:a(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);