"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[2477],{5971:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>c,frontMatter:()=>t,metadata:()=>a,toc:()=>g});const a=JSON.parse('{"id":"engine-configuration/schema-definition/data-objects/aggregations","title":"Aggregations","description":"Hugr provides powerful aggregation capabilities for data analysis, including single-row aggregations and bucket (group-by) aggregations. These are automatically generated for all data objects.","source":"@site/docs/4-engine-configuration/3-schema-definition/3-data-objects/6-aggregations.md","sourceDirName":"4-engine-configuration/3-schema-definition/3-data-objects","slug":"/engine-configuration/schema-definition/data-objects/aggregations","permalink":"/docs/engine-configuration/schema-definition/data-objects/aggregations","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/4-engine-configuration/3-schema-definition/3-data-objects/6-aggregations.md","tags":[],"version":"current","lastUpdatedBy":"vgsml","lastUpdatedAt":1756711778000,"sidebarPosition":6,"frontMatter":{"title":"Aggregations","sidebar_position":6},"sidebar":"docsSidebar","previous":{"title":"Mutations","permalink":"/docs/engine-configuration/schema-definition/data-objects/mutations"},"next":{"title":"Relations and Foreign Keys","permalink":"/docs/engine-configuration/schema-definition/data-objects/relations"}}');var r=i(4848),s=i(8453);const t={title:"Aggregations",sidebar_position:6},l="Aggregations",o={},g=[{value:"Single Row Aggregation",id:"single-row-aggregation",level:2},{value:"Available Aggregation Functions",id:"available-aggregation-functions",level:3},{value:"Filtered Aggregation",id:"filtered-aggregation",level:2},{value:"Bucket Aggregation (GROUP BY)",id:"bucket-aggregation-group-by",level:2},{value:"Sorting Bucket Results",id:"sorting-bucket-results",level:3},{value:"Time-Based Grouping",id:"time-based-grouping",level:3},{value:"Custom Intervals",id:"custom-intervals",level:3},{value:"Nested Aggregations",id:"nested-aggregations",level:2},{value:"Multiple Aggregations with Filters",id:"multiple-aggregations-with-filters",level:2},{value:"JSON Field Aggregation",id:"json-field-aggregation",level:2},{value:"Geometry Aggregation",id:"geometry-aggregation",level:2},{value:"Sub-aggregations",id:"sub-aggregations",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Limit Aggregated Data",id:"limit-aggregated-data",level:3},{value:"Optimize GROUP BY",id:"optimize-group-by",level:3},{value:"Use Indexes",id:"use-indexes",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"aggregations",children:"Aggregations"})}),"\n",(0,r.jsx)(n.p,{children:"Hugr provides powerful aggregation capabilities for data analysis, including single-row aggregations and bucket (group-by) aggregations. These are automatically generated for all data objects."}),"\n",(0,r.jsx)(n.h2,{id:"single-row-aggregation",children:"Single Row Aggregation"}),"\n",(0,r.jsx)(n.p,{children:"Aggregate all records into a single result:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers_aggregation {\n    _rows_count\n    age {\n      avg\n      min\n      max\n    }\n    created_at {\n      min\n      max\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"available-aggregation-functions",children:"Available Aggregation Functions"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Numeric fields (Int, Float, BigInt):"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"count"})," - Count of non-null values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sum"})," - Sum of values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"avg"})," - Average value"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"min"})," - Minimum value"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"max"})," - Maximum value"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stddev"})," - Standard deviation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"variance"})," - Variance"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"String fields:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"count"})," - Count of non-null values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"min"})," - Alphabetically first value"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"max"})," - Alphabetically last value"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"string_agg(separator: String!)"})," - Concatenate with separator"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"list(distinct: Boolean)"})," - Array of values"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Boolean fields:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"count"})," - Count of non-null values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bool_and"})," - Logical AND of all values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bool_or"})," - Logical OR of all values"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Date/Timestamp fields:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"count"})," - Count of non-null values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"min"})," - Earliest date/time"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"max"})," - Latest date/time"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"filtered-aggregation",children:"Filtered Aggregation"}),"\n",(0,r.jsx)(n.p,{children:"Apply filters before aggregating:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  orders_aggregation(\n    filter: {\n      status: { eq: "completed" }\n      order_date: { gte: "2024-01-01" }\n    }\n  ) {\n    _rows_count\n    total {\n      sum\n      avg\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"bucket-aggregation-group-by",children:"Bucket Aggregation (GROUP BY)"}),"\n",(0,r.jsx)(n.p,{children:"Group records and aggregate each group:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  orders_bucket_aggregation {\n    key {\n      status\n      customer {\n        country\n      }\n    }\n    aggregations {\n      _rows_count\n      total {\n        sum\n        avg\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"sorting-bucket-results",children:"Sorting Bucket Results"}),"\n",(0,r.jsx)(n.p,{children:"Sort by aggregated values or keys:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  products_bucket_aggregation(\n    order_by: [\n      { field: "aggregations.sales.sum", direction: DESC }\n    ]\n  ) {\n    key {\n      category {\n        name\n      }\n    }\n    aggregations {\n      _rows_count\n      sales {\n        sum\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"time-based-grouping",children:"Time-Based Grouping"}),"\n",(0,r.jsx)(n.p,{children:"Group by time buckets:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  orders_bucket_aggregation {\n    key {\n      order_date(bucket: month)\n      year: _order_date_part(extract: year)\n      month: _order_date_part(extract: month)\n    }\n    aggregations {\n      _rows_count\n      revenue {\n        sum\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Available time buckets:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"minute"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"hour"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"day"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"week"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"month"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"quarter"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"year"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"custom-intervals",children:"Custom Intervals"}),"\n",(0,r.jsx)(n.p,{children:"Use custom time intervals:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  sensor_data_bucket_aggregation {\n    key {\n      timestamp(bucket_interval: "15 minutes")\n    }\n    aggregations {\n      temperature {\n        avg\n        min\n        max\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"nested-aggregations",children:"Nested Aggregations"}),"\n",(0,r.jsx)(n.p,{children:"Aggregate related data through relationships:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  customers_aggregation {\n    _rows_count\n    orders {\n      _rows_count\n      total {\n        sum\n        avg\n      }\n      order_details {\n        quantity {\n          sum\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"multiple-aggregations-with-filters",children:"Multiple Aggregations with Filters"}),"\n",(0,r.jsx)(n.p,{children:"Apply different filters to different aggregations:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  products_bucket_aggregation {\n    key {\n      category {\n        name\n      }\n    }\n    aggregations {\n      _rows_count\n    }\n    in_stock: aggregations(\n      filter: { stock_quantity: { gt: 0 } }\n    ) {\n      _rows_count\n      stock_quantity {\n        sum\n      }\n    }\n    on_sale: aggregations(\n      filter: { discount: { gt: 0 } }\n    ) {\n      _rows_count\n      discount {\n        avg\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"json-field-aggregation",children:"JSON Field Aggregation"}),"\n",(0,r.jsx)(n.p,{children:"Aggregate data within JSON fields:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  events_aggregation {\n    metadata {\n      count(path: "$.user_id")\n      sum(path: "$.score")\n      avg(path: "$.duration")\n      list(path: "$.tags", distinct: true)\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"geometry-aggregation",children:"Geometry Aggregation"}),"\n",(0,r.jsx)(n.p,{children:"Aggregate geometric data:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  locations_aggregation {\n    _rows_count\n    area {\n      union  # Union of all geometries\n      extent # Bounding box\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"sub-aggregations",children:"Sub-aggregations"}),"\n",(0,r.jsx)(n.p,{children:"For aggregated fields, apply additional aggregation functions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query {\n  sales_bucket_aggregation {\n    key {\n      region\n    }\n    aggregations {\n      stores {\n        _rows_count\n      }\n      stores_aggregation {\n        revenue {\n          sum {\n            sum  # Sum of sums\n            avg  # Average of sums\n            min  # Minimum sum\n            max  # Maximum sum\n          }\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"limit-aggregated-data",children:"Limit Aggregated Data"}),"\n",(0,r.jsx)(n.p,{children:"Use filters and limits to reduce the dataset:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  large_table_aggregation(\n    filter: { created_at: { gte: "2024-01-01" } }\n    limit: 10000\n  ) {\n    _rows_count\n    amount {\n      sum\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"optimize-group-by",children:"Optimize GROUP BY"}),"\n",(0,r.jsx)(n.p,{children:"Limit the number of groups:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query {\n  orders_bucket_aggregation(\n    limit: 100  # Return only top 100 groups\n    order_by: [\n      { field: "aggregations.total.sum", direction: DESC }\n    ]\n  ) {\n    key {\n      customer_id\n    }\n    aggregations {\n      total {\n        sum\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"use-indexes",children:"Use Indexes"}),"\n",(0,r.jsx)(n.p,{children:"Ensure proper indexes exist for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Fields used in GROUP BY (key fields)"}),"\n",(0,r.jsx)(n.li,{children:"Fields used in filters"}),"\n",(0,r.jsx)(n.li,{children:"Fields used in ORDER BY"}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var a=i(6540);const r={},s=a.createContext(r);function t(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);