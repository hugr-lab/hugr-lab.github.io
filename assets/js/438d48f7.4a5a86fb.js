"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[8709],{5478:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"engine-configuration/cache","title":"Cache Directives and Functions","description":"Control caching behavior with @cache, @no_cache, @invalidate_cache directives and core.cache.invalidate() function","source":"@site/docs/4-engine-configuration/6-cache.md","sourceDirName":"4-engine-configuration","slug":"/engine-configuration/cache","permalink":"/docs/engine-configuration/cache","draft":false,"unlisted":false,"editUrl":"https://github.com/hugr-lab/hugr-lab.github.io/docs/4-engine-configuration/6-cache.md","tags":[],"version":"current","lastUpdatedBy":"Claude","lastUpdatedAt":1762511553000,"sidebarPosition":7,"frontMatter":{"title":"Cache Directives and Functions","sidebar_position":7,"description":"Control caching behavior with @cache, @no_cache, @invalidate_cache directives and core.cache.invalidate() function","keywords":["cache","caching","@cache","@no_cache","@invalidate_cache","core.cache","invalidate","performance","ttl","tags"]},"sidebar":"docsSidebar","previous":{"title":"Access Control","permalink":"/docs/engine-configuration/access-control"},"next":{"title":"GraphQL API","permalink":"/docs/graphql/"}}');var a=i(4848),r=i(8453);const c={title:"Cache Directives and Functions",sidebar_position:7,description:"Control caching behavior with @cache, @no_cache, @invalidate_cache directives and core.cache.invalidate() function",keywords:["cache","caching","@cache","@no_cache","@invalidate_cache","core.cache","invalidate","performance","ttl","tags"]},t="Cache Directives and Functions",l={},d=[{value:"Cache Control Methods",id:"cache-control-methods",level:2},{value:"Overview",id:"overview",level:2},{value:"What are Cache Directives?",id:"what-are-cache-directives",level:3},{value:"When to Use Cache Directives",id:"when-to-use-cache-directives",level:3},{value:"How They Work with L1/L2 Cache System",id:"how-they-work-with-l1l2-cache-system",level:3},{value:"Benefits of Directive-Based Caching",id:"benefits-of-directive-based-caching",level:3},{value:"@cache Directive",id:"cache-directive",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Usage in Schema Definitions",id:"usage-in-schema-definitions",level:3},{value:"Usage at Query Time",id:"usage-at-query-time",level:3},{value:"Cache Key Generation",id:"cache-key-generation",level:3},{value:"Automatic Key Generation",id:"automatic-key-generation",level:4},{value:"Custom Cache Keys",id:"custom-cache-keys",level:4},{value:"TTL (Time-To-Live) Configuration",id:"ttl-time-to-live-configuration",level:3},{value:"Cache Tags for Invalidation",id:"cache-tags-for-invalidation",level:3},{value:"@no_cache Directive",id:"no_cache-directive",level:2},{value:"Syntax",id:"syntax-1",level:3},{value:"When to Use",id:"when-to-use",level:3},{value:"Examples",id:"examples",level:3},{value:"Bypass Cache for Real-Time Data",id:"bypass-cache-for-real-time-data",level:4},{value:"User-Specific Data",id:"user-specific-data",level:4},{value:"Override Schema-Level Caching",id:"override-schema-level-caching",level:4},{value:"@invalidate_cache Directive",id:"invalidate_cache-directive",level:2},{value:"Syntax",id:"syntax-2",level:3},{value:"How It Works",id:"how-it-works",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"Force Cache Refresh",id:"force-cache-refresh",level:4},{value:"After Data Mutations",id:"after-data-mutations",level:4},{value:"Debugging and Development",id:"debugging-and-development",level:4},{value:"Combining with Tags",id:"combining-with-tags",level:3},{value:"Schema-Level Caching",id:"schema-level-caching",level:2},{value:"Automatic Caching on Queries",id:"automatic-caching-on-queries",level:3},{value:"Automatic Cache Invalidation on Mutations",id:"automatic-cache-invalidation-on-mutations",level:3},{value:"Tags-Based Invalidation",id:"tags-based-invalidation",level:3},{value:"Query-Time Caching",id:"query-time-caching",level:2},{value:"Custom Cache Keys",id:"custom-cache-keys-1",level:3},{value:"Dynamic TTL Based on Data",id:"dynamic-ttl-based-on-data",level:3},{value:"Combining with Filters and Variables",id:"combining-with-filters-and-variables",level:3},{value:"Cache Key Generation",id:"cache-key-generation-1",level:2},{value:"Automatic Key Generation",id:"automatic-key-generation-1",level:3},{value:"Custom Keys with key Parameter",id:"custom-keys-with-key-parameter",level:3},{value:"Role-Based Cache Isolation",id:"role-based-cache-isolation",level:3},{value:"Best Practices for Key Naming",id:"best-practices-for-key-naming",level:3},{value:"Cache Tags and Invalidation",id:"cache-tags-and-invalidation",level:2},{value:"Using Tags for Grouped Invalidation",id:"using-tags-for-grouped-invalidation",level:3},{value:"Automatic Invalidation on Mutations",id:"automatic-invalidation-on-mutations",level:3},{value:"Manual Invalidation with @invalidate_cache",id:"manual-invalidation-with-invalidate_cache",level:3},{value:"Programmatic Cache Invalidation",id:"programmatic-cache-invalidation",level:3},{value:"Function Definition",id:"function-definition",level:4},{value:"Syntax",id:"syntax-3",level:4},{value:"Parameters",id:"parameters-1",level:4},{value:"Return Value",id:"return-value",level:4},{value:"Examples",id:"examples-1",level:4},{value:"When to Use",id:"when-to-use-1",level:4},{value:"Best Practices",id:"best-practices",level:4},{value:"Integration Example",id:"integration-example",level:4},{value:"Tag Naming Conventions",id:"tag-naming-conventions",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Example 1: Cache Static Reference Data",id:"example-1-cache-static-reference-data",level:3},{value:"Example 2: Cache Expensive Aggregations",id:"example-2-cache-expensive-aggregations",level:3},{value:"Example 3: Per-User Cache Isolation",id:"example-3-per-user-cache-isolation",level:3},{value:"Example 4: Invalidate Cache on Data Change",id:"example-4-invalidate-cache-on-data-change",level:3},{value:"Example 5: Mixed Caching Strategies",id:"example-5-mixed-caching-strategies",level:3},{value:"Example 6: Cache with @cache in queryHugr()",id:"example-6-cache-with-cache-in-queryhugr",level:3},{value:"Example 7: Bypass Cache for Real-Time Data",id:"example-7-bypass-cache-for-real-time-data",level:3},{value:"Example 8: Caching Role Permissions",id:"example-8-caching-role-permissions",level:3},{value:"How Hugr Caches Role Permissions",id:"how-hugr-caches-role-permissions",level:4},{value:"Querying Role Permissions with Cache",id:"querying-role-permissions-with-cache",level:4},{value:"Invalidating Role Permissions Cache",id:"invalidating-role-permissions-cache",level:4},{value:"Complete Workflow Example",id:"complete-workflow-example",level:4},{value:"Best Practices for Permission Caching",id:"best-practices-for-permission-caching",level:4},{value:"Security Considerations",id:"security-considerations",level:4},{value:"Performance Impact",id:"performance-impact",level:4},{value:"Integration with Caching Infrastructure",id:"integration-with-caching-infrastructure",level:2},{value:"How Directives Interact with L1/L2 Cache",id:"how-directives-interact-with-l1l2-cache",level:3},{value:"Cache Configuration Requirements",id:"cache-configuration-requirements",level:3},{value:"Link to Deployment Caching Configuration",id:"link-to-deployment-caching-configuration",level:3},{value:"Best Practices",id:"best-practices-1",level:2},{value:"When to Use Schema-Level vs Query-Time Caching",id:"when-to-use-schema-level-vs-query-time-caching",level:3},{value:"Choosing Appropriate TTL Values",id:"choosing-appropriate-ttl-values",level:3},{value:"Tag Organization Strategies",id:"tag-organization-strategies",level:3},{value:"Cache Key Design",id:"cache-key-design",level:3},{value:"Avoiding Cache Stampede",id:"avoiding-cache-stampede",level:3},{value:"Memory Considerations",id:"memory-considerations",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Cache Hit Ratio Optimization",id:"cache-hit-ratio-optimization",level:3},{value:"Impact on Query Performance",id:"impact-on-query-performance",level:3},{value:"Cache Warming Strategies",id:"cache-warming-strategies",level:3},{value:"Monitoring Cache Effectiveness",id:"monitoring-cache-effectiveness",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Pattern 1: Caching Read-Heavy Queries",id:"pattern-1-caching-read-heavy-queries",level:3},{value:"Pattern 2: Cache-Aside Pattern",id:"pattern-2-cache-aside-pattern",level:3},{value:"Pattern 3: Write-Through Caching",id:"pattern-3-write-through-caching",level:3},{value:"Pattern 4: Time-Based Invalidation",id:"pattern-4-time-based-invalidation",level:3},{value:"Pattern 5: Event-Based Invalidation",id:"pattern-5-event-based-invalidation",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Cache Not Working",id:"cache-not-working",level:3},{value:"Stale Data Issues",id:"stale-data-issues",level:3},{value:"Cache Key Collisions",id:"cache-key-collisions",level:3},{value:"Memory Pressure",id:"memory-pressure",level:3},{value:"See Also",id:"see-also",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"cache-directives-and-functions",children:"Cache Directives and Functions"})}),"\n",(0,a.jsxs)(n.p,{children:["Hugr provides three GraphQL directives to control query result caching: ",(0,a.jsx)(n.code,{children:"@cache"}),", ",(0,a.jsx)(n.code,{children:"@no_cache"}),", and ",(0,a.jsx)(n.code,{children:"@invalidate_cache"}),". Additionally, the ",(0,a.jsx)(n.code,{children:"core.cache.invalidate()"})," function enables programmatic cache invalidation. These features work seamlessly with hugr's ",(0,a.jsx)(n.a,{href:"/docs/deployment/caching",children:"two-level caching system"})," (L1 in-memory and L2 distributed) to optimize query performance and reduce database load."]}),"\n",(0,a.jsx)(n.h2,{id:"cache-control-methods",children:"Cache Control Methods"}),"\n",(0,a.jsx)(n.p,{children:"Hugr offers multiple ways to control caching behavior:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"#cache-directive",children:"@cache directive"})})," - Enable caching for queries or schema types"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"#no_cache-directive",children:"@no_cache directive"})})," - Disable caching for specific queries"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"#invalidate_cache-directive",children:"@invalidate_cache directive"})})," - Invalidate cache during query execution"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"#programmatic-cache-invalidation",children:"core.cache.invalidate() function"})})," - Programmatically invalidate cache by tags"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.h3,{id:"what-are-cache-directives",children:"What are Cache Directives?"}),"\n",(0,a.jsx)(n.p,{children:"Cache directives and functions allow you to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Enable automatic caching of query results with ",(0,a.jsx)(n.code,{children:"@cache"})]}),"\n",(0,a.jsxs)(n.li,{children:["Disable caching for specific queries that require real-time data with ",(0,a.jsx)(n.code,{children:"@no_cache"})]}),"\n",(0,a.jsxs)(n.li,{children:["Invalidate cached data when mutations occur with ",(0,a.jsx)(n.code,{children:"@invalidate_cache"})," directive or ",(0,a.jsx)(n.code,{children:"core.cache.invalidate()"})," function"]}),"\n",(0,a.jsxs)(n.li,{children:["Programmatically invalidate cache by tags using ",(0,a.jsx)(n.code,{children:"core.cache.invalidate(tags: [...])"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"when-to-use-cache-directives",children:"When to Use Cache Directives"}),"\n",(0,a.jsx)(n.p,{children:"Use cache directives when you need to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Improve Performance"}),": Cache expensive queries (aggregations, joins, complex transformations)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Reduce Database Load"}),": Avoid repeated execution of identical queries"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Optimize Costs"}),": Minimize queries to external APIs or databases"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Control Freshness"}),": Ensure real-time data is never cached with ",(0,a.jsx)(n.code,{children:"@no_cache"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Maintain Consistency"}),": Invalidate cache when data changes with ",(0,a.jsx)(n.code,{children:"@invalidate_cache"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"how-they-work-with-l1l2-cache-system",children:"How They Work with L1/L2 Cache System"}),"\n",(0,a.jsx)(n.p,{children:"Cache directives integrate with hugr's two-level caching:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"L1 Cache (In-Memory)"}),": Fast local cache for quick access"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"L2 Cache (Distributed)"}),": Shared cache across multiple hugr instances (Redis/Memcached)"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["When a query with ",(0,a.jsx)(n.code,{children:"@cache"})," is executed:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Hugr checks L1 cache first (fastest)"}),"\n",(0,a.jsx)(n.li,{children:"If not found, checks L2 cache (fast)"}),"\n",(0,a.jsx)(n.li,{children:"If not found, executes the query and stores result in both caches"}),"\n",(0,a.jsx)(n.li,{children:"Subsequent requests serve from cache until TTL expires"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"benefits-of-directive-based-caching",children:"Benefits of Directive-Based Caching"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Declarative"}),": Specify caching behavior directly in schemas or queries"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Flexible"}),": Apply to entire types or individual queries"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Fine-Grained Control"}),": Custom TTL, keys, and tags per query"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Automatic Invalidation"}),": Tag-based cache invalidation on mutations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Role-Aware"}),": Automatic cache isolation per user role"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"cache-directive",children:"@cache Directive"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"@cache"})," directive enables caching for fields, objects, or entire queries."]}),"\n",(0,a.jsx)(n.h3,{id:"syntax",children:"Syntax"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'directive @cache(\n  """\n  Time to live for the cache in seconds\n  """\n  ttl: Int\n  """\n  Cache key for the query (optional)\n  """\n  key: String\n  """\n  Cache tags for grouped invalidation (optional)\n  """\n  tags: [String!]\n) on FIELD | OBJECT | FIELD_DEFINITION\n'})}),"\n",(0,a.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Parameter"}),(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"Description"}),(0,a.jsx)(n.th,{children:"Required"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"ttl"})}),(0,a.jsx)(n.td,{children:"Int"}),(0,a.jsx)(n.td,{children:"Time-to-live in seconds. How long the cached result remains valid."}),(0,a.jsxs)(n.td,{children:["No (uses global ",(0,a.jsx)(n.code,{children:"CACHE_TTL"}),")"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"key"})}),(0,a.jsx)(n.td,{children:"String"}),(0,a.jsx)(n.td,{children:"Custom cache key. If not provided, auto-generated from query hash."}),(0,a.jsx)(n.td,{children:"No"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"tags"})}),(0,a.jsx)(n.td,{children:"[String!]"}),(0,a.jsx)(n.td,{children:"Tags for grouped cache invalidation. Useful for invalidating related queries."}),(0,a.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"usage-in-schema-definitions",children:"Usage in Schema Definitions"}),"\n",(0,a.jsxs)(n.p,{children:["Apply ",(0,a.jsx)(n.code,{children:"@cache"})," to object types for automatic caching of all queries for that type:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'type users @table(name: "users") @cache(ttl: 300, tags: ["users"]) {\n  id: ID!\n  name: String!\n  email: String!\n  age: Int!\n}\n\ntype products @table(name: "products") @cache(ttl: 600, tags: ["products"]) {\n  id: ID!\n  name: String!\n  price: Float!\n  category: String!\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["All queries for ",(0,a.jsx)(n.code,{children:"users"})," are automatically cached for 5 minutes"]}),"\n",(0,a.jsxs)(n.li,{children:["All queries for ",(0,a.jsx)(n.code,{children:"products"})," are cached for 10 minutes"]}),"\n",(0,a.jsx)(n.li,{children:"Tagged for easy invalidation when data changes"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"usage-at-query-time",children:"Usage at Query Time"}),"\n",(0,a.jsxs)(n.p,{children:["Apply ",(0,a.jsx)(n.code,{children:"@cache"})," to specific queries for manual control:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  # Cached query with custom TTL\n  topProducts: products(\n    filter: { category: "electronics" }\n    order: { price: DESC }\n    limit: 10\n  ) @cache(ttl: 300, key: "top_electronics", tags: ["products"]) {\n    id\n    name\n    price\n  }\n\n  # Another cached query with different parameters\n  budgetProducts: products(\n    filter: { price: { lt: 100 } }\n  ) @cache(ttl: 600, tags: ["products", "budget"]) {\n    id\n    name\n    price\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"cache-key-generation",children:"Cache Key Generation"}),"\n",(0,a.jsx)(n.h4,{id:"automatic-key-generation",children:"Automatic Key Generation"}),"\n",(0,a.jsxs)(n.p,{children:["If ",(0,a.jsx)(n.code,{children:"key"})," parameter is not provided, hugr automatically generates a cache key based on:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Query text structure"}),"\n",(0,a.jsx)(n.li,{children:"Query variables"}),"\n",(0,a.jsx)(n.li,{children:"User role/permissions (when authentication is enabled)"}),"\n",(0,a.jsx)(n.li,{children:"Data source configuration"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This ensures that:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Different queries get different cache entries"}),"\n",(0,a.jsx)(n.li,{children:"Same query with different variables gets different cache entries"}),"\n",(0,a.jsx)(n.li,{children:"Different users (roles) don't share cache entries (unless explicitly keyed)"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"query GetUser($userId: ID!) {\n  user(filter: { id: $userId }) @cache(ttl: 300) {\n    id\n    name\n    email\n  }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"This query will have different cache entries for:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"userId = 1"})," and ",(0,a.jsx)(n.code,{children:"userId = 2"})," (different variables)"]}),"\n",(0,a.jsx)(n.li,{children:"Admin role and User role (different permissions)"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"custom-cache-keys",children:"Custom Cache Keys"}),"\n",(0,a.jsxs)(n.p,{children:["Use the ",(0,a.jsx)(n.code,{children:"key"})," parameter for explicit cache control:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  # All users share this cache entry regardless of role\n  globalStats: statistics_aggregation\n    @cache(ttl: 600, key: "global_stats") {\n    total_users\n    total_orders\n    revenue\n  }\n\n  # Per-category cache entries\n  electronics: products(filter: { category: "electronics" })\n    @cache(ttl: 300, key: "products:electronics") {\n    id\n    name\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"When to use custom keys"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Shared cache across all users/roles"}),"\n",(0,a.jsx)(n.li,{children:"Predictable key names for manual invalidation"}),"\n",(0,a.jsx)(n.li,{children:"Cache entries that should be independent of query structure"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"ttl-time-to-live-configuration",children:"TTL (Time-To-Live) Configuration"}),"\n",(0,a.jsx)(n.p,{children:"TTL determines how long cached results remain valid before re-execution."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Short TTL for frequently changing data\nquery RealtimeOrders {\n  recentOrders: orders(\n    filter: { created_at: { gte: "2024-01-01" } }\n    order: { created_at: DESC }\n  ) @cache(ttl: 60) {  # 1 minute\n    id\n    status\n    total\n  }\n}\n\n# Medium TTL for moderately changing data\nquery ProductCatalog {\n  products @cache(ttl: 300) {  # 5 minutes\n    id\n    name\n    price\n  }\n}\n\n# Long TTL for rarely changing data\nquery Categories {\n  categories @cache(ttl: 3600) {  # 1 hour\n    id\n    name\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"TTL Guidelines"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Real-time data: 30-60 seconds"}),"\n",(0,a.jsx)(n.li,{children:"Frequently updated: 1-5 minutes"}),"\n",(0,a.jsx)(n.li,{children:"Moderately updated: 5-15 minutes"}),"\n",(0,a.jsx)(n.li,{children:"Rarely updated: 15-60 minutes"}),"\n",(0,a.jsx)(n.li,{children:"Static reference data: 1-24 hours"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cache-tags-for-invalidation",children:"Cache Tags for Invalidation"}),"\n",(0,a.jsx)(n.p,{children:"Tags enable grouped cache invalidation. When data changes, invalidate all queries with a specific tag."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'type orders @table(name: "orders") @cache(ttl: 300, tags: ["orders"]) {\n  id: ID!\n  customer_id: Int!\n  total: Float!\n  status: String!\n}\n\nquery {\n  # All these queries share the "orders" tag\n  allOrders: orders @cache(ttl: 300, tags: ["orders"]) {\n    id\n    total\n  }\n\n  pendingOrders: orders(\n    filter: { status: "pending" }\n  ) @cache(ttl: 300, tags: ["orders", "pending"]) {\n    id\n    total\n  }\n\n  completedOrders: orders(\n    filter: { status: "completed" }\n  ) @cache(ttl: 300, tags: ["orders", "completed"]) {\n    id\n    total\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["When an order is created or updated, you can invalidate all queries tagged with ",(0,a.jsx)(n.code,{children:'"orders"'})," to ensure consistency."]}),"\n",(0,a.jsx)(n.h2,{id:"no_cache-directive",children:"@no_cache Directive"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"@no_cache"})," directive disables caching for specific queries, ensuring fresh data on every request."]}),"\n",(0,a.jsx)(n.h3,{id:"syntax-1",children:"Syntax"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"directive @no_cache on FIELD\n"})}),"\n",(0,a.jsx)(n.h3,{id:"when-to-use",children:"When to Use"}),"\n",(0,a.jsxs)(n.p,{children:["Use ",(0,a.jsx)(n.code,{children:"@no_cache"})," when you need:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Real-time data that must never be cached"}),"\n",(0,a.jsx)(n.li,{children:"User-specific data that shouldn't be shared"}),"\n",(0,a.jsx)(n.li,{children:"Debugging queries during development"}),"\n",(0,a.jsx)(n.li,{children:"One-time queries that won't be repeated"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(n.h4,{id:"bypass-cache-for-real-time-data",children:"Bypass Cache for Real-Time Data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"query {\n  # Cached for performance\n  products @cache(ttl: 300) {\n    id\n    name\n    price\n  }\n\n  # Real-time inventory - never cached\n  inventory: products @no_cache {\n    id\n    stock_quantity\n    last_updated\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"user-specific-data",children:"User-Specific Data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"query GetUserDashboard($userId: ID!) {\n  # Static data - cached\n  categories @cache(ttl: 600) {\n    id\n    name\n  }\n\n  # User-specific data - not cached to ensure freshness\n  user(filter: { id: $userId }) @no_cache {\n    id\n    name\n    recent_activity {\n      timestamp\n      action\n    }\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"override-schema-level-caching",children:"Override Schema-Level Caching"}),"\n",(0,a.jsxs)(n.p,{children:["Even if a type has ",(0,a.jsx)(n.code,{children:"@cache"})," in its schema definition, you can bypass it at query time:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Schema has @cache\ntype users @table(name: "users") @cache(ttl: 300) {\n  id: ID!\n  name: String!\n  email: String!\n}\n\n# Query bypasses schema-level cache\nquery {\n  # Uses schema cache\n  allUsers: users {\n    id\n    name\n  }\n\n  # Bypasses cache\n  currentUser: users @no_cache {\n    id\n    name\n    email\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"invalidate_cache-directive",children:"@invalidate_cache Directive"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"@invalidate_cache"})," directive invalidates cached entries before executing the query, ensuring you get fresh data."]}),"\n",(0,a.jsx)(n.h3,{id:"syntax-2",children:"Syntax"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"directive @invalidate_cache on FIELD\n"})}),"\n",(0,a.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,a.jsxs)(n.p,{children:["When ",(0,a.jsx)(n.code,{children:"@invalidate_cache"})," is used:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Cache entries for matching queries are removed"}),"\n",(0,a.jsx)(n.li,{children:"The query is executed against the data source"}),"\n",(0,a.jsxs)(n.li,{children:["New results are cached (if ",(0,a.jsx)(n.code,{children:"@cache"})," is also present)"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,a.jsx)(n.h4,{id:"force-cache-refresh",children:"Force Cache Refresh"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"query {\n  # Regular cached query\n  products @cache(ttl: 300) {\n    id\n    name\n    price\n  }\n\n  # Force refresh - invalidate and re-cache\n  refreshedProducts: products @invalidate_cache @cache(ttl: 300) {\n    id\n    name\n    price\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"after-data-mutations",children:"After Data Mutations"}),"\n",(0,a.jsx)(n.p,{children:"After creating, updating, or deleting data, invalidate related caches:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation CreateProduct($input: ProductInput!) {\n  createProduct(input: $input) {\n    id\n    name\n    price\n  }\n}\n\n# Then immediately query with invalidation\nquery {\n  # Get fresh product list\n  products @invalidate_cache @cache(ttl: 300, tags: ["products"]) {\n    id\n    name\n    price\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"debugging-and-development",children:"Debugging and Development"}),"\n",(0,a.jsxs)(n.p,{children:["During development, use ",(0,a.jsx)(n.code,{children:"@invalidate_cache"})," to ensure you're seeing current data:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"query DebugQuery {\n  # Always get fresh data during debugging\n  testData: users @invalidate_cache {\n    id\n    name\n    email\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"combining-with-tags",children:"Combining with Tags"}),"\n",(0,a.jsx)(n.p,{children:"Invalidate by tags for grouped cache clearing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  # Invalidate all queries tagged with "orders"\n  orders @invalidate_cache @cache(ttl: 300, tags: ["orders"]) {\n    id\n    total\n    status\n  }\n\n  # Also affects other queries with the same tag\n  orderStats: orders_aggregation @invalidate_cache @cache(ttl: 300, tags: ["orders"]) {\n    _rows_count\n    total_revenue { sum }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"schema-level-caching",children:"Schema-Level Caching"}),"\n",(0,a.jsxs)(n.p,{children:["Apply ",(0,a.jsx)(n.code,{children:"@cache"})," to object types in your schema for automatic caching behavior."]}),"\n",(0,a.jsx)(n.h3,{id:"automatic-caching-on-queries",children:"Automatic Caching on Queries"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Schema definition\ntype products @table(name: "products") @cache(ttl: 300, tags: ["products"]) {\n  id: ID!\n  name: String!\n  price: Float!\n  category: String!\n}\n\n# All queries automatically cached\nquery {\n  # Automatically cached for 5 minutes\n  products {\n    id\n    name\n    price\n  }\n\n  # Also automatically cached\n  electronics: products(filter: { category: "electronics" }) {\n    id\n    name\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"automatic-cache-invalidation-on-mutations",children:"Automatic Cache Invalidation on Mutations"}),"\n",(0,a.jsx)(n.p,{children:"When mutations affect cached types, hugr can automatically invalidate related caches using tags:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Schema with cache tags\ntype orders @table(name: "orders") @cache(ttl: 300, tags: ["orders"]) {\n  id: ID!\n  customer_id: Int!\n  total: Float!\n}\n\n# Mutation automatically invalidates "orders" tag\nmutation CreateOrder($input: OrderInput!) {\n  createOrder(input: $input) {\n    id\n    total\n  }\n}\n\n# Subsequent queries get fresh data\nquery {\n  orders @cache(ttl: 300, tags: ["orders"]) {\n    id\n    total\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"tags-based-invalidation",children:"Tags-Based Invalidation"}),"\n",(0,a.jsx)(n.p,{children:"Use tags to group related queries for coordinated invalidation:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Multiple types with shared tags\ntype orders @table(name: "orders") @cache(ttl: 300, tags: ["orders", "sales"]) {\n  id: ID!\n  total: Float!\n}\n\ntype order_items @table(name: "order_items") @cache(ttl: 300, tags: ["orders", "sales"]) {\n  id: ID!\n  order_id: Int!\n  product_id: Int!\n  quantity: Int!\n}\n\n# When orders change, both types\' caches are invalidated\nmutation UpdateOrder($id: ID!, $input: OrderInput!) {\n  updateOrder(id: $id, input: $input) {\n    id\n    total\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"query-time-caching",children:"Query-Time Caching"}),"\n",(0,a.jsxs)(n.p,{children:["Apply ",(0,a.jsx)(n.code,{children:"@cache"})," to specific queries for fine-grained control beyond schema-level defaults."]}),"\n",(0,a.jsx)(n.h3,{id:"custom-cache-keys-1",children:"Custom Cache Keys"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query DashboardStats {\n  # Shared cache across all users\n  globalStats: statistics_aggregation\n    @cache(ttl: 600, key: "dashboard:global_stats") {\n    total_users\n    total_orders\n  }\n\n  # Per-category cache\n  categoryStats: products_bucket_aggregation(\n    filter: { category: "electronics" }\n  ) @cache(ttl: 300, key: "dashboard:category:electronics") {\n    key { category }\n    aggregations {\n      _rows_count\n      avg_price { avg }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"dynamic-ttl-based-on-data",children:"Dynamic TTL Based on Data"}),"\n",(0,a.jsx)(n.p,{children:"Adjust TTL based on data characteristics:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  # Frequently changing data - short TTL\n  activeOrders: orders(\n    filter: { status: "pending" }\n  ) @cache(ttl: 60) {\n    id\n    status\n  }\n\n  # Historical data - long TTL\n  historicalOrders: orders(\n    filter: { created_at: { lt: "2023-01-01" } }\n  ) @cache(ttl: 86400) {  # 24 hours\n    id\n    total\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"combining-with-filters-and-variables",children:"Combining with Filters and Variables"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query FilteredProducts($category: String!, $minPrice: Float!) {\n  products(\n    filter: {\n      category: $category,\n      price: { gte: $minPrice }\n    }\n  ) @cache(ttl: 300, tags: ["products", $category]) {\n    id\n    name\n    price\n  }\n}\n\n# Each variable combination creates a separate cache entry\n# { category: "electronics", minPrice: 100 } - separate entry\n# { category: "books", minPrice: 20 } - separate entry\n'})}),"\n",(0,a.jsx)(n.h2,{id:"cache-key-generation-1",children:"Cache Key Generation"}),"\n",(0,a.jsx)(n.p,{children:"Understanding how cache keys are generated helps you optimize caching behavior."}),"\n",(0,a.jsx)(n.h3,{id:"automatic-key-generation-1",children:"Automatic Key Generation"}),"\n",(0,a.jsxs)(n.p,{children:["When ",(0,a.jsx)(n.code,{children:"key"})," parameter is not specified, hugr generates keys using:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"hash(query_text + variables + role_name + data_source_config)\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Components"}),":"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Query Text"}),": The GraphQL query structure"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Variables"}),": Query variable values"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Role Name"}),": User's role/permissions (if auth enabled)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Data Source Config"}),": Data source connection details"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"query GetProducts($category: String!) {\n  products(filter: { category: $category }) @cache(ttl: 300) {\n    id\n    name\n    price\n  }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"This generates different keys for:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Different ",(0,a.jsx)(n.code,{children:"$category"})," values"]}),"\n",(0,a.jsx)(n.li,{children:"Different user roles"}),"\n",(0,a.jsx)(n.li,{children:"Different data source configurations"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"custom-keys-with-key-parameter",children:"Custom Keys with key Parameter"}),"\n",(0,a.jsx)(n.p,{children:"Use explicit keys for predictable caching:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  # Explicit key - same for all users\n  stats: statistics_aggregation\n    @cache(ttl: 600, key: "global:stats:2024") {\n    total_users\n    total_revenue\n  }\n\n  # Pattern-based keys\n  categoryProducts: products(filter: { category: "electronics" })\n    @cache(ttl: 300, key: "products:category:electronics") {\n    id\n    name\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"role-based-cache-isolation",children:"Role-Based Cache Isolation"}),"\n",(0,a.jsx)(n.p,{children:"By default, cache entries are isolated by user role to prevent data leakage:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"query {\n  # Admin sees all orders, User sees only their orders\n  # Different cache entries per role\n  orders @cache(ttl: 300) {\n    id\n    customer_id\n    total\n  }\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["To share cache across roles, use explicit ",(0,a.jsx)(n.code,{children:"key"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  # Same cache entry for all roles\n  publicStats: statistics_aggregation\n    @cache(ttl: 600, key: "public:stats") {\n    total_products\n    total_categories\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"best-practices-for-key-naming",children:"Best Practices for Key Naming"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use Hierarchical Structure"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"namespace:entity:identifier\nproducts:category:electronics\norders:user:12345\nstats:global:daily\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Include Version Numbers"})," for schema changes:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"products:v2:electronics\napi:v1:stats\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Be Specific"})," to avoid collisions:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"\u274c products\n\u2705 products:list:active\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use Consistent Naming"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"products:category:{category}\norders:status:{status}\nusers:role:{role}\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"cache-tags-and-invalidation",children:"Cache Tags and Invalidation"}),"\n",(0,a.jsx)(n.p,{children:"Tags enable efficient grouped cache invalidation."}),"\n",(0,a.jsx)(n.h3,{id:"using-tags-for-grouped-invalidation",children:"Using Tags for Grouped Invalidation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Schema with tags\ntype orders @table(name: "orders") @cache(ttl: 300, tags: ["orders"]) {\n  id: ID!\n  total: Float!\n}\n\ntype order_items @table(name: "order_items") @cache(ttl: 300, tags: ["order_items", "orders"]) {\n  id: ID!\n  order_id: Int!\n  product_id: Int!\n}\n\n# Query with multiple tags\nquery {\n  orderDetails: orders @cache(ttl: 300, tags: ["orders", "reports"]) {\n    id\n    total\n    items {\n      id\n      product_id\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"automatic-invalidation-on-mutations",children:"Automatic Invalidation on Mutations"}),"\n",(0,a.jsx)(n.p,{children:"When a mutation affects data, hugr automatically invalidates caches with matching tags:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Mutation\nmutation CreateOrder($input: OrderInput!) {\n  createOrder(input: $input) {\n    id\n    total\n  }\n}\n\n# All queries tagged with "orders" are invalidated:\n# - orders @cache(tags: ["orders"])\n# - orderDetails @cache(tags: ["orders", "reports"])\n# - orderStats @cache(tags: ["orders", "stats"])\n'})}),"\n",(0,a.jsx)(n.h3,{id:"manual-invalidation-with-invalidate_cache",children:"Manual Invalidation with @invalidate_cache"}),"\n",(0,a.jsxs)(n.p,{children:["Use the ",(0,a.jsx)(n.code,{children:"@invalidate_cache"})," directive to invalidate cache during query execution:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  # Invalidate specific tag\n  orders @invalidate_cache @cache(ttl: 300, tags: ["orders"]) {\n    id\n    total\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"programmatic-cache-invalidation",children:"Programmatic Cache Invalidation"}),"\n",(0,a.jsxs)(n.p,{children:["For manual cache invalidation outside of queries, use the ",(0,a.jsx)(n.code,{children:"core.cache.invalidate()"})," function. This is useful for:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Invalidating cache from mutations or scripts"}),"\n",(0,a.jsx)(n.li,{children:"Scheduled cache cleanup"}),"\n",(0,a.jsx)(n.li,{children:"Administrative operations"}),"\n",(0,a.jsx)(n.li,{children:"Event-driven invalidation"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"function-definition",children:"Function Definition"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'extend type Function {\n  invalidate(\n    tags: [String!]\n  ): OperationResult @function(name: "invalidate_cache", skip_null_arg: true) @module(name: "core.cache")\n}\n\ntype OperationResult @system {\n  success: Boolean\n  affected_rows: BigInt\n  last_id: BigInt\n  message: String\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"syntax-3",children:"Syntax"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  function {\n    core {\n      cache {\n        invalidate(tags: ["tag1", "tag2"]) {\n          success\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Parameter"}),(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"Description"}),(0,a.jsx)(n.th,{children:"Required"})]})}),(0,a.jsx)(n.tbody,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"tags"})}),(0,a.jsx)(n.td,{children:"[String!]"}),(0,a.jsx)(n.td,{children:"Array of cache tags to invalidate. All cache entries with these tags will be removed."}),(0,a.jsx)(n.td,{children:"Yes"})]})})]}),"\n",(0,a.jsx)(n.h4,{id:"return-value",children:"Return Value"}),"\n",(0,a.jsxs)(n.p,{children:["Returns ",(0,a.jsx)(n.code,{children:"OperationResult"})," with the following fields:"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Field"}),(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"success"})}),(0,a.jsx)(n.td,{children:"Boolean"}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"true"})," if invalidation succeeded, ",(0,a.jsx)(n.code,{children:"false"})," otherwise"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"affected_rows"})}),(0,a.jsx)(n.td,{children:"BigInt"}),(0,a.jsx)(n.td,{children:"Number of cache entries invalidated (may be null)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"last_id"})}),(0,a.jsx)(n.td,{children:"BigInt"}),(0,a.jsx)(n.td,{children:"Not applicable for cache operations (typically null)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"message"})}),(0,a.jsx)(n.td,{children:"String"}),(0,a.jsx)(n.td,{children:"Optional message with additional information about the operation"})]})]})]}),"\n",(0,a.jsx)(n.h4,{id:"examples-1",children:"Examples"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example 1: Invalidate Single Tag"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation UpdateProducts($input: ProductInput!) {\n  updateProduct(input: $input) {\n    id\n    name\n  }\n\n  # Invalidate all product-related caches\n  invalidateCache: function {\n    core {\n      cache {\n        invalidate(tags: ["products"]) {\n          success\n          affected_rows\n          message\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example 2: Invalidate Multiple Tags"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation UpdateOrder($id: ID!, $input: OrderInput!) {\n  updateOrder(id: $id, input: $input) {\n    id\n    total\n  }\n\n  # Invalidate multiple related caches\n  invalidateCache: function {\n    core {\n      cache {\n        invalidate(tags: ["orders", "sales", "analytics"]) {\n          success\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example 3: Administrative Cache Clear"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation ClearDashboardCache {\n  clearCache: function {\n    core {\n      cache {\n        invalidate(tags: ["dashboard", "reports", "stats"]) {\n          success\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example 4: Scheduled Cache Refresh"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Can be executed by cron job or scheduler\nquery RefreshAnalyticsCache {\n  # First, invalidate old cache\n  invalidate: function {\n    core {\n      cache {\n        invalidate(tags: ["analytics"]) {\n          success\n        }\n      }\n    }\n  }\n\n  # Then, fetch fresh data (will be cached)\n  analytics: orders_aggregation @cache(ttl: 3600, tags: ["analytics"]) {\n    _rows_count\n    total_revenue { sum }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example 5: Event-Driven Invalidation"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation OnDataImport($status: String!) {\n  # After successful data import\n  logImport(status: $status) {\n    success\n  }\n\n  # Invalidate all related caches\n  invalidateCache: function @include(if: $status == "success") {\n    core {\n      cache {\n        invalidate(tags: ["products", "categories", "inventory"]) {\n          success\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"when-to-use-1",children:"When to Use"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsxs)(n.strong,{children:["Use ",(0,a.jsx)(n.code,{children:"core.cache.invalidate()"})," when"]}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"You need to invalidate cache from mutations"}),"\n",(0,a.jsx)(n.li,{children:"Performing administrative cache management"}),"\n",(0,a.jsx)(n.li,{children:"Implementing scheduled cache refresh"}),"\n",(0,a.jsx)(n.li,{children:"Handling event-driven invalidation"}),"\n",(0,a.jsx)(n.li,{children:"Cache cleanup is independent of data queries"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsxs)(n.strong,{children:["Use ",(0,a.jsx)(n.code,{children:"@invalidate_cache"})," directive when"]}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Invalidation is tied to a specific query"}),"\n",(0,a.jsx)(n.li,{children:"You want to invalidate and immediately re-fetch data"}),"\n",(0,a.jsx)(n.li,{children:"Invalidation is part of query logic"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Invalidate Specific Tags"}),": Only invalidate tags related to changed data"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# \u274c Too broad\ninvalidate(tags: ["all"])\n\n# \u2705 Specific\ninvalidate(tags: ["products:electronics"])\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Combine with Mutations"}),": Invalidate cache after data changes"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  updateProduct(id: 1, input: {...}) { id }\n  function { core { cache { invalidate(tags: ["products"]) { success } } } }\n}\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Check Success Status"}),": Verify invalidation succeeded and review affected entries"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  result: function {\n    core {\n      cache {\n        invalidate(tags: ["orders"]) {\n          success\n          affected_rows\n          message\n        }\n      }\n    }\n  }\n}\n# Check result.function.core.cache.invalidate.success\n# Optionally log result.function.core.cache.invalidate.affected_rows\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use Hierarchical Tags"}),": Invalidate at different levels"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Invalidate all orders\ninvalidate(tags: ["orders"])\n\n# Invalidate only pending orders\ninvalidate(tags: ["orders:pending"])\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"integration-example",children:"Integration Example"}),"\n",(0,a.jsx)(n.p,{children:"Complete example showing cache invalidation in a typical workflow:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation CompleteProductUpdate {\n  # 1. Update product data\n  updateProduct(id: 123, input: {\n    name: "New Product Name"\n    price: 99.99\n  }) {\n    id\n    name\n    price\n  }\n\n  # 2. Invalidate related caches\n  invalidateProductCache: function {\n    core {\n      cache {\n        invalidate(tags: ["products", "catalog"]) {\n          success\n        }\n      }\n    }\n  }\n\n  # 3. Invalidate analytics cache\n  invalidateAnalyticsCache: function {\n    core {\n      cache {\n        invalidate(tags: ["analytics", "reports"]) {\n          success\n        }\n      }\n    }\n  }\n}\n\n# Then fetch fresh data\nquery GetUpdatedProduct {\n  product(filter: { id: 123 }) @cache(ttl: 300, tags: ["products"]) {\n    id\n    name\n    price\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"tag-naming-conventions",children:"Tag Naming Conventions"}),"\n",(0,a.jsx)(n.p,{children:"Establish consistent tag naming for better organization:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Entity-Based Tags"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'["users"]\n["products"]\n["orders"]\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Hierarchical Tags"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'["orders", "orders:pending"]\n["products", "products:electronics"]\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Feature-Based Tags"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'["dashboard"]\n["reports"]\n["analytics"]\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cross-Cutting Tags"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'["sales"]  # orders + order_items + payments\n["inventory"]  # products + stock + warehouses\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,a.jsx)(n.h3,{id:"example-1-cache-static-reference-data",children:"Example 1: Cache Static Reference Data"}),"\n",(0,a.jsx)(n.p,{children:"Cache rarely-changing reference data with long TTL:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Schema\ntype categories @table(name: "categories") @cache(ttl: 3600, tags: ["categories"]) {\n  id: ID!\n  name: String!\n  description: String!\n}\n\ntype countries @table(name: "countries") @cache(ttl: 86400, tags: ["countries"]) {\n  id: ID!\n  code: String!\n  name: String!\n}\n\n# Query\nquery ReferenceData {\n  categories @cache(ttl: 3600) {\n    id\n    name\n  }\n\n  countries @cache(ttl: 86400) {\n    id\n    code\n    name\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-2-cache-expensive-aggregations",children:"Example 2: Cache Expensive Aggregations"}),"\n",(0,a.jsx)(n.p,{children:"Cache complex aggregation queries to reduce database load:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query SalesAnalytics {\n  # Expensive aggregation - cache for 10 minutes\n  salesByCategory: orders_bucket_aggregation(\n    filter: { created_at: { gte: "2024-01-01" } }\n  ) @cache(ttl: 600, key: "analytics:sales:by_category:2024", tags: ["analytics"]) {\n    key { category }\n    aggregations {\n      total_revenue { sum }\n      avg_order_value { avg }\n      _rows_count\n    }\n  }\n\n  # Another expensive query\n  topCustomers: customers_aggregation(\n    order: { total_spent: DESC }\n    limit: 100\n  ) @cache(ttl: 600, key: "analytics:top_customers", tags: ["analytics"]) {\n    id\n    name\n    total_spent\n    order_count\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-3-per-user-cache-isolation",children:"Example 3: Per-User Cache Isolation"}),"\n",(0,a.jsx)(n.p,{children:"Automatically isolated cache entries per user role:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query UserDashboard($userId: ID!) {\n  # Admin sees all users, regular user sees only themselves\n  # Automatic cache isolation by role\n  user(filter: { id: $userId }) @cache(ttl: 300) {\n    id\n    name\n    email\n    orders {\n      id\n      total\n    }\n  }\n\n  # Global stats - shared across all roles\n  globalStats: statistics_aggregation\n    @cache(ttl: 600, key: "dashboard:global") {\n    total_users\n    total_orders\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-4-invalidate-cache-on-data-change",children:"Example 4: Invalidate Cache on Data Change"}),"\n",(0,a.jsxs)(n.p,{children:["Ensure fresh data after mutations using ",(0,a.jsx)(n.code,{children:"core.cache.invalidate()"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Update product price and invalidate cache\nmutation UpdateProductPrice($id: ID!, $price: Float!) {\n  # 1. Update the data\n  updateProduct(id: $id, input: { price: $price }) {\n    id\n    price\n  }\n\n  # 2. Invalidate related caches programmatically\n  invalidateCache: function {\n    core {\n      cache {\n        invalidate(tags: ["products", "catalog"]) {\n          success\n        }\n      }\n    }\n  }\n}\n\n# Subsequent queries will get fresh data\nquery {\n  products @cache(ttl: 300, tags: ["products"]) {\n    id\n    name\n    price\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Alternative: Using @invalidate_cache directive"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Fetch updated products with directive\nquery {\n  products @invalidate_cache @cache(ttl: 300, tags: ["products"]) {\n    id\n    name\n    price\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-5-mixed-caching-strategies",children:"Example 5: Mixed Caching Strategies"}),"\n",(0,a.jsx)(n.p,{children:"Combine different caching approaches in a single query:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query Dashboard {\n  # Long TTL for static data\n  categories @cache(ttl: 3600) {\n    id\n    name\n  }\n\n  # Medium TTL for product catalog\n  products @cache(ttl: 300, tags: ["products"]) {\n    id\n    name\n    price\n  }\n\n  # Short TTL for real-time data\n  activeOrders: orders(\n    filter: { status: "pending" }\n  ) @cache(ttl: 60, tags: ["orders"]) {\n    id\n    customer_id\n    total\n  }\n\n  # No cache for user-specific data\n  currentUser: users @no_cache {\n    id\n    name\n    recent_activity\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-6-cache-with-cache-in-queryhugr",children:"Example 6: Cache with @cache in queryHugr()"}),"\n",(0,a.jsxs)(n.p,{children:["When using JQ transformations, cache nested queries within ",(0,a.jsx)(n.code,{children:"queryHugr()"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  enrichedCustomers: jq(query: "\n    # Cache the aggregation query\n    queryHugr(\\"\n      query {\n        customer_stats: customers_bucket_aggregation @cache(ttl: 600, tags: [\\\\\\"stats\\\\\\"]) {\n          key { tier }\n          aggregations {\n            _rows_count\n            total_spent { sum avg }\n          }\n        }\n      }\n    \\").data.customer_stats as $stats |\n\n    # Enrich each customer with cached tier stats\n    .customers | map(\n      . as $customer |\n      . + {\n        tier_stats: ($stats | map(select(.key.tier == $customer.tier)) | .[0])\n      }\n    )\n  ", include_origin: false) {\n    customers {\n      id\n      name\n      tier\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The aggregation query executes only once (cached)"}),"\n",(0,a.jsx)(n.li,{children:"All customer records share the same cached stats"}),"\n",(0,a.jsx)(n.li,{children:"Significant performance improvement for large datasets"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.a,{href:"/docs/graphql/jq-transformations#caching-queryhugr-results",children:"JQ Transformations - Caching queryHugr() Results"})," for more details."]}),"\n",(0,a.jsx)(n.h3,{id:"example-7-bypass-cache-for-real-time-data",children:"Example 7: Bypass Cache for Real-Time Data"}),"\n",(0,a.jsx)(n.p,{children:"Mix cached and real-time data in the same query:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"query ProductInventory {\n  # Cached product details\n  products @cache(ttl: 300) {\n    id\n    name\n    price\n    category\n  }\n\n  # Real-time inventory - never cached\n  inventory: products @no_cache {\n    id\n    stock_quantity\n    warehouse_location\n    last_updated\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-8-caching-role-permissions",children:"Example 8: Caching Role Permissions"}),"\n",(0,a.jsx)(n.p,{children:"Cache role permissions for improved authentication and authorization performance. This is a critical use case where caching significantly reduces database load for permission checks."}),"\n",(0,a.jsx)(n.h4,{id:"how-hugr-caches-role-permissions",children:"How Hugr Caches Role Permissions"}),"\n",(0,a.jsx)(n.p,{children:"Hugr automatically caches role permissions using a specific cache key pattern and tag:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query ($role: String!, $cacheKey: String) {\n  core {\n    info: roles_by_pk(name: $role) @cache(key: $cacheKey, tags: ["$role_permissions"]) {\n      name\n      disabled\n      permissions {\n        type_name\n        field_name\n        hidden\n        disabled\n        filter\n        data\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cache Key Format"}),": ",(0,a.jsx)(n.code,{children:"RolePermissions:{role_name}"}),"\n",(0,a.jsx)(n.strong,{children:"Cache Tag"}),": ",(0,a.jsx)(n.code,{children:"$role_permissions"})]}),"\n",(0,a.jsx)(n.h4,{id:"querying-role-permissions-with-cache",children:"Querying Role Permissions with Cache"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query GetRolePermissions($roleName: String!) {\n  core {\n    roleInfo: roles_by_pk(name: $roleName)\n      @cache(\n        key: "RolePermissions:admin",  # Or dynamically: concat("RolePermissions:", $roleName)\n        tags: ["$role_permissions"]\n      ) {\n      name\n      disabled\n      permissions {\n        type_name\n        field_name\n        hidden\n        disabled\n        filter\n        data\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Permissions are cached per role"}),"\n",(0,a.jsx)(n.li,{children:"Reduces database queries for authorization checks"}),"\n",(0,a.jsx)(n.li,{children:"Improves API response times"}),"\n",(0,a.jsx)(n.li,{children:"Scales well with multiple concurrent users"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"invalidating-role-permissions-cache",children:"Invalidating Role Permissions Cache"}),"\n",(0,a.jsx)(n.p,{children:"When role permissions change, invalidate the cache to ensure users get updated permissions:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Method 1: Invalidate All Role Permissions (Recommended)"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation UpdateRolePermissions($roleName: String!, $permissions: [PermissionInput!]!) {\n  # Update role permissions\n  updateRole(name: $roleName, permissions: $permissions) {\n    name\n    permissions {\n      type_name\n      field_name\n    }\n  }\n\n  # Invalidate all role permissions cache\n  invalidatePermissions: function {\n    core {\n      cache {\n        invalidate(tags: ["$role_permissions"]) {\n          success\n          affected_rows\n          message\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Method 2: Invalidate Specific Role"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query RefreshRolePermissions($roleName: String!) {\n  core {\n    # Invalidate and re-fetch specific role\n    roleInfo: roles_by_pk(name: $roleName)\n      @invalidate_cache\n      @cache(\n        key: "RolePermissions:admin",\n        tags: ["$role_permissions"]\n      ) {\n      name\n      permissions {\n        type_name\n        field_name\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Method 3: Programmatic Invalidation by Tag"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation ClearAllRolePermissionsCache {\n  clearCache: function {\n    core {\n      cache {\n        invalidate(tags: ["$role_permissions"]) {\n          success\n          affected_rows\n          message\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"complete-workflow-example",children:"Complete Workflow Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# 1. Create or update role\nmutation UpdateAdminRole {\n  updateRole(\n    name: "admin",\n    permissions: [\n      { type_name: "users", field_name: "*", disabled: false },\n      { type_name: "orders", field_name: "*", disabled: false }\n    ]\n  ) {\n    name\n    permissions {\n      type_name\n      field_name\n    }\n  }\n\n  # 2. Invalidate role permissions cache\n  invalidatePermissions: function {\n    core {\n      cache {\n        invalidate(tags: ["$role_permissions"]) {\n          success\n          affected_rows\n          message\n        }\n      }\n    }\n  }\n}\n\n# 3. Next request will fetch fresh permissions from database\nquery GetAdminPermissions {\n  core {\n    admin: roles_by_pk(name: "admin")\n      @cache(\n        key: "RolePermissions:admin",\n        tags: ["$role_permissions"],\n        ttl: 3600  # Cache for 1 hour\n      ) {\n      name\n      disabled\n      permissions {\n        type_name\n        field_name\n        hidden\n        disabled\n        filter\n        data\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"best-practices-for-permission-caching",children:"Best Practices for Permission Caching"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Use Consistent Cache Keys"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Always use format: ",(0,a.jsx)(n.code,{children:"RolePermissions:{role_name}"})]}),"\n",(0,a.jsx)(n.li,{children:"Ensures predictable cache behavior"}),"\n",(0,a.jsx)(n.li,{children:"Easy to debug and monitor"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Long TTL for Permissions"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Permissions change infrequently"}),"\n",(0,a.jsx)(n.li,{children:"Use TTL of 1-24 hours"}),"\n",(0,a.jsx)(n.li,{children:"Rely on manual invalidation after updates"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Always Invalidate After Changes"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Invalidate cache immediately after role updates"}),"\n",(0,a.jsxs)(n.li,{children:["Use ",(0,a.jsx)(n.code,{children:"$role_permissions"})," tag to clear all roles"]}),"\n",(0,a.jsx)(n.li,{children:"Consider security implications of stale permissions"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Monitor Cache Effectiveness"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Track ",(0,a.jsx)(n.code,{children:"affected_rows"})," to see how many entries were cleared"]}),"\n",(0,a.jsx)(n.li,{children:"Monitor permission check latency"}),"\n",(0,a.jsx)(n.li,{children:"Alert on failed invalidations"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Graceful Fallback"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If cache invalidation fails, consider forcing refresh"}),"\n",(0,a.jsx)(n.li,{children:"Log failures for security auditing"}),"\n",(0,a.jsx)(n.li,{children:"Have monitoring for stale permissions"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u26a0\ufe0f Important"}),": Stale permission cache can lead to security issues:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Always invalidate"})," after permission changes"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Verify invalidation success"})," in mutations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use short TTLs"})," for highly sensitive roles"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Consider real-time invalidation"})," for critical permissions"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation UpdateCriticalPermissions($roleName: String!) {\n  updateRole(name: $roleName, permissions: [...]) {\n    name\n  }\n\n  # Verify invalidation succeeded\n  invalidateResult: function {\n    core {\n      cache {\n        invalidate(tags: ["$role_permissions"]) {\n          success\n          message\n        }\n      }\n    }\n  }\n}\n\n# Check: invalidateResult.function.core.cache.invalidate.success === true\n'})}),"\n",(0,a.jsx)(n.h4,{id:"performance-impact",children:"Performance Impact"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Without Caching"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Permission check on every request"}),"\n",(0,a.jsx)(n.li,{children:"50-100ms database query per request"}),"\n",(0,a.jsx)(n.li,{children:"High database load"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"With Caching"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Permission check from cache (1-5ms)"}),"\n",(0,a.jsx)(n.li,{children:"Reduced database load by 90%+"}),"\n",(0,a.jsx)(n.li,{children:"Better response times for users"}),"\n",(0,a.jsx)(n.li,{children:"Scales to thousands of concurrent users"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"integration-with-caching-infrastructure",children:"Integration with Caching Infrastructure"}),"\n",(0,a.jsxs)(n.p,{children:["Cache directives seamlessly integrate with hugr's ",(0,a.jsx)(n.a,{href:"/docs/deployment/caching",children:"caching infrastructure"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"how-directives-interact-with-l1l2-cache",children:"How Directives Interact with L1/L2 Cache"}),"\n",(0,a.jsxs)(n.p,{children:["When you use ",(0,a.jsx)(n.code,{children:"@cache"}),", the behavior depends on your cache configuration:"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"With Both L1 and L2 Enabled"})," (two-tier caching):"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"First Request"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Check L1 cache (in-memory)"}),"\n",(0,a.jsx)(n.li,{children:"If miss, check L2 cache (Redis/Memcached)"}),"\n",(0,a.jsx)(n.li,{children:"If miss, execute query"}),"\n",(0,a.jsx)(n.li,{children:"Store result in both L1 and L2 caches"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Subsequent Requests"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Serve from L1 cache (fastest)"}),"\n",(0,a.jsx)(n.li,{children:"If L1 expires, serve from L2 cache"}),"\n",(0,a.jsx)(n.li,{children:"If both expire, re-execute query"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"With L1 Only"})," (in-memory caching):"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Cache stored only in Hugr server memory"}),"\n",(0,a.jsx)(n.li,{children:"Fast access, but not shared across multiple Hugr instances"}),"\n",(0,a.jsx)(n.li,{children:"Cache lost on server restart"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"With L2 Only"})," (direct distributed caching):"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Cache goes directly to Redis/Memcached"}),"\n",(0,a.jsx)(n.li,{children:"Shared across all Hugr instances"}),"\n",(0,a.jsx)(n.li,{children:"Survives server restarts"}),"\n",(0,a.jsx)(n.li,{children:"Slightly higher latency than L1, but still much faster than database"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cache-configuration-requirements",children:"Cache Configuration Requirements"}),"\n",(0,a.jsx)(n.p,{children:"To use cache directives, enable at least one cache level in your deployment. You can use L1, L2, or both:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Option 1: L1 Only (In-Memory)"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# In-memory cache only\nCACHE_L1_ENABLED=true\nCACHE_L1_MAX_SIZE=512  # MB\nCACHE_TTL=5m\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Option 2: L2 Only (Distributed)"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Direct distributed cache without L1\nCACHE_L2_ENABLED=true\nCACHE_L2_BACKEND=redis\nCACHE_L2_ADDRESSES=redis:6379\nCACHE_TTL=5m\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Option 3: Both L1 and L2 (Recommended for Production)"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Two-tier caching for optimal performance\nCACHE_L1_ENABLED=true\nCACHE_L1_MAX_SIZE=512  # MB\nCACHE_L2_ENABLED=true\nCACHE_L2_BACKEND=redis\nCACHE_L2_ADDRESSES=redis:6379\nCACHE_TTL=5m\n"})}),"\n",(0,a.jsx)(n.admonition,{title:"Configuration Choice",type:"tip",children:(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"L1 only"}),": Best for single-instance deployments"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"L2 only"}),": Best when you need cache sharing but want to minimize Hugr server memory usage"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Both"}),": Best for high-traffic production with multiple Hugr instances"]}),"\n"]})}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.a,{href:"/docs/deployment/caching",children:"Caching Configuration"})," for full setup details."]}),"\n",(0,a.jsx)(n.h3,{id:"link-to-deployment-caching-configuration",children:"Link to Deployment Caching Configuration"}),"\n",(0,a.jsx)(n.p,{children:"For detailed information on:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["L1 cache configuration (",(0,a.jsx)(n.code,{children:"CACHE_L1_*"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["L2 cache configuration (",(0,a.jsx)(n.code,{children:"CACHE_L2_*"}),")"]}),"\n",(0,a.jsx)(n.li,{children:"Redis and Memcached setup"}),"\n",(0,a.jsx)(n.li,{children:"Docker Compose examples"}),"\n",(0,a.jsx)(n.li,{children:"Performance tuning"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["See the ",(0,a.jsx)(n.a,{href:"/docs/deployment/caching",children:"Deployment - Caching"})," guide."]}),"\n",(0,a.jsx)(n.h2,{id:"best-practices-1",children:"Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"when-to-use-schema-level-vs-query-time-caching",children:"When to Use Schema-Level vs Query-Time Caching"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use Schema-Level Caching"})," when:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Most queries for a type should be cached"}),"\n",(0,a.jsx)(n.li,{children:"Consistent TTL across all queries"}),"\n",(0,a.jsx)(n.li,{children:"Automatic cache invalidation on mutations"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'type products @table(name: "products") @cache(ttl: 300, tags: ["products"]) {\n  id: ID!\n  name: String!\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use Query-Time Caching"})," when:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Different queries need different TTLs"}),"\n",(0,a.jsx)(n.li,{children:"Only specific queries should be cached"}),"\n",(0,a.jsx)(n.li,{children:"Need custom cache keys"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  expensive: products_aggregation @cache(ttl: 600, key: "expensive_query") {\n    # ...\n  }\n\n  cheap: products @cache(ttl: 60) {\n    # ...\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"choosing-appropriate-ttl-values",children:"Choosing Appropriate TTL Values"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Data Characteristics"}),(0,a.jsx)(n.th,{children:"Recommended TTL"}),(0,a.jsx)(n.th,{children:"Example"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Real-time, constantly changing"}),(0,a.jsx)(n.td,{children:"30-60 seconds"}),(0,a.jsx)(n.td,{children:"Stock prices, live scores"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Frequently updated"}),(0,a.jsx)(n.td,{children:"1-5 minutes"}),(0,a.jsx)(n.td,{children:"Social media feeds, news"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Moderately updated"}),(0,a.jsx)(n.td,{children:"5-15 minutes"}),(0,a.jsx)(n.td,{children:"Product listings, inventory"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Rarely updated"}),(0,a.jsx)(n.td,{children:"15-60 minutes"}),(0,a.jsx)(n.td,{children:"User profiles, categories"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Static reference data"}),(0,a.jsx)(n.td,{children:"1-24 hours"}),(0,a.jsx)(n.td,{children:"Countries, currencies, settings"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"tag-organization-strategies",children:"Tag Organization Strategies"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Entity-Based"}),": Tag by data entity"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'tags: ["users"]\ntags: ["products"]\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Feature-Based"}),": Tag by feature area"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'tags: ["dashboard"]\ntags: ["analytics"]\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Hierarchical"}),": Use nested tags"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'tags: ["orders", "orders:pending"]\ntags: ["products", "products:electronics"]\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cross-Cutting"}),": Tag related entities"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'tags: ["sales"]  # orders + payments + invoices\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cache-key-design",children:"Cache Key Design"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use Predictable Patterns"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"{entity}:{operation}:{identifier}\nproducts:list:electronics\norders:detail:12345\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Include Version"})," for schema changes:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"products:v2:list\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Avoid Dynamic Parts"})," unless necessary:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"\u274c products:list:2024-01-15-14-30-22  # timestamp changes too often\n\u2705 products:list:2024-01-15  # stable daily cache\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"avoiding-cache-stampede",children:"Avoiding Cache Stampede"}),"\n",(0,a.jsx)(n.p,{children:"When cache expires, avoid multiple simultaneous queries:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Stagger TTLs"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"products @cache(ttl: 300)  # 5 min\ncategories @cache(ttl: 310)  # 5 min 10 sec\nbrands @cache(ttl: 320)  # 5 min 20 sec\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use Longer TTLs"})," with explicit invalidation:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'products @cache(ttl: 3600, tags: ["products"])  # 1 hour\n# Invalidate on mutations instead of waiting for TTL\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"memory-considerations",children:"Memory Considerations"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Monitor Cache Size"}),": Track L1 cache memory usage"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsxs)(n.strong,{children:["Adjust ",(0,a.jsx)(n.code,{children:"CACHE_L1_MAX_SIZE"})]})," based on available memory"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use Appropriate TTLs"}),": Don't cache more than necessary"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Consider Result Size"}),": Large results consume more memory"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"# Large result set - shorter TTL\nallProducts: products @cache(ttl: 60) {\n  # ...all fields...\n}\n\n# Small result set - longer TTL\nproductCount: products_aggregation @cache(ttl: 600) {\n  _rows_count\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,a.jsx)(n.h3,{id:"cache-hit-ratio-optimization",children:"Cache Hit Ratio Optimization"}),"\n",(0,a.jsx)(n.p,{children:"Monitor and optimize your cache hit ratio:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Identify Hot Queries"}),": Cache frequently-executed queries"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Adjust TTLs"}),": Balance freshness vs hit ratio"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use Custom Keys"}),": Share cache across similar queries"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Before: Each user\'s query creates separate cache entry\nquery UserProducts($userId: ID!) {\n  products(filter: { user_id: $userId }) @cache(ttl: 300) {\n    id\n    name\n  }\n}\n\n# After: All users share the same product list\nquery AllProducts {\n  products @cache(ttl: 300, key: "products:list") {\n    id\n    name\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"impact-on-query-performance",children:"Impact on Query Performance"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cache Hit"})," (fastest):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Query \u2192 L1 Cache \u2192 Response\nTime: 1-5ms\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"L1 Miss, L2 Hit"})," (fast):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Query \u2192 L1 Miss \u2192 L2 Cache \u2192 Response\nTime: 5-20ms\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cache Miss"})," (slower):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Query \u2192 L1 Miss \u2192 L2 Miss \u2192 Database \u2192 Response \u2192 Cache\nTime: 50-500ms+ (depends on query complexity)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"cache-warming-strategies",children:"Cache Warming Strategies"}),"\n",(0,a.jsx)(n.p,{children:"Pre-populate cache to improve initial performance:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Post-Deployment Warming"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"# Execute critical queries after deployment\nquery WarmCache {\n  categories @cache(ttl: 3600) { id name }\n  products @cache(ttl: 600) { id name price }\n  popularProducts: products(filter: { views: { gte: 1000 } }) @cache(ttl: 300) { id name }\n}\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Scheduled Refresh"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Cron job to refresh cache before TTL expiration\n*/4 * * * * curl -X POST https://api.example.com/graphql \\\n  -d \'{"query": "query { products @cache(ttl: 300) { id name } }"}\'\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Pre-Load Critical Data"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# On server startup, execute important queries\nquery PreloadCache {\n  globalStats @cache(ttl: 600, key: "global:stats") { total_users total_orders }\n  categories @cache(ttl: 3600) { id name }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"monitoring-cache-effectiveness",children:"Monitoring Cache Effectiveness"}),"\n",(0,a.jsx)(n.p,{children:"Track these metrics:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cache Hit Ratio"}),": ",(0,a.jsx)(n.code,{children:"(cache_hits / total_requests) * 100"})]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Target: >70% for frequently-accessed data"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Average Response Time"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Cached: <10ms"}),"\n",(0,a.jsx)(n.li,{children:"Uncached: >50ms"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cache Memory Usage"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Monitor L1 cache size"}),"\n",(0,a.jsxs)(n.li,{children:["Alert if approaching ",(0,a.jsx)(n.code,{children:"CACHE_L1_MAX_SIZE"})]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cache Evictions"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Frequent evictions may indicate insufficient cache size"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,a.jsx)(n.h3,{id:"pattern-1-caching-read-heavy-queries",children:"Pattern 1: Caching Read-Heavy Queries"}),"\n",(0,a.jsx)(n.p,{children:"For queries that are frequently read but rarely updated:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'type products @table(name: "products") @cache(ttl: 600, tags: ["products"]) {\n  id: ID!\n  name: String!\n  price: Float!\n}\n\nquery ProductCatalog {\n  products @cache(ttl: 600, tags: ["products"]) {\n    id\n    name\n    price\n    category\n  }\n}\n\n# On product update, invalidate cache\nmutation UpdateProduct($id: ID!, $input: ProductInput!) {\n  updateProduct(id: $id, input: $input) {\n    id\n    name\n    price\n  }\n}\n\nquery RefreshProducts {\n  products @invalidate_cache @cache(ttl: 600, tags: ["products"]) {\n    id\n    name\n    price\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"pattern-2-cache-aside-pattern",children:"Pattern 2: Cache-Aside Pattern"}),"\n",(0,a.jsx)(n.p,{children:"Manually control when to use cache vs fresh data:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"query Dashboard($useCache: Boolean!) {\n  # Use cache when useCache = true\n  stats: statistics_aggregation @cache(ttl: 300) @skip(if: !$useCache) {\n    total_users\n    total_orders\n  }\n\n  # Skip cache when useCache = false\n  freshStats: statistics_aggregation @no_cache @include(if: !$useCache) {\n    total_users\n    total_orders\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"pattern-3-write-through-caching",children:"Pattern 3: Write-Through Caching"}),"\n",(0,a.jsx)(n.p,{children:"Update cache immediately after mutations:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation CreateProduct($input: ProductInput!) {\n  createProduct(input: $input) {\n    id\n    name\n    price\n  }\n}\n\n# Immediately update cache with new data\nquery {\n  products @invalidate_cache @cache(ttl: 600, tags: ["products"]) {\n    id\n    name\n    price\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"pattern-4-time-based-invalidation",children:"Pattern 4: Time-Based Invalidation"}),"\n",(0,a.jsx)(n.p,{children:"Different invalidation strategies based on time:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'query {\n  # Short TTL - expires quickly\n  recentOrders: orders(\n    filter: { created_at: { gte: "2024-01-01" } }\n  ) @cache(ttl: 60) {\n    id\n    total\n  }\n\n  # Long TTL - historical data rarely changes\n  historicalOrders: orders(\n    filter: { created_at: { lt: "2023-01-01" } }\n  ) @cache(ttl: 86400) {\n    id\n    total\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"pattern-5-event-based-invalidation",children:"Pattern 5: Event-Based Invalidation"}),"\n",(0,a.jsx)(n.p,{children:"Invalidate cache when specific events occur:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Event: New order created\nmutation CreateOrder($input: OrderInput!) {\n  createOrder(input: $input) {\n    id\n    total\n  }\n}\n\n# Invalidate all order-related caches\nquery {\n  orders @invalidate_cache @cache(ttl: 300, tags: ["orders"]) {\n    id\n    total\n  }\n\n  orderStats @invalidate_cache @cache(ttl: 300, tags: ["orders", "stats"]) {\n    _rows_count\n    total_revenue { sum }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(n.h3,{id:"cache-not-working",children:"Cache Not Working"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Symptoms"}),": Queries are not cached, always hitting the database"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Possible Causes"}),":"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Caching not enabled"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Check configuration - at least one must be enabled\nCACHE_L1_ENABLED=true  # For in-memory cache\n# OR\nCACHE_L2_ENABLED=true  # For distributed cache\n# OR both for two-tier caching\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Directive missing or incorrect"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"# \u274c No directive\nquery { products { id name } }\n\n# \u2705 With directive\nquery { products @cache(ttl: 300) { id name } }\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"TTL too short"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"# If TTL is too short, cache expires immediately\nproducts @cache(ttl: 1) { id }  # \u274c Only 1 second\n\nproducts @cache(ttl: 300) { id }  # \u2705 5 minutes\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cache key collision"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# Different queries with same custom key\nproducts @cache(key: "products") { id name }\nproducts @cache(key: "products") { id price }  # \u274c Same key!\n\n# Use unique keys\nproducts @cache(key: "products:basic") { id name }\nproducts @cache(key: "products:full") { id price }\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"stale-data-issues",children:"Stale Data Issues"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Symptoms"}),": Cache returns outdated data after mutations"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsxs)(n.strong,{children:["Use ",(0,a.jsx)(n.code,{children:"@invalidate_cache"})]})," after mutations:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'mutation UpdateProduct($id: ID!, $input: ProductInput!) {\n  updateProduct(id: $id, input: $input) {\n    id\n    price\n  }\n}\n\n# Invalidate after mutation\nquery {\n  products @invalidate_cache @cache(ttl: 300, tags: ["products"]) {\n    id\n    price\n  }\n}\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Reduce TTL"})," for frequently-updated data:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"# Before\nproducts @cache(ttl: 3600) { id price }  # \u274c 1 hour is too long\n\n# After\nproducts @cache(ttl: 60) { id price }  # \u2705 1 minute\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use tags"})," for automatic invalidation:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'type products @table(name: "products") @cache(ttl: 300, tags: ["products"]) {\n  id: ID!\n  price: Float!\n}\n\n# Mutations automatically invalidate "products" tag\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cache-key-collisions",children:"Cache Key Collisions"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Symptoms"}),": Different queries return the same cached results"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cause"}),": Custom keys are not unique enough"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solution"}),": Use more specific keys:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:'# \u274c Collision risk\nquery A { products(filter: { category: "electronics" }) @cache(key: "products") { id } }\nquery B { products(filter: { category: "books" }) @cache(key: "products") { id } }\n\n# \u2705 Unique keys\nquery A { products(filter: { category: "electronics" }) @cache(key: "products:electronics") { id } }\nquery B { products(filter: { category: "books" }) @cache(key: "products:books") { id } }\n\n# \u2705 Or use auto-generated keys (no key parameter)\nquery A { products(filter: { category: "electronics" }) @cache(ttl: 300) { id } }\nquery B { products(filter: { category: "books" }) @cache(ttl: 300) { id } }\n'})}),"\n",(0,a.jsx)(n.h3,{id:"memory-pressure",children:"Memory Pressure"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Symptoms"}),": High memory usage, frequent evictions, OOM errors"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsxs)(n.strong,{children:["Increase ",(0,a.jsx)(n.code,{children:"CACHE_L1_MAX_SIZE"})]}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Before\nCACHE_L1_MAX_SIZE=512  # MB\n\n# After\nCACHE_L1_MAX_SIZE=1024  # MB\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Reduce TTLs"})," to expire entries faster:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"# Before\nproducts @cache(ttl: 3600) { ... }\n\n# After\nproducts @cache(ttl: 300) { ... }\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cache only necessary data"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-graphql",children:"# \u274c Caching large result sets\nquery { products @cache(ttl: 600) { id name description long_text images } }\n\n# \u2705 Cache only needed fields\nquery { products @cache(ttl: 600) { id name } }\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Use L2 cache"})," (Redis/Memcached) for larger datasets:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"CACHE_L2_ENABLED=true\nCACHE_L2_BACKEND=redis\nCACHE_L2_ADDRESSES=redis:6379\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Adjust eviction settings"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"CACHE_L1_EVICTION_TIME=15m  # Reduce from 30m\nCACHE_L1_CLEAN_TIME=5m  # More frequent cleanup\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"/docs/deployment/caching",children:"Deployment - Caching Configuration"})}),": L1/L2 cache setup, Redis/Memcached configuration"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"/docs/references/directives",children:"Directives Reference"})}),": Complete directive reference including ",(0,a.jsx)(n.code,{children:"@cache"}),", ",(0,a.jsx)(n.code,{children:"@no_cache"}),", ",(0,a.jsx)(n.code,{children:"@invalidate_cache"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"/docs/graphql/jq-transformations#caching-queryhugr-results",children:"JQ Transformations - Caching queryHugr()"})}),": Using ",(0,a.jsx)(n.code,{children:"@cache"})," in nested queries within JQ expressions"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"/docs/graphql/queries/function-calls",children:"Function Calls"})}),": Information about ",(0,a.jsx)(n.code,{children:"core.cache.invalidate()"})," and other built-in functions"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"/docs/graphql/queries",children:"GraphQL Queries"})}),": General information about querying in hugr"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Next Steps"}),":"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Enable caching in your deployment - see ",(0,a.jsx)(n.a,{href:"/docs/deployment/caching",children:"Caching Configuration"})]}),"\n",(0,a.jsxs)(n.li,{children:["Add ",(0,a.jsx)(n.code,{children:"@cache"})," to your most expensive queries"]}),"\n",(0,a.jsx)(n.li,{children:"Monitor cache hit ratio and adjust TTLs"}),"\n",(0,a.jsx)(n.li,{children:"Use tags for organized cache invalidation"}),"\n",(0,a.jsx)(n.li,{children:"Implement cache warming for critical queries"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>t});var s=i(6540);const a={},r=s.createContext(a);function c(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);